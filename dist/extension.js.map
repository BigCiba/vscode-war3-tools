{"version":3,"file":"extension.js","mappings":"2BAAA,IAKIA,EALAC,EAAK,EAAQ,KACbC,EAAK,EAAQ,IACbC,EAAO,EAAQ,IACfC,EAAK,EAAQ,IAGbC,EAAWH,EAAGI,QAAUJ,EAAGI,UAC1BC,QAAQC,IAAIC,QACZF,QAAQC,IAAIE,MACZH,QAAQI,MAEb,SAASC,IACPC,KAAKC,MAAQ,EACf,CAEAF,EAAUG,UAAY,CACpBC,OAAQ,SAASC,EAAMC,GACrB,IAAIC,EAAOhB,EAAKiB,KAAKF,EACnB,cAAgBG,KAAKC,SAASC,SAAS,IAAIC,OAAO,IAGpD,OADAX,KAAKC,MAAMW,KAAK,CAAEN,KAAMA,EAAMF,KAAMA,IAC7BE,CACT,EACAO,MAAO,WACL,IAAK,IAAIC,EAAI,EAAGA,EAAIC,UAAUC,SAAUF,EACtC1B,EAAG6B,cAAcF,UAAUD,GAAI,IAEnC,EACAI,MAAO,WACL,IAAK,IAAIJ,EAAI,EAAGA,EAAIC,UAAUC,SAAUF,EACtC1B,EAAG+B,UAAUJ,UAAUD,GAE3B,EACAM,QAAS,SAASC,GAChB,IAEE,IADA,IAAIC,EACIA,EAAOtB,KAAKC,MAAMsB,OAAQ,CAChC,IAAInB,EAAOkB,EAAKlB,KACZE,EAAOgB,EAAKhB,KACH,SAATF,GAAmBb,EAAGiC,KAAKlB,GAC7BlB,EAAGqC,WAAWnB,GAEE,QAATF,GAAkBb,EAAGmC,UAAUpB,IACtClB,EAAGuC,UAAUrB,EAEjB,CAIF,CAFA,QACMf,EAAGqC,KAAKP,IAAKA,GACnB,CACF,GAGF,IAAIQ,GAAU,EAEdC,EAAOC,QAAU,SAASC,EAAmBX,GAC3C,IAAK9B,EAAGqC,KAAKP,GACX,OAAO,EAET,QAAmBY,IAAf9C,EACF,OAAOkC,EAAGlC,GAGZ,GAAK0C,EAKH,OAAOK,YAAW,WAChBF,EAAmBX,EACrB,GAAG,KANHQ,GAAU,EASZ,IAQIM,EARAlC,EAAQ,IAAIF,EACZqC,EAASnC,EAAME,OAAO,MAAOX,GAC7B6C,EAAQpC,EAAME,OAAO,MAAOiC,GAC5BZ,EAAOvB,EAAME,OAAO,OAAQkC,GAEhCpC,EAAMiB,MAAMkB,EAAQC,GAKpB,IACEF,EAAU/C,EAAGkD,MAAMF,EAJP,CAAEG,WAAW,GAW3B,CANE,MAAOC,GACP,GAAc,uCAAVA,EAAEC,KACJ,OAAOpB,EAAGlC,GAAa,GAEvB,MAAMqD,CAEV,CAEA,IAAKL,EACH,OAAO,EAGT,IAAIO,EAAQR,YAAW,WACrBC,EAAQQ,QACR1C,EAAMmB,SAAQ,WACZC,EAAGlC,GAAa,EAClB,GACF,GAAG,KAEHgD,EAAQS,GAAG,UAAU,SAASC,EAAKvC,GAC7BhB,EAAKwD,SAAStB,KAAUlC,EAAKwD,SAASxC,KACxC6B,EAAQQ,QACRI,aAAaL,GACbzC,EAAMmB,SAAQ,WACZC,EAAGlC,GAAa,EAClB,IAEJ,IACAc,EAAMY,MAAMW,EACd,C,eClHA,IAAIpC,EAAK,EAAQ,KACbE,EAAO,EAAQ,IACfD,EAAK,EAAQ,IAEjB,SAAS2D,EAAYC,EAAMC,GACzB,OAAOC,OAAOjD,UAAUQ,SAAS0C,KAAKH,KAChC,WAAaC,EAAM,GAC3B,CAEA,SAASG,EAAU/C,EAAMe,GACvB,IACE,OAAOA,EAAGf,EASZ,CARE,MAAOgD,GACP,GAAI,0BAA0BC,KAAKD,EAAIb,MAIrC,MAHiB,WAAba,EAAIb,MACNe,QAAQC,KAAK,4BAA6BnD,IAErC,EAET,MAAMgD,CACR,CACF,CAEA,IAAI/D,EAAK,CACPmE,IAAK,SAAST,GACZ,OAAe,MAARA,CACT,EACAU,MAAO,SAASV,GACd,OAAOW,MAAMC,QAAQZ,EACvB,EACAa,YAAa,SAASb,GACpB,IAAK,IAAIc,KAAOd,EACd,OAAO,EAET,OAAO,CACT,EACAe,OAAQ,SAASf,GACf,OAAOgB,OAAOC,SAASjB,EACzB,EACAkB,OAAQ,SAASlB,GACf,OAAOD,EAAYC,EAAM,SAC3B,EACAmB,OAAQ,SAASnB,GACf,OAAOD,EAAYC,EAAM,SAC3B,EACArB,KAAM,SAASqB,GACb,MAAuB,mBAATA,CAChB,EACAoB,OAAQ,SAASpB,GACf,OAAOD,EAAYC,EAAM,SAC3B,EACAqB,OAAQ,SAAShE,GACf,OAAOlB,EAAGmF,WAAWjE,EACvB,EACAkB,KAAM,SAASlB,GACb,OAAO+C,EAAU/C,GAAM,SAASkE,GAC9B,OAAOpF,EAAGqF,SAASD,GAAGE,QACxB,GACF,EACAC,SAAU,SAASC,EAAGC,GACpB,OAAOvF,EAAKwF,QAAQF,KAAOtF,EAAKwF,QAAQD,EAC1C,EACAnD,UAAW,SAASpB,GAClB,OAAO+C,EAAU/C,GAAM,SAASkE,GAC9B,OAAOpF,EAAGqF,SAASD,GAAGO,aACxB,GACF,EACAC,aAAc,SAAS1E,GACrB,OAAO+C,EAAU/C,GAAM,SAASkE,GAC9B,OAAOpF,EAAG6F,UAAUT,GAAGU,gBACzB,GACF,EACAC,QAAS,WACP,MAAyB,UAAlB9F,EAAG+F,UACZ,GAGFtD,EAAOC,QAAUxC,C,gBC7EjB,IAAIH,EAAK,EAAQ,KACbE,EAAO,EAAQ,IACf+F,EAAO,EAAQ,KACfC,EAAS,EAAQ,KAEjBtD,EAAqB,EAAQ,KAC7BzC,EAAK,EAAQ,IAGbgG,EAAe,SAEfC,EAAYC,OAAO,QAQvB,SAASC,EAAOC,GACd,OAAOA,EAAIC,QAAO,SAASC,EAAG/E,EAAGgF,GAC/B,OAAOA,EAAKC,QAAQF,KAAO/E,CAC7B,GACF,CASA,SAASkF,EAAeC,GACtB,GAAIA,GAAyB,WAAbA,IAA0BhC,OAAOiC,WAAWD,GAC1D,MAAM,IAAIE,MAAM,qBAAuBF,EAE3C,CA6EA,SAASG,IACP,IAAIC,EAAO,CAAC,EACZ,OAAO,SAAShF,GACd,OAAO,SAASwB,EAAKvC,GACnB+F,EAAKxD,EAAMvC,GAAQ,CAACuC,EAAKvC,GACzB4B,YAAW,WACTiB,OAAOmD,KAAKD,GAAME,SAAQ,SAAS/B,GACjCnD,EAAGmF,MAAM,KAAMH,EAAK7B,GACtB,IACA6B,EAAO,CAAC,CACV,GACF,CACF,CACF,CAEA,SAASI,EAAkBC,EAAKrF,EAAIsF,EAAO,WAAY,GACjDpH,EAAGmC,UAAUgF,GACftH,EAAGwH,QAAQF,GAAK,SAASpD,EAAKuD,GAC5B,GAAIvD,EAAK,CAEP,IAAI,mBAAmBC,KAAKD,EAAIb,MAG9B,MAAMa,EAFNE,QAAQC,KAAK,6BAA8BiD,EAI/C,MAEEG,EAAIN,SAAQ,SAASO,GACnB,IAAIC,EAAOzH,EAAKiB,KAAKmG,EAAKI,GACtBvH,EAAGmC,UAAUqF,IAAO1F,EAAG0F,EAC7B,IACAJ,GAEJ,IAEAA,GAEJ,CAEA,SAASK,EAAUC,GACjB,IAAIC,EAAU,EACd,OAAO,WAEL,OADAA,IACO,WAEW,KADhBA,GACmBD,GACrB,CACF,CACF,CAEA,SAASE,IACP,OAAO,WAAqB,CAC9B,CAEA,SAASC,EAAcC,EAAUzB,GAG/B,OAAQrG,EAAGqC,KAAKgE,IAAWA,EAAOyB,EAAU7B,KAAeA,CAC7D,CAEA,IAAI8B,EAAqBjC,EAAKkC,WAC5B,WAAY,GACZ,wJAKF,SAASC,IACPlC,EAAOmC,aAAarE,KAAKpD,MACzBA,KAAK0H,SAAW,CAAC,EACjB1H,KAAK2H,UAAW,EAChB3H,KAAK4H,WAAY,CACnB,CAsEA,SAASC,EAAU/B,GACZA,EAAK6B,WACR7B,EAAK6B,UAAW,EAGhBjI,QAAQoI,UAAS,WACfhC,EAAKiC,KAAK,QACZ,IAEJ,CAEA,SAASC,EAAUlC,GACjBA,EAAKiC,KAAK,QACZ,CA0JA,SAASE,EAAeP,GACtB,IAAIvF,EAAU,IAAIqF,EACdU,EAAa9B,IACbc,EAAUQ,EAAS1G,OAqCvB,OAnCA0G,EAASnB,SAAQ,SAAS4B,GACxBA,EAAEvF,GAAG,SAAUsF,GAAW,SAASrF,EAAKvC,GACtC6B,EAAQ4F,KAAK,SAAUlF,EAAKvC,EAC9B,KACA6H,EAAEvF,GAAG,SAAS,SAASU,GACrBnB,EAAQ4F,KAAK,QAASzE,EACxB,IACA6E,EAAEvF,GAAG,SAAS,aACJsE,GACNW,EAAU1F,EAEd,GACF,IAEAA,EAAQQ,MAAQ,WACd+E,EAASnB,SAAQ,SAAS4B,GACxBA,EAAExF,OACJ,IACAjD,QAAQoI,SAASE,EAAW7F,EAC9B,EAEAA,EAAQiG,gBAAkB,SAAS/G,GACjC,GAAI9B,EAAGqC,KAAKP,GAAK,CACf,IAAIgH,EAAWX,EAASY,KAAI,SAASH,GACnC,OAAO,IAAII,SAAQ,SAASzD,GAC1BqD,EAAEC,gBAAgBtD,EACpB,GACF,IACAyD,QAAQ1B,IAAIwB,GAAUG,MAAK,SAASC,GAClC,IAAIC,EAAMhD,EAAa+C,EA7alBE,QAAO,SAASC,EAAK/C,GAC9B,OAAO+C,EAAIC,OAAOhD,EACpB,GAAG,KA4aGxE,EAAGqH,EACL,GACF,CACF,EAEOvG,EAAQ2G,QACjB,CAEA,SAASxG,EAAMyG,EAAOC,EAAS3H,GAC7B,IAAIc,EAAU,IAAIqF,EAiClB,GA/BIjI,EAAGyE,OAAO+E,KACZA,EAAQA,EAAMrI,YAGXnB,EAAGoE,MAAMoF,IAAWxJ,EAAG+E,OAAOyE,IACjC5G,EAAQ4F,KAAK,QACX,IAAI5B,MAAM4C,EAAQ,qBAIlBxJ,EAAG6E,OAAO4E,KACZA,EAAU,CACR/C,SAAU+C,IAIVzJ,EAAGqC,KAAKoH,KACV3H,EAAK2H,EACLA,EAAU,CAAC,GAGTjI,UAAUC,OAAS,IACrBgI,EAAU,CAAC,GAGTA,EAAQ/C,SACVD,EAAegD,EAAQ/C,UAEvB+C,EAAQ/C,SAAW,OAGjB1G,EAAGoE,MAAMoF,GAAQ,CACnB,GAAqB,IAAjBA,EAAM/H,OACR,OAAOsB,EAAMyG,EAAM,GAAIC,EAAS3H,GAElC,IAAI6G,EAAa9B,IACjB,OAAO6B,EAAevC,EAAOqD,GAAOT,KAAI,SAASxB,GAC/C,IAAIqB,EAAI7F,EAAMwE,EAAGkC,GAIjB,OAHIzJ,EAAGqC,KAAKP,IACV8G,EAAEvF,GAAG,SAAUsF,EAAW7G,IAErB8G,CACT,IACF,CAEA,GAAI5I,EAAGiC,KAAKuH,GACV5G,EAAQ8G,UAAUF,EAAOC,EAAS3H,GAClCwG,EAAU1F,QAGP,GAAI5C,EAAGmC,UAAUqH,GAAQ,CAC5B,IAAI7B,EAAUF,GAAU,WACtBa,EAAU1F,EACZ,IACAA,EAAQ+G,eAAeH,EAAOC,EAAS3H,EAAI6F,EAC7C,CAEA,OAAO/E,EAAQ2G,QACjB,CAnVAzD,EAAK8D,SAAS3B,EAASlC,EAAOmC,cAE9BD,EAAQtH,UAAU4I,OAAS,WACzB,IAAIA,EAAS,CAAC,EACVhD,EAAO9F,KAYX,MAXc,CACZ,KAAM,OAAQ,OACd,QAAS,WACT,YAAa,kBAAmB,kBAChC,mBAEMuG,SAAQ,SAASjG,GACvBwI,EAAOxI,GAAQ,WACb,OAAOwF,EAAKxF,GAAMkG,MAAMV,EAAM/E,UAChC,CACF,IACO+H,CACT,EAEAtB,EAAQtH,UAAUkJ,SAAW,WAC3B,OAAOpJ,KAAK4H,SACd,EAEAJ,EAAQtH,UAAUyC,MAAQ,SAAS0G,GACjC,IAAIvD,EAAO9F,KACX,GAAIqJ,EAAU,CACZ,IAAIlH,EAAUnC,KAAK0H,SAAS2B,GACxBlH,GAAWA,EAAQQ,QACrBR,EAAQQ,eACDmD,EAAK4B,SAAS2B,IAEvB5C,EAAkB4C,GAAU,SAASN,GACnCjD,EAAKnD,MAAMoG,EACb,GACF,MAEE5F,OAAOmD,KAAKR,EAAK4B,UAAUnB,SAAQ,SAASwC,GAC1C,IAAI5G,EAAU2D,EAAK4B,SAASqB,GACxB5G,GAAWA,EAAQQ,OACrBR,EAAQQ,OAEZ,IACA3C,KAAK0H,SAAW,CAAC,EAIfnI,EAAGuE,YAAYgC,EAAK4B,YAEjB1H,KAAK4H,YACR5H,KAAK4H,WAAY,EACjBlI,QAAQoI,SAASE,EAAWhI,OAGlC,EAEAwH,EAAQtH,UAAUkI,gBAAkB,SAAS/G,GAC3C,GAAI9B,EAAGqC,KAAKP,GAAK,CACf,IAAIyE,EAAO9F,KACP8F,EAAK6B,SACPtG,EAAG8B,OAAOmD,KAAKR,EAAK4B,WAEpB5B,EAAKlD,GAAG,SAAS,WACfvB,EAAG8B,OAAOmD,KAAKR,EAAK4B,UACtB,GAEJ,CACF,EAiBAF,EAAQtH,UAAUoJ,IAAM,SAASnH,EAASoH,GACxC,IAAIzD,EAAO9F,KACXuJ,EAAOA,GAAQ,CAAER,MAAO,IACxB,IAAIS,EAAclK,EAAKwF,QAAQyE,EAAKR,OACpC/I,KAAK0H,SAAS8B,GAAerH,EAG7B,IAsCIsH,EApON,SAAkBF,EAAMlI,GACtB,IAAIqB,EAAOgH,EAAQ,GACfzD,EAAWsD,EAAKP,QAAQ/C,SACxB0D,EAAQJ,EAAKP,QAAQW,MAIzB,SAASC,KAhCX,SAAqBF,GACnB,IAAIG,EAAWnE,EAAOgE,GAKlBI,EAAM,gBAgBV,OAfqBJ,EAAMK,MAAK,SAASC,GACvC,OAAOF,EAAIvG,KAAKyG,EAClB,KAGmBN,EAAMpB,KAAI,SAAS0B,GAClC,OAAOA,EAAEC,QAAQH,EAAK,GACxB,IA9DSC,MAAK,SAASlE,EAAG/E,EAAGgF,GAC7B,OAAOA,EAAKC,QAAQF,KAAO/E,CAC7B,MA8DI+I,EAAWA,EAASjE,QAAO,SAASsE,GAClC,OAAO3K,EAAG+E,OAAO4F,EACnB,KAIkBL,EA7BTvB,KAAI,SAAS9D,GACxB,OAAOjF,EAAG+E,OAAOE,GACb,CAjDW,SAiDIA,GACf,CAACe,EAAcf,EACrB,GA0BF,EAUI2F,CAAYT,GAAOnD,SAAQ,SAAS6D,GAClCA,EAAI,GAAKnG,OAAOoG,KAAKD,EAAI,IACR,WAAbnE,IACFmE,EAAI,GAAKA,EAAI,GAAG1J,SAASuF,IAE3B5E,EAAGmF,MAAM,KAAM4D,EACjB,IACA1H,EAAQ,KACRgH,EAAQ,EACV,CACA,OAdKnK,EAAG8E,OAAOsF,KACbA,EAAQ,KAaH,SAASW,EAAQhK,GACtBoJ,EAAM9I,KAAKN,GACNoC,IACHA,EAAQR,WAAW0H,EAAQD,GAE/B,CACF,CA4M2BY,CAAShB,GAAM,SAAU1G,EAAKvC,GASnD,IA9RSe,EAuRPkI,EAAKiB,YACHjB,EAAKiB,YAAYlK,IACnBwF,EAAKiC,KAAK,SAAUlF,EAAKvC,IAzRlBe,EA8RekI,EAAKP,QAAQpD,OA7RrCrG,EAAGqC,KAAKP,GACH,SAASoJ,EAAKC,GACfrJ,EAAGoJ,GAAK,IAAQC,GACtB,EAEEnL,EAAG4E,OAAO9C,GACL,SAASoJ,EAAKC,GACfrJ,EAAGkC,KAAKkH,IAAMC,GACpB,EAEK,SAASD,EAAKC,GACnBA,GACF,GAkRgBpK,GAAM,WACZwF,EAAK6E,KAAM7E,EAAK6E,KAAO,GACtB7E,EAAKiC,KAAK,SAAUlF,EAAKvC,EAChC,GAEJ,IAEA6B,EAAQS,GAAG,SAAS,SAASU,GACvBwC,EAAKsD,aAGL7J,EAAG4F,WAA0B,UAAb7B,EAAIb,MACtBN,EAAQ4F,KAAK,SAAUxC,EAAcgE,EAAKR,OAAS,IACnDjD,EAAK6E,KAAO,gBACZ7E,EAAKnD,MAAM6G,IAEX1D,EAAKiC,KAAK,QAASzE,GAEvB,IAEAnB,EAAQS,GAAG,UApEY,SAAS0H,EAAQM,GACtC,IAAI9E,EAAKsD,WAAT,CAKA,IAAI9I,EAAOsK,EACPrL,EAAGmE,IAAIpD,KACTA,EAAO,IAETA,EAAOhB,EAAKiB,KAAKgJ,EAAKR,MAAOzI,GAEzBiJ,EAAKP,QAAQzG,WACfP,GAAmB,SAAS6I,GAC1B,IAAKA,EAAK,CACR,IAAIxB,EAAW/J,EAAKwF,QAAQxE,GAEvBf,EAAG+E,OAAOhE,GAKKf,EAAGmC,UAAUpB,KACzBwF,EAAK4B,SAAS2B,IACfjC,EAAc9G,EAAMiJ,EAAKP,QAAQpD,SAGpCE,EAAKoD,eAAe5I,EAAMiJ,EAAKP,SATjClD,EAAKnD,MAAM0G,EAYf,CACF,IAGFI,EAAmBa,EAAQhK,EA/B3B,CAgCF,GAkCF,EAEAkH,EAAQtH,UAAU+I,UAAY,SAASzH,EAAMwH,EAAS3H,GACpD,IAAIe,EAAS9C,EAAKiB,KAAKiB,EAAM,OACzBsJ,EAAO3H,OAAO4H,OAAO,CAAC,EAAG/B,EAAS,CAEpCpD,OAAQ,KACRK,SAAU,gBAIL6E,EAAKvI,UAEZ,IAAIJ,EAAU/C,EAAGkD,MAAMF,EAAQ0I,GAC/B9K,KAAKsJ,IAAInH,EAAS,CAChB/B,KAAM,OACN2I,MAAO3G,EACP4G,QAAS7F,OAAO4H,OAAO,CAAC,EAAGD,EAAM,CAC/B7E,SAAU+C,EAAQ/C,WAEpBuE,YAAa,SAAShG,GACpB,OAAOjF,EAAGoF,SAASH,EAAGhD,EACxB,IAGEjC,EAAGqC,KAAKP,KACQ,IAAdA,EAAGL,QAAcsG,IACrBtH,KAAK4C,GAAG,SAAUvB,GAEtB,EAEAmG,EAAQtH,UAAUgJ,eAAiB,SAASxC,EAAKsC,EAAS3H,EAAI6F,EAAUC,GACtE,IAAIrB,EAAO9F,KACP2G,EAAOO,IACXlF,GAAmB,SAAS6I,GAE1B7B,EAAQzG,YAAcyG,EAAQzG,UAE9B,IAAIuI,EAAO3H,OAAO4H,OAAO,CAAC,EAAG/B,EAAS,CACpC/C,SAAU,SAOZ,GALK4E,UACIC,EAAKvI,UAIVuD,EAAK8B,UAEP,OADAjB,IACOb,EAAKnD,QAGd,IAAIR,EAAU/C,EAAGkD,MAAMoE,EAAKoE,GAE5BhF,EAAKwD,IAAInH,EAAS,CAChB/B,KAAM,MACN2I,MAAOrC,EACPsC,QAASA,IAGPzJ,EAAGqC,KAAKP,KACQ,IAAdA,EAAGL,QAAcsG,IACrBxB,EAAKlD,GAAG,SAAUvB,IAGhB2H,EAAQzG,YAAcsI,GACxBpE,EAAkBC,GAAK,SAASsE,GAC1B5D,EAAc4D,EAAGhC,EAAQpD,SAC3BE,EAAKoD,eAAe8B,EAAGhC,EAAS,KAAM9B,EAE1C,GAAGA,KAGLP,GACF,GACF,EA4GA7E,EAAOC,QAAUO,EACjBR,EAAOC,QAAP,QAAyBO,C,2BChhBzB,IAAY2I,E,oFAAAA,EAAA,EAAAA,YAAA,EAAAA,UAAS,KACpB,mFACA,6EAGD,MAAaC,EAIZC,iBAAoBC,EAAsBC,GACzC,GAAIH,EAAaI,UAAUF,GAC1B,IAAK,MAAMG,KAAYL,EAAaI,UAAUF,GAC7CG,EAASF,EAGZ,CAGAF,qBAAwBC,EAAsBG,GAK7C,YAJ0CtJ,IAAtCiJ,EAAaI,UAAUF,KAC1BF,EAAaI,UAAUF,GAAa,IAErCF,EAAaI,UAAUF,GAAWxK,KAAK2K,GAChCL,EAAaI,UAAUF,GAAWpK,OAAS,CACnD,CAEAmK,yBAAyBC,EAAsBI,GAC1CN,EAAaI,UAAUF,IAC1BF,EAAaI,UAAUF,GAAWK,OAAOD,EAAO,EAElD,EAzBD,iBACgB,EAAAF,UAA0C,CAAC,C,gICP3D,eAEA,QACA,SACA,SACA,SACA,SACA,SACA,SACA,SAkBOI,eAAeC,EAAgBC,EAAeL,GACpD,IAAK,MAAMM,KAASD,EAAQ,CAC3B,MAAME,EAAmBF,EAAOC,GAChC,GAAIvM,EAAKyM,WAAWD,IAEnB,QAAkE7J,IAA9DsJ,EAASjM,EAAK0M,UAAUH,GAAQvM,EAAK0M,UAAUF,IAClD,UAGK,CAEN,IAAIG,EAAYJ,EACZK,EAAeJ,EACnB,MAAMK,GAAW,IAAAC,eASjB,GARID,KACgC,IAA/B7M,EAAKyM,WAAWE,KACnBA,EAAY3M,EAAKiB,KAAK4L,EAAUN,KAEK,IAAlCvM,EAAKyM,WAAWG,KACnBA,EAAe5M,EAAKiB,KAAK4L,EAAUL,UAGqC7J,IAAtEsJ,EAASjM,EAAK0M,UAAUC,GAAY3M,EAAK0M,UAAUE,IACtD,K,EAKJ,CAEOR,eAAeW,EAASR,EAAeC,EAAkBQ,GAC/D,IAAiC,UAAvB,IAAAC,aAAYV,GAOrB,OANA,IAAAW,sBAAqB,KAAI,IAAAC,UAAS,oBAAqB,IAAAA,UAAS,iBAAmBZ,QACnFa,EAAOC,OAAOC,iBAAiB,KAAI,IAAAH,UAAS,oBAAqB,IAAAA,UAAS,iBAAmB,IAAIZ,MAAW,IAAAY,UAAS,uBAAuB,IAAAA,UAAS,YAAY,IAAAA,UAAS,WAAWjE,MAAMqE,IACtLA,IAAS,IAAAJ,UAAS,aACrB,IAAAK,WAAUjB,E,IAKb,IAAoC,UAA1B,IAAAU,aAAYT,GAErB,YADA,IAAAU,sBAAqB,KAAI,IAAAC,UAAS,oBAAqB,IAAAA,UAAS,iBAAmBX,IAGpF,IAAAiB,sBAAqB,EAAAC,eAAeC,SACpC,IAAIC,GAAe,IAAAV,sBAAqB,KAAI,IAAAC,UAAS,mBAAqBX,GACtEqB,SAAmCT,EAAOU,UAAUhO,GAAGiO,KAAKX,EAAOY,IAAI9L,KAAKsK,KAAY1L,KAC5F,GAAI+M,IAAaT,EAAOa,SAASC,UAAW,CAC3C,IAAIC,QAA2Cf,EAAOU,UAAUhO,GAAGsO,cAAchB,EAAOY,IAAI9L,KAAKsK,IACjG,IAAK,IAAIhL,EAAY,EAAGA,EAAI2M,EAAMzM,OAAQF,IAAK,CAC9C,IAAK6M,EAAUjJ,GAAU+I,EAAM3M,GAE/B,QAAiBmB,IAAb0L,IAAsD,IAA5BA,EAASC,OAAO,QAG1ClJ,IAAWgI,EAAOa,SAASM,KAAM,CACpC,IAAIxG,EAAmB/H,EAAKiB,KAAKuL,EAAU6B,GACvCG,EAAkBxO,EAAKiB,KAAKjB,EAAKyO,QAAQ1G,GAAW,MAAO/H,EAAKwD,SAASuE,GAAU4C,QAAQ3K,EAAK0O,QAAQ3G,GAAW,SACvH,IAAmC,UAAzB,IAAAkF,aAAYuB,GAErB,YADA,IAAAtB,sBAAqB,KAAI,IAAAC,UAAS,oBAAqB,IAAAA,UAAS,iBAAmBqB,SAG9E,IAAAhB,WAAUxN,EAAKiB,KAAKsL,EAAOvM,EAAKyO,QAAQJ,EAAS1D,QAAQ3K,EAAK0O,QAAQL,GAAW,WACvFvO,EAAG6B,cAAc3B,EAAKiB,KAAKsL,EAAO8B,EAAS1D,QAAQ3K,EAAK0O,QAAQL,GAAW,UAAU,IAAAM,SAAQ3B,EAAOwB,MACpG,IAAAI,yBAAwBhB,EAAc,KAAI,IAAAT,UAAS,mBAAqBkB,E,QAGpE,GAAIR,IAAaT,EAAOa,SAASM,KAAM,CAC7C,IAAIC,EAAkBxO,EAAKiB,KAAKjB,EAAKyO,QAAQjC,GAAW,MAAOxM,EAAKwD,SAASgJ,GAAU7B,QAAQ3K,EAAK0O,QAAQlC,GAAW,SACvH,IAAmC,UAAzB,IAAAS,aAAYuB,GAErB,YADA,IAAAtB,sBAAqB,KAAI,IAAAC,UAAS,oBAAqB,IAAAA,UAAS,iBAAmBqB,SAG9E,IAAAhB,WAAUjB,GAChBzM,EAAG6B,cAAc4K,GAAO,IAAAoC,SAAQ3B,EAAOwB,MACvC,IAAAI,yBAAwBhB,EAAc,KAAI,IAAAT,UAAS,mBAAqBnN,EAAKwD,SAASgJ,G,EAEvF,IAAAiB,sBAAqB,EAAAC,eAAemB,SACrC,CA9FA,uBAA4BC,GAC3B,IAAIC,EAAwC3B,EAAOU,UAAUkB,mBAAmBC,IAAI,8BAChFF,GACH1C,EAAgB0C,GAAoB,CAACxC,EAAOC,KAC3CO,EAASR,EAAOC,EAAU,EAAA0C,cAAc,IAG1C,IAAIC,EAAqC/B,EAAOU,UAAUkB,mBAAmBC,IAAI,2BAC7EE,GACH9C,EAAgB8C,GAAiB,CAAC5C,EAAOC,KACxCO,EAASR,EAAOC,EAAU,EAAA4C,WAAW,GAGxC,EAGA,oBA8BA,Y,qHCxDa,EAAAC,gCAAkC,C,4FCA/C,eACA,SACA,SACA,SACA,SACA,SAGMC,EAAoB,CAGzB,yBAA4B,EAAAC,yBAC5B,sBAAyB,EAAAC,uBAIpBC,EAA6D,CAClE,cAAiB,cAGlB,IAAIC,EACJ,MAAMC,EAAa,4BAEnB,IAAIC,EAAiDxC,EAAOU,UAAUkB,mBAAmBC,IAAIU,GAsD7F,SAASE,EAAaC,GACrB,YAAmCnN,IAA/B8M,EAAeK,IAAiDnN,MAApBiN,IAAkF,IAAjDA,EAAiBH,EAAeK,GAIlH,CArDA,OAAO1D,eAAoB0C,QAEVnM,IAAZ+M,IACHA,EAAU,EAAA9D,aAAamE,cAA+C,EAAApE,UAAUqE,mCAAmC5D,MAAOL,IACzH,IAAKA,EAAMkE,qBAAqBN,GAC/B,OAED,IAAIO,GAAa,IAAKC,MAAQC,UAC1BC,EAAoDjD,EAAOU,UAAUkB,mBAAmBC,IAAIU,GAChG,MAAM3I,EAAOnD,OAAOmD,KAAKsI,GACzB,IAAK,IAAI9N,EAAI,EAAGA,EAAIwF,EAAKtF,OAAQF,IAAK,CACrC,MAAMsO,EAAa9I,EAAKxF,GACxB,GAAI6O,GACCR,EAAaC,KAAmE,IAApDO,EAAoBZ,EAAeK,IAAwB,CAC1F,IAAIlC,GAAe,IAAAV,sBAAqB,IAAI1L,EAAI,KAAKwF,EAAKtF,WAAU,IAAAyL,UAAS,eAAc,IAAAA,UAAS2C,KAAe,UAC7GR,EAAWQ,GAAYhB,IAC7B,IAAAF,yBAAwBhB,EAAc,IAAIpM,EAAI,KAAKwF,EAAKtF,WAAU,IAAAyL,UAAS,qBAAoB,IAAAA,UAAS2C,OAAe,IAAA3C,UAAS,sBAAqB,IAAKgD,MAAQC,UAAYF,KAAa,IAAA/C,UAAS,iBAAkB,IACtN+C,GAAa,IAAKC,MAAQC,S,EAI7BR,EAAmBS,CAAmB,KAIxC,IAAIH,GAAa,IAAKC,MAAQC,UAE9B,MAAMpJ,EAAOnD,OAAOmD,KAAKsI,GACzB,IAAK,IAAI9N,EAAI,EAAGA,EAAIwF,EAAKtF,OAAQF,IAAK,CACrC,MAAMsO,EAAa9I,EAAKxF,GACxB,GAAIoO,GACCC,EAAaC,GAAa,EAC7B,IAAA5C,sBAAqB,IAAI1L,EAAI,KAAKwF,EAAKtF,WAAU,IAAAyL,UAAS,6BAA4B,IAAAA,UAAS2C,MAC/F,Q,CAGF,IAAIlC,GAAe,IAAAV,sBAAqB,IAAI1L,EAAI,KAAKwF,EAAKtF,WAAU,IAAAyL,UAAS,eAAc,IAAAA,UAAS2C,KAAe,UAE7GR,EAAWQ,GAAYhB,IAE7B,IAAAF,yBAAwBhB,EAAc,IAAIpM,EAAI,KAAKwF,EAAKtF,WAAU,IAAAyL,UAAS,qBAAoB,IAAAA,UAAS2C,OAAe,IAAA3C,UAAS,sBAAqB,IAAKgD,MAAQC,UAAYF,KAAa,IAAA/C,UAAS,iBAAkB,IACtN+C,GAAa,IAAKC,MAAQC,S,EAE3B,IAAAlD,uBAAqB,IAAAC,UAAS,aAAc,KAC5C,IAAAmD,oBAAmBC,KAAO,iBAAkB,IAAApD,UAAS,iBACtD,C,gHC3EA,eACA,SACA,QACA,SACA,SAEA,SACA,SACA,SACA,SAEA,SAEA,IAAIuC,EACAc,EACJ,MAAMb,EAAa,yBACnB,IAAIrD,EAwBJ,SAASmE,EAAW3B,GACnB,QAAoBnM,IAAhB6N,EAA2B,CAC9B,MAAM3D,GAAW,IAAAC,eACjB,GAAID,EAAU,EACb,IAAAK,sBAAqB,kBACrB,IAAI6B,EAAwC3B,EAAOU,UAAUkB,mBAAmBC,IAAI,8BACpFuB,GAAc,aAAM3D,EAAU,CAAE5J,WAAW,EAAMqD,OAAQ,WAAY,SAAU/C,EAAKvC,GAC/E+N,IACH,IAAA1C,iBAAgB0C,GAAoB,CAACxC,EAAOC,KAC3C,GAAIxM,EAAK0M,UAAUF,IAAaxM,EAAK0M,UAAU1M,EAAKyO,QAAQzN,IAAO2J,QAAQ,QAAS,IAAK,CACxF,MAAM+F,EAAS1Q,EAAKiB,KAAKsL,EAAOvM,EAAKwD,SAASxC,GAAM2J,QAAQ3K,EAAK0O,QAAQ1N,GAAO,SAIhF,OAHAlB,EAAG6B,cAAc+O,GAAQ,IAAA/B,UAAQ,IAAAO,eAAclO,MAC/C,IAAAkM,sBAAqB,eAAiBlN,EAAKwD,SAASxC,GAAM2J,QAAQ3K,EAAK0O,QAAQ1N,GAAO,UAE/E,C,IAIX,G,EAKH,CAEA,SAAS2P,IACJH,KACH,IAAAtD,sBAAqB,oBACrBsD,EAAYnN,QACZmN,OAAc7N,EAEhB,CAEA,SAASqM,IACR,IAAI4B,EAA6CxD,EAAOU,UAAUkB,mBAAmBC,IAAIU,GACzF,GAAIiB,EACH,OAAOA,EAAeC,gBAAiB,CAEzC,CA3DA,oCAAyC/B,GACxCxC,EAAS0C,IACLA,KACHyB,SAEe9N,IAAZ+M,IACHA,EAAU,EAAA9D,aAAamE,cAA+C,EAAApE,UAAUqE,mCAAoCjE,IAC9GA,EAAMkE,qBAAqBN,IAAeX,MAAuB1C,IAGtEA,EAAS0C,IACLA,KACH2B,IACAF,KAEAE,I,IAIJ,C,6GCtCA,eACA,SACA,QACA,SACA,SAEA,SACA,SACA,SACA,SACA,SAEA,IAAIjB,EACAc,EACJ,MAAMb,EAAa,yBACnB,IAAIrD,EAuBJ,SAASmE,EAAW3B,GACnB,QAAoBnM,IAAhB6N,EAA2B,CAC9B,MAAM3D,GAAW,IAAAC,eACjB,GAAID,EAAU,EACb,IAAAK,sBAAqB,kBACrB,IAAIiC,EAAqC/B,EAAOU,UAAUkB,mBAAmBC,IAAI,2BACjFuB,GAAc,aAAM3D,EAAU,CAAE5J,WAAW,EAAMqD,OAAQ,WAAY,SAAU/C,EAAKvC,GAC/EmO,IACH,IAAA9C,iBAAgB8C,GAAiB,CAAC5C,EAAOC,KACxC,GAAIxM,EAAK0M,UAAUF,IAAaxM,EAAK0M,UAAU1M,EAAKyO,QAAQzN,IAAO2J,QAAQ,QAAS,IAAK,CACxF,MAAM+F,EAAS1Q,EAAKiB,KAAKsL,EAAOvM,EAAKwD,SAASxC,GAAM2J,QAAQ3K,EAAK0O,QAAQ1N,GAAO,SAIhF,OAHAlB,EAAG6B,cAAc+O,GAAQ,IAAAI,eAAc,CAAEC,UAAU,IAAA3B,YAAWpO,OAC9D,IAAAkM,sBAAqB,eAAiBlN,EAAKwD,SAASxC,GAAM2J,QAAQ3K,EAAK0O,QAAQ1N,GAAO,UAE/E,C,IAIX,G,EAKH,CAEA,SAAS2P,IACJH,KACH,IAAAtD,sBAAqB,oBACrBsD,EAAYnN,QACZmN,OAAc7N,EAEhB,CAEA,SAASqM,IACR,IAAI4B,EAA6CxD,EAAOU,UAAUkB,mBAAmBC,IAAIU,GACzF,GAAIiB,EACH,OAAOA,EAAeI,aAAc,CAEtC,CA1DA,iCAAsClC,GACjCE,KACHyB,SAEe9N,IAAZ+M,IACHA,EAAU,EAAA9D,aAAamE,cAA+C,EAAApE,UAAUqE,mCAAoCjE,IAC9GA,EAAMkE,qBAAqBN,IAAeX,MAAuB1C,IAGtEA,EAAS0C,IACLA,KACH2B,IACAF,KAEAE,I,IAIJ,C,qNCpCA,eACA,SACA,SAEA,IAOIM,EAPAC,EAAsC9D,EAAOC,OAAO8D,oBAAoB/D,EAAOgE,mBAAmBC,KAAM,GAIxGC,EAAwC,GAExC1D,EAAe,EAEf2D,GAAa,EACjB,IAAY7D,KAAA,EAAAA,iBAAA,EAAAA,eAAc,KACzB,wBACA,4BAGD,oBAAOtB,eAAiC0C,GACvCoC,EAAcX,KAAO,oBAAqB,IAAApD,UAAS,kBACnD2B,EAAQ0C,cAAclQ,KAAK4P,GAC3BD,EAAS7D,EAAOC,OAAOoE,qBAAoB,IAAAtE,UAAS,mBACpD+D,EAAcQ,OAEd5C,EAAQ0C,cAAclQ,KAAK8L,EAAOuE,SAASC,gBAAgB,wBAAwBxF,MAAOyF,IACrFN,GACHA,GAAcA,EACdN,EAAOa,SAEPP,GAAcA,EACdN,EAAOS,O,KAGTR,EAAca,QAAU,sBACzB,EAEA,8BACC,OAAOb,CACR,EACA,gCAAqCX,EAAcyB,EAA2B,EAAA3C,iCAQ7E,OAcD,SAAuBkB,GACtBe,EAAY1D,GAAgB2C,EAC5B3C,IACA,IAAIqE,EAAU,MAAK,IAAA9E,UAAS,gCAC5B,IAAK,IAAIjB,EAAQhL,KAAKgR,IAAItE,EA3DD,GA2DmC,GAAI1B,EAAQ0B,EAAc1B,IAErF+F,GAAW,OADKX,EAAYpF,GAG7BgF,EAAce,QAAU,IAAI7E,EAAO+E,eAAeF,EACnD,CA9BCG,CAAc7B,IACY,IAAtByB,GACH5E,EAAOC,OAAOgF,oBAAoB9B,GAEnCnD,EAAOC,OAAOgF,oBAAoB9B,EAAyB,IAAnByB,GAExCf,EAAOqB,WAAW/B,GACX3C,EAAe,CACvB,EAGA,mCAAwC1B,EAAeqE,EAAcyB,EAA2B,EAAA3C,iCAC3FiC,EAAYpF,KACfoF,EAAYpF,GAASqE,GAGtBU,EAAOqB,WAAW/B,GAClBnD,EAAOC,OAAOgF,oBAAoB9B,EAAyB,IAAnByB,EACzC,EAcA,gCAAqCO,GACpCrB,EAAcX,KAAOgC,EAAQ,KAAM,IAAApF,UAAS,iBAC7C,C,8MC1EA,cACA,SAgHA,SAAgBqF,EAASC,GACxBA,EAAMA,EAAI9H,QAAQ,QAAS,MAC3B,IAAItE,EAAW,GACXqM,EAAM,EACNC,EAAM,EACV,IAAK,IAAInR,EAAI,EAAGA,EAAIiR,EAAI/Q,OAAQF,IAC/BA,EAAIoR,EAAUpR,GAEf,OAAO6E,EACP,SAASuM,EAAU1G,GAClB,IAAIqB,EAAQ,GACRgF,EAAQ,SACZ,IAAK,IAAI/Q,EAAI0K,EAAO1K,EAAIiR,EAAI/Q,OAAQF,IAAK,CACxC,IAAIH,EAASoR,EAAIjR,GACbqR,EAASrR,IAAMiR,EAAI/Q,OAAS,EAChC,GAAe,MAAXL,GAA6B,WAAVkR,EAIvB,GAAe,MAAXlR,GAA6B,WAAVkR,EAIvB,GAAe,OAAXlR,GAA6B,WAAVkR,EAAvB,CAIA,GAAe,OAAXlR,GAA6B,WAAVkR,EAOtB,YANiB5P,IAAb0D,EAAIsM,KACPtM,EAAIsM,GAAO,IAEZtM,EAAIsM,GAAKD,GAAOnF,EAChBoF,IACAD,EAAM,EACClR,EAER,GAAe,MAAXH,GAA4B,WAAVkR,EAMrB,YALiB5P,IAAb0D,EAAIsM,KACPtM,EAAIsM,GAAO,IAEZtM,EAAIsM,GAAKD,GAAOnF,EAChBmF,IACOlR,EAER,GAAIqR,GAAmB,WAAVN,EAQZ,YAPiB5P,IAAb0D,EAAIsM,KACPtM,EAAIsM,GAAO,IAEZpF,GAASlM,EACTgF,EAAIsM,GAAKD,GAAOnF,EAChBoF,IACAD,EAAM,EACClR,EAER+L,GAASlM,C,MA9BRkM,GAASlM,OAJTkR,EAAQ,cAJRA,EAAQ,Q,CAwCX,CACD,CAoBA,SAAgBO,EAAUzM,GACzB,IAAIoM,EAAc,GACdM,EAAqB1M,EAAI,GAAG3E,OAChC,IAAK,IAAIF,EAAI,EAAGA,EAAI6E,EAAI3E,OAAQF,IAAK,CACpC,MAAMwR,EAAY3M,EAAI7E,GACtB,IAAK,IAAIyR,EAAI,EAAGA,EAAID,EAAKtR,cACRiB,IAAZqQ,EAAK,IAAoC,IAAhBA,EAAKtR,QADFuR,IAAK,CAIrC,IAAIP,OAAkB/P,IAAZqQ,EAAKC,GAAmB,GAAKD,EAAKC,IAClB,IAAtBP,EAAIjM,QAAQ,OACfiM,EAAM,IAAMA,EAAM,KAEnBD,GAAOC,GAAOO,EAAI,IAAMD,EAAKtR,OAAS,GAAK,I,CAE5C,QAAgBiB,IAAZqQ,EAAK,IAAoBA,EAAKtR,OAAS,EAAG,CAC7C,IAAK,IAAIwR,EAAI,EAAGA,EAAIH,EAAaC,EAAKtR,OAAQwR,IAC7CT,GAAO,IAERA,GAAO1S,EAAGoT,G,CAEX,GAAoB,IAAhBH,EAAKtR,OAAc,CACtB,IAAK,IAAIF,EAAI,EAAGA,EAAIuR,EAAa,EAAGvR,IACnCiR,GAAO,IAERA,GAAO1S,EAAGoT,G,EAGZ,OAAOV,CACR,CAxNA,mBAAwBA,EAAUW,GAAY,GAC7C,IAAIC,EAAkBZ,EACD,iBAAV,IACVY,EAASb,EAASC,IAGnB,IAAIa,EAAkB,CAAC,EACvB,GAAIF,EACH,IAAK,IAAI5R,EAAI,EAAGA,EAAI6R,EAAO3R,OAAQF,IAAK,CACvC,IAAI+R,EAAUF,EAAO7R,GACrB8R,EAAWC,EAAQ,IAAMA,EAAQ,E,KAE5B,CAEN,GAAIF,EAAO3R,OAAS,EACnB,OAAO4R,EAER,IAAItM,EAAcqM,EAAO,GAEzB,IAAK,IAAI7R,EAAI,EAAGA,EAAI6R,EAAO3R,OAAQF,IAAK,CACvC,IAAI+R,EAAUF,EAAO7R,GACjBgS,EAAcD,EAAQ,GAC1B,GAAKC,EAAL,CAGAF,EAAWE,GAAU,CAAC,EACtB,IAAK,IAAIP,EAAI,EAAGA,EAAIM,EAAQ7R,OAAQuR,IAAK,CACxC,IAAKjM,EAAKiM,IAAkB,KAAZjM,EAAKiM,GACpB,SAED,IAAI1F,EAAQgG,EAAQN,IAAM,GAKtBQ,EAAYzM,EAAKiM,GACrB,GAAgB,oBAAZjM,EAAKiM,GACR,IAAK,IAAI/G,EAAQ,EAAGA,EAAQ,GAAIA,IAC/B,IAAKoH,EAAWE,GAAQ,kBAAoBtH,GAAQ,CACnDuH,EAAY,kBAAoBvH,EAChC,K,CAIHoH,EAAWE,GAAQC,GAAalG,C,GAIlC+F,EAAqB,SAAI,CAAC,EAC1B,IAAK,IAAIL,EAAI,EAAGA,EAAIjM,EAAKtF,OAAQuR,IAAK,CACrC,IAAIS,EAAKL,EAAO,GAAGJ,IAAM,GACrBQ,EAAYzM,EAAKiM,GACrB,GAAgB,oBAAZjM,EAAKiM,GACR,IAAK,IAAI/G,EAAQ,EAAGA,EAAQ,GAAIA,IAC/B,IAAKoH,EAAqB,SAAE,kBAAoBpH,GAAQ,CACvDuH,EAAY,kBAAoBvH,EAChCwH,EAAK,kBAAoBxH,EACzB,K,CAIHoH,EAAqB,SAAEG,GAAaC,C,EAGtC,OAAOJ,CACR,EAGA,mBAAwBK,GACvB,IAAIC,EAAQD,EAAIE,SAChB,IAAKD,EAAO,CAEXA,EAAQ,CAAC,EACT,IAAK,IAAIJ,KAAUG,EAAK,CACvB,IAAIG,EAAWH,EAAIH,GACnB,IAAK,IAAIC,KAAaK,EACrBF,EAAMH,GAAaA,C,EAKtB,IAAIJ,EAAgB,GACpBA,EAAO,GAAK,GACZA,EAAO,GAAK,GACZ,IAAK,IAAI5O,KAAOmP,EAAO,CACtB,IAAIG,EAAcH,EAAMnP,GACxB4O,EAAO,GAAG/R,KAAKyS,IACyB,IAApCtP,EAAIgC,QAAQ,mBACf4M,EAAO,GAAG/R,KAAK,mBAEf+R,EAAO,GAAG/R,KAAKmD,E,CAIjB,IAAIuP,EAAI,EACR,IAAK,IAAIR,KAAUG,EAAK,CACvB,GAAe,aAAXH,EACH,SAEDH,EAAOW,GAAK,GACZ,IAAIC,EAAYN,EAAIH,GACpB,IAAK,IAAIC,KAAaG,EAAO,CAC5B,IAAIrG,EAAQ0G,EAAUR,IAAc,GACpCJ,EAAOW,GAAG1S,KAAKiM,E,CAEhByG,G,CAED,OAAOlB,EAAUO,EAClB,EAEA,aA2DA,qBAA0BZ,GACzB,MAAMO,EAAiBP,EAAIyB,MAAMnU,EAAGoT,KACpC,IAAI9M,EAAW,GACf,IAAK,IAAI7E,EAAI,EAAGA,EAAIwR,EAAKtR,OAAQF,IAAK,CACrC6E,EAAI7E,GAAK,GAET,IAAI2S,EADqBnB,EAAKxR,GACE0S,MAAM,KACtC,GAAsB,IAAlBC,EAAOzS,OAGX,IAAK,IAAIuR,EAAI,EAAGA,EAAIkB,EAAOzS,OAAQuR,IAAK,CACvC,MAAM1F,EAAQ4G,EAAOlB,GACrB5M,EAAI7E,GAAGF,KAAKiM,E,EAGd,OAAOlH,CACR,EAEA,cA8BA,2BAAgC+N,GAC/B,OAAIA,SAA4D,KAAbA,CAKpD,EACA,4BAAiCC,GAChC,IACC,IACIC,EAAc9B,EADR1S,EAAGyU,aAAaF,EAAY,UAGlCG,EAAgBF,EAAO,GAC3B,IAAK,IAAIpI,EAAQ,EAAGA,EAAQsI,EAAO9S,OAAQwK,IAAS,CACnD,IACIuI,EADcD,EAAOtI,GACNgI,MAAM,KACrBO,EAAS/S,OAAS,IACrB8S,EAAOtI,GAASuI,E,CAIlB,IAAIC,EAAuBJ,EAAO,GAClC,GAA0B,IAAtBI,EAAWhT,aAAkCiB,IAAlB+R,EAAW,GACzC,MAAO,CAAC,EAGT,IAAIC,EAAmB,CAAC,EAEpBC,EAAe,CAAC,EACpB,IAAK,IAAIZ,EAAI,EAAGA,EAAIM,EAAO5S,OAAQsS,IAAK,CACvC,MAAMrB,EAAW2B,EAAON,GACxB,GAAmB,IAAfrB,EAAIjR,OACP,SAED,IAAImT,EACW,KAAXlC,EAAI,GACPkC,EAAUD,EAAQF,EAAW,KAG7BG,EAAU,CAAC,EACXH,EAAa,CAAC/B,EAAI,IAClBgC,EAAc,CAAC,GAEhB,IAAK,IAAIG,EAAI,EAAGA,EAAInC,EAAIjR,OAAQoT,IAAK,CACpC,IAAIpC,EAAcC,EAAImC,GACV,KAARpC,EACHgC,EAAWI,GAAKpC,EAEhBA,EAAMgC,EAAWI,GAGlB,IAAIrQ,EAAyB+P,EAAOM,GACpC,GAAIrQ,aAAeH,MAAO,CACzB,IAAIyQ,EACW,SAAXtQ,EAAI,SACiB9B,IAApBkS,EAAQpQ,EAAI,MACfoQ,EAAQpQ,EAAI,IAAM,CAAC,GAEpBsQ,EAAUF,EAAQpQ,EAAI,KAEtBsQ,EAAUF,OAGiBlS,IAAxBgS,EAAYlQ,EAAI,MACnBkQ,EAAYlQ,EAAI,IAAM,CAAC,GAIxB,IAAIyH,EAAQ,EACR8I,EAAgB9I,EAAQ,EAC5B,KAAOA,GAASzH,EAAI/C,OAAS,EAAGwK,IAAS,CACxC8I,EAAQ9I,EAAQ,EAChB,IAAI+I,EAAYN,EAAYlQ,EAAI,IAAIuQ,QAClBrS,IAAdsS,GAAyC,KAAdA,QAGJtS,IAAvBoS,EAAQE,KAGZF,EAAUA,EAAQE,G,CAInB,GADAD,EAAQ9I,EAAQ,EACY,UAAxBzH,EAAIA,EAAI/C,OAAS,GAAgB,CACpC,IAAIuT,EAAYN,EAAYlQ,EAAI,IAAIuQ,GACpC,QAAkBrS,IAAdsS,GAAyC,KAAdA,EAC9B,SAEDF,EAAQE,GAAavC,C,KACf,CACN,IAAIuC,EAAqB,KAARvC,QAAsB/P,IAAR+P,EAAqBiC,EAAYlQ,EAAI,IAAIuQ,GAAStC,EACjF,QAAkB/P,IAAdsS,GAAyC,KAAdA,EAC9B,SAEDN,EAAYlQ,EAAI,IAAIuQ,GAASC,OACFtS,IAAvBoS,EAAQE,KACXF,EAAQE,GAAa,CAAC,E,MAGlB,IAAY,KAARxQ,EACV,SAEA,QAAY9B,IAAR+P,GAA6B,KAARA,EACxB,SAEDmC,EAAQpQ,GAAOiO,C,OAGF/P,IAAXgQ,EAAI,IAA+B,KAAXA,EAAI,KAC/BiC,EAAQjC,EAAI,IAAMkC,E,CAGpB,OAAOD,C,CACN,MAAOM,GACRhR,QAAQiR,IAAID,E,CAEd,EACA,yBAA8Bb,GAC7B,IAEIO,EAAe,CAAC,EAChBN,EAAc9B,EAHR1S,EAAGyU,aAAaF,EAAY,UAKtC,MAAMG,EAAaF,EAAO,GAC1B,IAAK,IAAI9S,EAAI,EAAGA,EAAI8S,EAAO5S,OAAQF,IAAK,CACvC,MAAMmR,EAAW2B,EAAO9S,GAExB,GAAmB,IAAfmR,EAAIjR,aAA2BiB,IAAXgQ,EAAI,IAA+B,KAAXA,EAAI,GACnD,SAGD,IAAIyC,EAAuB,EACvBC,EAAwB,EACxBC,EAAsB,CAAC,EACvBC,EAAqB,CAAC,EACtBC,EAAwB,CAAC,EACzBC,EAAgB,CAAC,EACjBC,EAAiB,CAAC,EACtB,IAAK,IAAIzC,EAAI,EAAGA,EAAIN,EAAIjR,OAAQuR,IAAK,CACpC,MAAMP,EAAMC,EAAIM,GAEhB,GAAY,KAARP,EACH,SAED,IAAIjO,EAAc+P,EAAOvB,GAEzB,GAAY,mBAARxO,GAEH,GADAA,GAAO,IAAM2Q,GAAc/T,QAAQ,QACbsB,IAAlB2R,EAAO9S,EAAI,IAAsC,KAAlB8S,EAAO9S,EAAI,GAAW,CACxD,IAAI+L,EAAQ+G,EAAO9S,EAAI,GAAGyR,GAEtB0C,EAASjD,EAAIwB,MAAM,MAEnB0B,EAAWrI,EAAM2G,MAAM,MAC3BoB,EAAe7Q,GAAO,CACrBoR,UAAyC,IAA/BD,EAAS,GAAGtH,OAAO,OAAgB,cAAgB,iBAG9D,IAAK,IAAI9M,EAAI,EAAGA,EAAImU,EAAOjU,OAAQF,IAAK,CACvC,MAAMsU,EAAOH,EAAOnU,GACpB8T,EAAe7Q,GAAKqR,GAAQF,EAASpU,E,CAEtC4T,G,OAEK,GAAY,kBAAR3Q,GACV,QAAsB9B,IAAlB2R,EAAO9S,EAAI,IAAsC,KAAlB8S,EAAO9S,EAAI,GAAW,CACxD,IAAI+L,EAAQ+G,EAAO9S,EAAI,GAAGyR,GAEtB0C,EAASjD,EAAIwB,MAAM,MAEnB0B,EAAWrI,EAAM2G,MAAM,MAC3B,GAAIyB,EAAOjU,QAAU,EACpB6T,EAAcI,EAAO,IAAMC,EAAS,OAC9B,CACNL,EAAcI,EAAO,IAAM,CAAC,EAC5B,IAAK,IAAInU,EAAI,EAAGA,EAAImU,EAAOjU,OAAQF,IAAK,CACvC,MAAMsU,EAAOH,EAAOnU,GACduU,EAASH,EAASpU,GACf,GAALA,EACH+T,EAAcI,EAAO,IAAW,MAAII,EAEpCR,EAAcI,EAAO,IAAIG,GAAQC,C,SAK/B,IAA0B,GAAtBtR,EAAIgC,QAAQ,OACtB,QAAsB9D,IAAlB2R,EAAO9S,EAAI,IAAsC,KAAlB8S,EAAO9S,EAAI,GAAW,CACxD,IAAI+L,EAAQ+G,EAAO9S,EAAI,GAAGyR,GAEbP,EAAIwB,MAAM,MAER3G,EAAM2G,MAAM,MAe3BwB,EAAUhD,GAAOnF,C,MAEZ,IAAY,KAAR9I,EACV,SACM,GAAY,aAARA,GACV,QAAsB9B,IAAlB2R,EAAO9S,EAAI,IAAsC,KAAlB8S,EAAO9S,EAAI,GAAW,CACxD,IAAI+L,EAAQ+G,EAAO9S,EAAI,GAAGyR,QACJtQ,IAAlB8S,EAAS/C,KACZ+C,EAAS/C,GAAO,IAEjB+C,EAAS/C,GAAKpR,KAAKiM,E,OAEd,GAAY,qBAAR9I,GAEV,QAAsB9B,IAAlB2R,EAAO9S,EAAI,IAAsC,KAAlB8S,EAAO9S,EAAI,GAAW,CAExD,IAAImU,EAASjD,EAAIwB,MAAM,MACvB,IAAK,IAAI1S,EAAI,EAAGA,EAAImU,EAAOjU,OAAQF,IAAK,CACvC,MAAMsU,EAAOH,EAAOnU,GACpBgU,EAAiBQ,OAAOX,IAAkBS,EAC1CT,G,QAIFK,EAAUjR,GAAOiO,C,EAGf7O,OAAOmD,KAAKsO,GAAgB5T,OAAS,IACxCgU,EAAUO,eAAiBX,GAExBzR,OAAOmD,KAAKuO,GAAe7T,OAAS,IACvCgU,EAAUQ,cAAgBX,GAEvB1R,OAAOmD,KAAKyO,GAAU/T,OAAS,IAClCgU,EAAUD,SAAWA,GAElB5R,OAAOmD,KAAKwO,GAAkB9T,OAAS,IAC1CgU,EAAUS,iBAAmBX,GAE9BhU,IACAoT,EAAQjC,EAAI,IAAM+C,C,CAEnB,OAAOd,CACR,EACA,sBAA2BP,GAC1B,IAEIO,EAAe,CAAC,EAChBN,EAAc9B,EAHR1S,EAAGyU,aAAaF,EAAY,UAItC,MAAMG,EAAaF,EAAO,GAC1B,IAAK,IAAI9S,EAAI,EAAGA,EAAI8S,EAAO5S,OAAQF,IAAK,CACvC,MAAMmR,EAAW2B,EAAO9S,GACxB,GAAmB,IAAfmR,EAAIjR,QAA2B,KAAXiR,EAAI,SAAwBhQ,IAAXgQ,EAAI,GAC5C,SAGD,IAAIyD,EAAwB,EACxBC,EAAuB,CAAC,EACxBX,EAAiB,CAAC,EAElBY,EAAY,SAAUpK,GACzB,IAAIqK,EAAa,CAAC,EAClB,IAAK,IAAI/U,EAAI0K,EAAQ,EAAG1K,EAAImR,EAAIjR,OAAQF,IAAK,CAC5C,MAAMkR,EAAWC,EAAInR,GACfiD,EAAc+P,EAAOhT,GAC3B,GAAY,KAARkR,EAYQ,KAARjO,IAGH8R,EAAM9R,GAAOiO,QAdb,IAA2B,IAAvBjO,EAAI6J,OAAO,OAAe,CAC7B,IAAKkI,EAAQvD,GAAKqD,EAAU9U,GAC5BA,EAAIyR,EACApP,OAAOmD,KAAKwP,GAAQ9U,OAAS,IAChC6U,EAAM9R,EAAIyP,MAAM,OAAO,IAAMsC,E,MAExB,IAA2B,IAAvB/R,EAAI6J,OAAO,OACrB,MAAO,CAACiI,EAAO/U,E,CAUnB,EACA,IAAK,IAAIyR,EAAI,EAAGA,EAAIN,EAAIjR,OAAQuR,IAAK,CACpC,MAAMP,EAAMC,EAAIM,GAChB,IAAIxO,EAAc+P,EAAOvB,GAEzB,GAAY,KAARP,EAYJ,GAAY,oBAARjO,EAA2B,CAC9BA,EAAM2R,EAAchV,WACpB,IAAImM,EAAQmF,EACZ2D,EAAgB5R,GAAO,CAEtBgS,QAASlJ,GAEV6I,G,KAEM,IAAY,eAAR3R,GAAgC,4BAARA,GAA6C,oCAARA,GAAqD,4BAARA,GAA6C,kBAARA,EAAyB,MACvJ9B,IAAvB+S,EAAUgB,WACbhB,EAAUgB,SAAW,CAAC,GAEvBhB,EAAUgB,SAASjS,GAAOiO,EAC1B,Q,CAEM,GAAY,KAARjO,EACV,SAEAiR,EAAUjR,GAAOiO,C,MA7BjB,IAA2B,IAAvBjO,EAAI6J,OAAO,OAAe,CAC7B,IAAKiI,EAAO/U,GAAK8U,EAAUrD,GAC3BA,EAAIzR,EACAqC,OAAOmD,KAAKuP,GAAO7U,OAAS,IAC/BgU,EAAUjR,EAAIyP,MAAM,OAAO,IAAMqC,E,EA4BjC1S,OAAOmD,KAAKqP,GAAiB3U,OAAS,SACdiB,IAAvB+S,EAAUgB,WACbhB,EAAUgB,SAAW,CAAC,GAEvBhB,EAAUgB,SAASC,gBAAkBN,GAEtCzB,EAAQjC,EAAI,IAAM+C,C,CAEnB,OAAOd,CACR,C,mGC9iBA,eACA,yBACC,MAAMgC,EAAyDxJ,EAAOU,UAAU+I,iBAChF,YAAgBlU,IAAZiU,EACIA,EAAQ,GAAGE,IAAIC,YAEtB,CAEF,C,8FCRA,oBAAyBC,GAExB,QADU,oBACF/S,KAAK+S,EAId,C,4RCLA,eACA,QACA,SACA,SAGA,SAAgBC,EAAcC,EAAgBC,GAA0B,EAAMC,GAAqB,IAC3E,IAAnBD,IACHD,EAASG,EAAcH,IAGxBA,EAASA,EAAOvM,QAAQ,MAAO,IAAIA,QAAQ,QAAS,IACpD,IAAI2M,EAAa,CAAC,EACdC,EAAwB,EAC5B,IAAK,IAAI/V,EAAI,EAAGA,EAAI0V,EAAOxV,OAAQF,IAAK,CACvC,IAAIH,EAAS6V,EAAO1V,GACpB,GAAe,MAAXH,EAaW,MAAXA,GAA0C,UAAxB6V,EAAO7V,OAAOG,EAAG,KACtCA,EAAIgW,EAAQhW,QAdb,CACC,IAAIiD,EACA8I,GACH9I,EAAK8I,EAAO/L,GAAKiW,EAAajW,QAEZmB,IAAf2U,EAAM7S,KAAoC,IAAd2S,EAC/BE,EAAM7S,GAAO8I,GAEb+J,EAAM7S,EAAM8S,GAAiBhK,EAC7BgK,I,EASH,OAAOD,EAEP,SAASG,EAAaC,GACrB,IACInK,EADA9I,EAAc,GAEd8N,EAAQ,OACZ,IAAK,IAAI/Q,EAAIkW,EAAYlW,EAAI0V,EAAOxV,OAAQF,IAAK,CAChD,IAAIH,EAAS6V,EAAO1V,GAEpB,GAAe,MAAXH,GAA4B,SAAVkR,EAAtB,CAMA,GAAe,MAAXlR,GAA4B,UAAVkR,EAErB,OADChF,EAAO/L,GAAKmW,EAAWnW,GACjB,CAACiD,EAAK8I,EAAO/L,GAGrB,GAAe,MAAXH,GAA4B,UAAVkR,EAErB,OADChF,EAAO/L,GAAKoW,EAASpW,GACf,CAACiD,EAAK8I,EAAO/L,E,MAZnBiD,EAAKjD,GAAKmW,EAAWnW,GACtB+Q,EAAQ,O,CAcX,CACA,SAASqF,EAASF,GACjB,IAAIG,EAAU,CAAC,EACXtF,EAAQ,OACRgF,EAAwB,EAC5B,IAAK,IAAI/V,EAAIkW,EAAYlW,EAAI0V,EAAOxV,OAAQF,IAAK,CAChD,IAAIH,EAAS6V,EAAO1V,GACpB,GAAe,MAAXH,GAA4B,SAAVkR,EAKtB,GAAe,MAAXlR,GAA0C,gBAAxB6V,EAAO7V,OAAOG,EAAG,IAA+B,SAAV+Q,EAM5D,GAAe,MAAXlR,GAA4B,SAAVkR,GAYtB,GAAe,MAAXlR,GAA4B,SAAVkR,EACrB,MAAO,CAACsF,EAAIrW,OAbb,CACC,IAAIiD,EACA8I,GACH9I,EAAK8I,EAAO/L,GAAKiW,EAAajW,QACfmB,IAAZkV,EAAGpT,KAAoC,IAAd2S,EAC5BS,EAAGpT,GAAO8I,GAEVsK,EAAGpT,EAAM8S,GAAiBhK,EAC1BgK,I,KAdF,CACC,IAAKhB,EAAOuB,GAAYC,EAAYvW,GACpCqW,EAAKG,EAAczB,GACnB/U,EAAIsW,C,MAPJvF,EAAQ,M,CA0BX,CAEA,SAASoF,EAAWD,GACnB,IAAIO,EAAkB,GAClB1F,EAAQ,OACZ,IAAK,IAAI/Q,EAAIkW,EAAYlW,EAAI0V,EAAOxV,OAAQF,IAAK,CAChD,IAAIH,EAAS6V,EAAO1V,GAEpB,GAAe,OAAXH,GAAqC,MAAlB6V,EAAO1V,EAAI,GAKlC,GAAe,MAAXH,GAA4B,SAAVkR,GAItB,GAAc,SAAVA,EAAkB,CACrB,GAAe,MAAXlR,EACH,MAAO,CAAC4W,EAASzW,GAEjByW,GAAW5W,C,OAPZkR,EAAQ,YALR0F,GAAW5W,EACXG,G,CAeH,CAEA,SAASuW,EAAYL,GACpB,IAAInB,EAAQ,GACR2B,EAAO,EACPC,EAAQ,EACR5F,EAAQ,OACZ,IAAK,IAAI/Q,EAAIkW,EAAYlW,EAAI0V,EAAOxV,OAAQF,IAAK,CAChD,IAAIH,EAAS6V,EAAO1V,GACpB,GAAc,SAAV+Q,GAA+B,MAAXlR,EAIxB,GAAc,SAAVkR,GAUJ,GAJAgE,GAASlV,EACM,MAAXA,GACH6W,IAEc,MAAX7W,IACH8W,IACID,IAASC,GACZ,MAAO,CAAC5B,EAAO/U,OAZD,MAAXH,IACHkR,EAAQ,aALTA,EAAQ,M,CAoBX,CAEA,SAASiF,EAAQE,GAChB,IAAI1X,EAAO,GACPuS,EAAQ,OACZ,IAAK,IAAI/Q,EAAIkW,EAAYlW,EAAI0V,EAAOxV,OAAQF,IAAK,CAChD,IAAIH,EAAS6V,EAAO1V,GACpB,GAAe,MAAXH,EAIJ,GAAe,MAAXA,GAA4B,UAAVkR,EAItB,GAAc,SAAVA,OAAJ,CACC,GAAe,MAAXlR,EACH,OAAOG,EAEPxB,GAAQqB,C,MAPTkR,EAAQ,YAJRA,EAAQ,O,CAgBX,CACD,CAEA,SAAgByF,EAAcd,GAC7BA,EAASA,EAAOvM,QAAQ,gBAAiB,IAAIA,QAAQ,MAAO,IAAIA,QAAQ,OAAQ,IAAIA,QAAQ,QAAS,IAErG,IAAI2M,EAAa,GACjB,IAAK,IAAI9V,EAAI,EAAGA,EAAI0V,EAAOxV,OAAQF,IAElC,GAAe,MADF0V,EAAO1V,QACpB,CACC,IAAKmS,EAAKyE,GAAWC,EAAU7W,GAC/B8V,EAAMhW,KAAKqS,GACXnS,EAAI4W,C,CAIN,OAAOd,EAEP,SAASe,EAAUX,GAClB,IAAIG,EAAU,CAAC,EACXpT,EAAc,GACd8I,EAAgB,GAChBgF,EAAQ,OACZ,IAAK,IAAI/Q,EAAIkW,EAAYlW,EAAI0V,EAAOxV,OAAQF,IAAK,CAChD,IAAIH,EAAS6V,EAAO1V,GACpB,GAAe,MAAXH,GAA4B,SAAVkR,EAAtB,CAIA,GAAe,MAAXlR,EACH,MAAO,CAACwW,EAAIrW,GAEb,GAAc,QAAV+Q,EAAJ,CASA,GAAc,UAAVA,EAAmB,CACtB,GAA4B,UAAxB2E,EAAO7V,OAAOG,EAAG,GAAgB,CACpCqW,EAAGpT,GAAO,QACVA,EAAM,GACN8I,EAAQ,GACRgF,EAAQ,MACR/Q,GAAQ,EACR,Q,CAED,GAA4B,SAAxB0V,EAAO7V,OAAOG,EAAG,GAAe,CACnCqW,EAAGpT,GAAO,OACVA,EAAM,GACN8I,EAAQ,GACRgF,EAAQ,MACR/Q,GAAQ,EACR,Q,CAED,GAAe,MAAXH,EAAgB,CACnBkR,EAAQ,SACR,Q,CACM,GAAe,MAAXlR,EAAgB,CAE1B,IAAKsS,EAAKyE,GAAWC,EAAU7W,GAC/BqW,EAAGpT,GAAOkP,EACVlP,EAAM,GACN8I,EAAQ,GACR/L,EAAI4W,EACJ7F,EAAQ,MACR,Q,CACM,GAAe,MAAXlR,EAAgB,CAE1B,IAAKsS,EAAKyE,GAAWE,EAAU9W,GAC/BqW,EAAGpT,GAAOkP,EACVlP,EAAM,GACN8I,EAAQ,GACR/L,EAAI4W,EACJ7F,EAAQ,MACR,Q,EAC+B,KAArB,IAAAgG,UAASlX,IAA+B,MAAXA,GAA6B,MAAXA,IACzDkR,EAAQ,S,CAGV,GAAc,WAAVA,EAYJ,GAAc,WAAVA,OAAJ,CACC,IAAyB,KAArB,IAAAgG,UAASlX,IAA+B,MAAXA,GAA6B,MAAXA,EAAgB,CAClEkM,GAASlM,EACT,Q,CAEAwW,EAAGpT,GAAO8I,EACV9I,EAAM,GACN8I,EAAQ,GACR/L,IACA+Q,EAAQ,K,KArBV,CACC,GAAe,MAAXlR,EAAgB,CACnBwW,EAAGpT,GAAO8I,EACV9I,EAAM,GACN8I,EAAQ,GACRgF,EAAQ,MACR,Q,CAEAhF,GAASlM,C,MA3DX,CACC,GAAe,MAAXA,EAAgB,CACnBkR,EAAQ,QACR,Q,CAEA9N,GAAOpD,C,OAXRkR,EAAQ,K,CAmFX,CAEA,SAAS+F,EAAUZ,GAClB,IAAIrR,EAAW,GACXkM,EAAQ,OACRhF,EAAQ,GACZ,IAAK,IAAI/L,EAAIkW,EAAYlW,EAAI0V,EAAOxV,OAAQF,IAAK,CAChD,IAAIH,EAAS6V,EAAO1V,GACpB,GAAgB,MAAXH,GAA6B,MAAXA,GAA6B,SAAVkR,EAA1C,CAIA,GAAe,MAAXlR,EACH,MAAO,CAACgF,EAAK7E,GAEd,GAAc,UAAV+Q,EAAmB,CACtB,GAAe,MAAXlR,EAAgB,CACnBkR,EAAQ,SACR,Q,CACM,GAAe,MAAXlR,EAAgB,CAC1B,IAAKsS,EAAKyE,GAAWC,EAAU7W,GAC/B6E,EAAI/E,KAAKqS,GACTnS,EAAI4W,EACJ7F,EAAQ,OACR,Q,CAEAA,EAAQ,Q,CAGV,GAAc,WAAVA,EAYJ,GAAc,WAAVA,OAAJ,CACC,GAAe,MAAXlR,EAAgB,CACnBgF,EAAI/E,KAAKiM,GACTA,EAAQ,GACRgF,EAAQ,QACR,Q,CAEAhF,GAASlM,C,KAnBX,CACC,GAAe,MAAXA,EAAgB,CACnBgF,EAAI/E,KAAKiM,GACTA,EAAQ,GACR/L,IACA+Q,EAAQ,QACR,Q,CAEAhF,GAASlM,C,OA5BVkR,EAAQ,O,CA4CX,CACD,CAsEA,SAAgB8E,EAAcxF,GAC7B,IAAI2G,EAAU,GACd,MAAMxF,EAAiBnB,EAAKqC,MAAMnU,EAAGoT,KACrC,IAAK,IAAI3R,EAAI,EAAGA,EAAIwR,EAAKtR,OAAQF,IAAK,CACrC,MAAMiX,EAAmBzF,EAAKxR,GAC9B,IAAI+Q,EAAQ,EACZ,IAAK,IAAImG,EAAO,EAAGA,EAAOD,EAAS/W,OAAQgX,IAAQ,CAClD,MAAMrX,EAASoX,EAASC,GAKxB,GAJe,MAAXrX,IACHkR,EAAmB,IAAVA,EAAe,EAAI,GAGf,IAAVA,GAA0B,MAAXlR,GAAyC,MAAvBoX,EAASC,EAAO,GACpD,MAEAF,GAAWnX,C,CAGbmX,GAAWzY,EAAGoT,G,CAEf,OAAOqF,CACR,CASA,SAAgBG,EAAiBC,EAAgBjF,GAChD,GAAyB,iBAAd,EACV,OAAOA,EAER,GAAqB,iBAAV,EACV,OAAOiF,EAGR,IAAK,MAAMC,KAAKlF,EAAK,CACpB,MAAMpN,EAAIoN,EAAIkF,GAEbD,EAAQC,GADU,iBAAR,EACGF,EAAiBC,EAAQC,GAAItS,GAE7BA,C,CAIf,OAAOqS,CACR,CA/bA,kBAyKA,kBAkKA,uBAAOxM,eAAoCrC,GAE1C,IAAIsE,EAAmBtE,EAASmK,MAAM,KAAKjS,OAAS,GAChDjC,EAAO+J,EAASmK,MAAM7F,GAAU,GAEhC6I,EAASD,EAAcnX,EAAGyU,aAAaxK,EAAU,UACjD+O,EAAU5B,EAAOrT,OAAOmD,KAAKkQ,GAAQ,IACrC6B,EAAWjZ,EAAGyU,aAAaxK,EAAU,SACzCgP,EAAW1B,EAAc0B,GACzB,MAAM/F,EAAiB+F,EAAS7E,MAAMnU,EAAGoT,KACzC,IAAK,IAAI3R,EAAI,EAAGA,EAAIwR,EAAKtR,OAAQF,IAAK,CACrC,MAAMiX,EAAmBzF,EAAKxR,GAC9B,IAAuC,IAAnCiX,EAASnK,OAAO,cAAsB,CACzC,IAAI0K,EAAWP,EAASvE,MAAM,KAAK,GAEnC,IAA2C,UAAjC,IAAAjH,aAAYjN,EAAOgZ,GAE5B,SAED,IAAInB,EAAKZ,EAAcnX,EAAGyU,aAAavU,EAAOgZ,EAAU,UACpDC,EAAQpB,EAAGhU,OAAOmD,KAAK6Q,GAAI,IAC/B,IAAK,MAAMpT,KAAOwU,EAAO,CACxB,MAAM1L,EAAQ0L,EAAMxU,GACpBqU,EAAQrU,GAAO8I,C,GAMlB,OAAO2J,CACR,EAEA,kCAAO9K,eAA+CrC,GACrD,IAAIZ,EAAc,CAAC,EAEfkF,EAAmBtE,EAASmK,MAAM,KAAKjS,OAAS,GAChDjC,EAAO+J,EAASmK,MAAM7F,GAAU,GAEhC6I,EAASD,EAAcnX,EAAGyU,aAAaxK,EAAU,UAErDZ,EAAOY,GAAYmN,EAEnB,IAAI6B,EAAWjZ,EAAGyU,aAAaxK,EAAU,SACzCgP,EAAW1B,EAAc0B,GACzB,MAAM/F,EAAiB+F,EAAS7E,MAAMnU,EAAGoT,KACzC,IAAK,IAAI3R,EAAI,EAAGA,EAAIwR,EAAKtR,OAAQF,IAAK,CACrC,MAAMiX,EAAmBzF,EAAKxR,GAC9B,IAAuC,IAAnCiX,EAASnK,OAAO,cAAsB,CACzC,IAAI0K,EAAWP,EAASvE,MAAM,KAAK,GAEnC,IAA2C,UAAjC,IAAAjH,aAAYjN,EAAOgZ,GAE5B,SAED,IAAInB,EAAKZ,EAAcnX,EAAGyU,aAAavU,EAAOgZ,EAAU,UAExD7P,EAAOnJ,EAAOgZ,GAAYnB,EAC1B,IAAIoB,EAAQpB,EAAGhU,OAAOmD,KAAK6Q,GAAI,IAC/B,IAAK,MAAMpT,KAAOwU,EACHA,EAAMxU,E,EAOvB,OAAO0E,CACR,EACA,kBAuBA,oCAAyCwK,EAAYzH,EAAgB,GACpE,GAAqB,iBAAV,EAGX,OAAOyH,EAAI9P,OAAOmD,KAAK2M,GAAKzH,GAC7B,EAEA,qBAqBA,2BAAgC0M,EAAgBjF,GAC/C,GAAyB,iBAAd,EACV,OAAOA,EAER,GAAqB,iBAAV,EACV,OAAOiF,EAGR,IAAK,MAAMC,KAAKlF,EAAK,CACpB,MAAMpN,EAAIoN,EAAIkF,QACKlW,IAAfiW,EAAQC,IAAmC,OAAfD,EAAQC,KAEtCD,EAAQC,GADU,iBAAR,EACGF,EAAiBC,EAAQC,GAAItS,GAE7BA,E,CAKhB,OAAOqS,CACR,EAGA,yBAAgB9H,EAAc6C,EAAUqB,EAAgB,EAAGkE,EAAc,IACxE,IAAItV,EAAc,GAClB,GAAI+P,QACH,OAAO/P,EAGR,SAASuV,EAAYnE,EAAeoE,GACnC,IAAIF,EAAc,GAClB,IAAK,IAAIxN,EAAI,EAAGA,EAAIsJ,EAAOtJ,IAC1BwN,GAAO,KAGR,OADAA,EAAOE,CAER,CAEA,SAASC,EAAerE,EAAevQ,EAAa6U,EAAe,IAClE,IAAIJ,EAAc,GAClB,IAAK,IAAIxN,EAAI,EAAGA,EAAI4N,EAAOpY,KAAKqY,OAAe,EAARvE,EAAYvQ,EAAI/C,OAAS,GAAK,GAAIgK,IACxEwN,GAAO,KAER,OAAOA,CACR,CACA,IAAIlS,EAAOnD,OAAOmD,KAAK2M,GAAK6F,MAAK,SAAUlU,EAAGC,GAAK,OAAOkU,OAAOnU,GAAKmU,OAAOlU,EAAI,IACjF,IAAK,IAAI2G,EAAQ,EAAGA,EAAQlF,EAAKtF,OAAQwK,IAAS,CACjD,MAAMzH,EAAMuC,EAAKkF,GACXqB,EAAQoG,EAAIlP,GAClB,GAAI8I,SAA6D,iBAAZ,GAAsD,IAA9B1J,OAAOmD,KAAKuG,GAAO7L,aACzF,GAAuB,iBAAZ,EACjBkC,GAAOuV,EAAYnE,EAAO,IAAMvQ,EAAM,KACtCb,GAAOyV,EAAerE,EAAOvQ,EAAKyU,GAClCtV,GAAO,IAAM2J,EAAQ,IAAMxN,EAAGoT,SACxB,GAAY,aAAR1O,GAAyC,iBAAZ,EAAsB,CAE7Db,GAAOuV,EAAYnE,EAAO,IAAMvQ,EAAM,IAAM1E,EAAGoT,KAC/CvP,GAAOuV,EAAYnE,EAAO,IAAMjV,EAAGoT,KACnC,IAAK,MAAMuG,KAAgBnM,EAAO,CACjC,MAAMoM,EAAWpM,EAAMmM,GACvB,IAAK,MAAMjE,KAAYkE,EACtB/V,GAAOuV,EAAYnE,EAAQ,EAAG,IAAM0E,EAAe,KACnD9V,GAAOyV,EAAerE,EAAQ,EAAG0E,EAAcR,GAC/CtV,GAAO,IAAM6R,EAAW,IAAM1V,EAAGoT,G,CAGnCvP,GAAOuV,EAAYnE,EAAO,IAAMjV,EAAGoT,I,MAEnCvP,GAAOuV,EAAYnE,EAAO,IAAMvQ,EAAM,IAAM1E,EAAGoT,KAC/CvP,GAAOuV,EAAYnE,EAAO,IAAMjV,EAAGoT,KACnCvP,GAAOkN,EAAcvD,EAAOyH,EAAQ,GACpCpR,GAAOuV,EAAYnE,EAAO,IAAMjV,EAAGoT,I,CAGrC,OAAOvP,CACR,EAGA,cAAOwI,eAA2BrC,GACjC,IAAIgP,EAAWjZ,EAAGyU,aAAaxK,EAAU,SACrCZ,EAAmB,GACvB4P,EAAW1B,EAAc0B,GACzB,MAAM/F,EAAiB+F,EAAS7E,MAAMnU,EAAGoT,KACzC,IAAK,IAAI3R,EAAI,EAAGA,EAAIwR,EAAKtR,OAAQF,IAAK,CACrC,MAAMiX,EAAmBzF,EAAKxR,IACW,IAArCiX,EAASnK,OAAO,iBACnBmK,EAAS9N,QAAQ,gBAAgB,CAACrF,EAAWC,KAC5C4D,EAAO7H,KAAKiE,GACLD,I,CAMV,OAAO6D,CACR,C,oKCviBA,eACA,SAEA,IAAIyQ,EACAC,EAEJ,IAAKC,GAAL,SAAKA,GACJ,mBACA,cACA,CAHD,CAAKA,IAAAA,EAAQ,KAIb,eAAO1N,eAA4B0C,GAClC8K,EAAW,CACV,CAACE,EAASC,UAAWC,KAAKC,YAAY,IAAAC,UAAS9M,EAAOY,IAAImM,SAASrL,EAAQsL,aAAc,4BACzF,CAACN,EAASO,SAAUL,KAAKC,YAAY,IAAAC,UAAS9M,EAAOY,IAAImM,SAASrL,EAAQsL,aAAc,uBAEzFP,EAAkB,CACjB,CAACC,EAASC,UAAW,IAAKH,EAASE,EAASC,WAC5C,CAACD,EAASO,SAAU,IAAKT,EAASE,EAASO,WAE5C,IAAK,MAAM5V,KAAOoV,EAAgBC,EAASC,UAAW,CACrD,IAAIxM,EAAQsM,EAAgBC,EAASC,UAAUtV,GAC/CoV,EAAgBC,EAASC,UAAUxM,GAAS9I,SACrCoV,EAAgBC,EAASC,UAAUtV,E,CAE3C,IAAK,MAAMA,KAAOoV,EAAgBC,EAASO,SAAU,CACpD,IAAI9M,EAAQsM,EAAgBC,EAASO,SAAS5V,GAC9CoV,EAAgBC,EAASO,SAAS9M,GAAS9I,SACpCoV,EAAgBC,EAASO,SAAS5V,E,CAE3C,EAIA,oBAAyB8L,EAAc+J,EAAyBC,GAC/D,QAAiB5X,IAAbiX,QAAmCjX,IAAT4N,EAC7B,OAAOA,EAER,IAAIiK,EAAWD,GAAoC,UAAxBnN,EAAO/M,IAAIka,SAAuB,QAAU,KACnEE,EAAWb,EAASY,GACxB,QAAuB7X,IAAnB8X,EAASlK,GACZ,OAAOkK,EAASlK,GAEjB,GAAI+J,EACH,IAAK,MAAM7V,KAAO6V,EAAiB,CAClC,MAAM/M,EAAQ+M,EAAgB7V,GAC9B8L,EAAK5F,QAAQ,mBAAoB4C,E,CAGnC,OAAOgD,CACR,EAIA,2BAAgCA,EAAc+J,EAAyBC,GACtE,QAAwB5X,IAApBkX,QAA0ClX,IAAT4N,EACpC,OAAOA,EAER,IAAIiK,EAAWD,GAAoC,UAAxBnN,EAAO/M,IAAIka,SAAuB,QAAU,KACnEE,EAAWZ,EAAgBW,GAC/B,QAAuB7X,IAAnB8X,EAASlK,GACZ,OAAOkK,EAASlK,GAEjB,GAAI+J,EACH,IAAK,MAAM7V,KAAO6V,EAAiB,CAClC,MAAM/M,EAAQ+M,EAAgB7V,GAC9B8L,EAAK5F,QAAQ,mBAAoB4C,E,CAGnC,OAAOgD,CACR,EAEA,uBAA4BA,EAAcgK,GACzC,QAAiB5X,IAAbiX,EACH,OAAO,EAER,IAAIY,EAAWD,GAAoC,UAAxBnN,EAAO/M,IAAIka,SAAuB,QAAU,KAEvE,YAAuB5X,IADRiX,EAASY,GACXjK,EAId,EAEA,8BAAmCA,EAAcgK,GAChD,QAAwB5X,IAApBkX,EACH,OAAO,EAER,IAAIW,EAAWD,GAAoC,UAAxBnN,EAAO/M,IAAIka,SAAuB,QAAU,KAEvE,YAAuB5X,IADRkX,EAAgBW,GAClBjK,EAId,C,kHC7FA,cAEA,SAQA,SAAgBmK,EAAiB/G,EAAUqB,EAAgB,EAAGkE,EAAc,IAC3E,IAAItV,EAAc,GAClB,GAAI+P,QACH,OAAO/P,EAGR,SAASuV,EAAYnE,EAAeoE,GACnC,IAAIF,EAAc,GAClB,IAAK,IAAIxN,EAAI,EAAGA,EAAIsJ,EAAOtJ,IAC1BwN,GAAO,KAGR,OADAA,EAAOE,CAER,CASA,IAAIpS,EAAOnD,OAAOmD,KAAK2M,GAAK6F,MAAK,SAAUlU,EAAGC,GAAK,OAAOkU,OAAOnU,GAAKmU,OAAOlU,EAAI,IACjF,IAAK,IAAI2G,EAAQ,EAAGA,EAAQlF,EAAKtF,OAAQwK,IAAS,CACjD,MAAMzH,EAAMuC,EAAKkF,GACXqB,EAAQoG,EAAIlP,GACd8I,SAA6D,iBAAZ,GAAsD,IAA9B1J,OAAOmD,KAAKuG,GAAO7L,SAClE,iBAAZ,GACjBkC,GAAOuV,EAAYnE,EAAO,KAAOvQ,EAAM,UACX,IAAxB8I,EAAM9G,QAAQ,KACjB7C,GAAO,IAAM2J,EAAM2G,MAAM,KAAKlL,KAAK1D,IAC9B,IAAAiT,UAASjT,GACLA,EAEA,IAAIA,OAEVrE,KAAK,KAAO,KAAOlB,EAAGoT,KACf,IAAAoF,UAAShL,GACnB3J,GAAO2J,EAAQ,IAAMxN,EAAGoT,IAExBvP,GAAO,KAAO2J,EAAQ,MAAQxN,EAAGoT,MAGlCvP,GAAOuV,EAAYnE,EAAO,KAAOvQ,EAAM,SAAW1E,EAAGoT,KACrDvP,GAAO8W,EAAiBnN,EAAOyH,EAAQ,GACvCpR,GAAOuV,EAAYnE,EAAO,KAAOjV,EAAGoT,M,CAGtC,OAAOvP,CACR,CAvDA,mBAAwB+P,GACvB,IAAI9B,EAAO6I,EAAiB/G,GAE5B,OADA9B,EAAO,aAAeA,EAAO,MACtBA,CACR,EAEA,oB,yHCXA,eACA,QAKA,SAAgB5E,EAAYjN,GAC3B,OAAO,IAAIiJ,SAAQ,CAACzD,EAASmV,KAC5B7a,EAAGiO,KAAK/N,GAAM,CAACgE,EAAK4W,KAElBpV,GADGxB,GAGK4W,E,GAER,GAEJ,CAMOxO,eAAeyO,EAAQzT,GAC7B,OAAO,IAAI6B,SAAQ,CAACzD,EAASmV,KAC5B7a,EAAG8B,MAAMwF,GAAKpD,IAEZwB,GADGxB,E,GAKH,GAEJ,CA1BA,gBAgBA,YAgBA,YAAOoI,eAAeoB,EAAUpG,GAC/B,IAAI0T,QAAiB7N,EAAY7F,GAEjC,GAAI0T,IAAyB,IAAbA,GAAqBA,EAASrV,cAC7C,OAAO,EACD,GAAIqV,EACV,OAAO,EAGR,IAGIC,EAHAC,EAAUhb,EAAKia,MAAM7S,GAAKA,IAO9B,aALmBoG,EAAUwN,KAG5BD,QAAoBF,EAAQzT,IAEtB2T,CACR,C,gGCvDA,eACA,SAKA,WAAO3O,eAAwB0K,GAC9B,IAAIzS,QAAc,EAAAyJ,UAAUhO,GAAGoa,SAASpD,GACxC,OAAO,IAAI,EAAAmE,aAAcC,OAAO7W,EACjC,C,uBCTA7B,EAAOC,QAAU0Y,QAAQ,S,uBCAzB3Y,EAAOC,QAAU0Y,QAAQ,S,uBCAzB3Y,EAAOC,QAAU0Y,QAAQ,K,sBCAzB3Y,EAAOC,QAAU0Y,QAAQ,K,sBCAzB3Y,EAAOC,QAAU0Y,QAAQ,O,uBCAzB3Y,EAAOC,QAAU0Y,QAAQ,O,GCCrBC,EAA2B,CAAC,EAGhC,SAASC,EAAoBC,GAE5B,IAAIC,EAAeH,EAAyBE,GAC5C,QAAqB3Y,IAAjB4Y,EACH,OAAOA,EAAa9Y,QAGrB,IAAID,EAAS4Y,EAAyBE,GAAY,CAGjD7Y,QAAS,CAAC,GAOX,OAHA+Y,EAAoBF,GAAU9Y,EAAQA,EAAOC,QAAS4Y,GAG/C7Y,EAAOC,OACf,C,oHCtBA,eACA,SACA,SACA,SACA,SACA,SAEA,WAAO2J,eAAwB0C,SAExB,IAAA2M,cAAa3M,SACb,IAAA4M,mBAAkB5M,SAElB,IAAA6M,MAAK7M,GAEX1B,EAAOU,UAAU8N,6BAA4BxP,MAAOL,UAC7C,IAAA4P,MAAK7M,EAAQ,GACjB,KAAMA,EAAQ0C,eAGjBpE,EAAOU,UAAU+N,0BAA0B9P,IAC1C,EAAAH,aAAakQ,UAA2C,EAAAnQ,UAAUqE,kCAAmCjE,EAAM,GACzG,KAAM+C,EAAQ0C,eAEjB1C,EAAQ0C,cAAclQ,KAAK8L,EAAOuE,SAASC,gBAAgB,2BAA2B,KAAM,IAAAmK,aAAYjN,KACzG,EAEA,wBAA+B,C","sources":["webpack://vscode-war3-tools/./node_modules/_node-watch@0.7.3@node-watch/lib/has-native-recursive.js","webpack://vscode-war3-tools/./node_modules/_node-watch@0.7.3@node-watch/lib/is.js","webpack://vscode-war3-tools/./node_modules/_node-watch@0.7.3@node-watch/lib/watch.js","webpack://vscode-war3-tools/./src/class/event.ts","webpack://vscode-war3-tools/./src/command/cmdExcel2KV.ts","webpack://vscode-war3-tools/./src/enum.ts","webpack://vscode-war3-tools/./src/init.ts","webpack://vscode-war3-tools/./src/listener/listenerAbilityExcel.ts","webpack://vscode-war3-tools/./src/listener/listenerUnitExcel.ts","webpack://vscode-war3-tools/./src/module/statusBar.ts","webpack://vscode-war3-tools/./src/utils/csvUtils.ts","webpack://vscode-war3-tools/./src/utils/getRootPath.ts","webpack://vscode-war3-tools/./src/utils/isNumber.ts","webpack://vscode-war3-tools/./src/utils/kvUtils.ts","webpack://vscode-war3-tools/./src/utils/localize.ts","webpack://vscode-war3-tools/./src/utils/objToLua.ts","webpack://vscode-war3-tools/./src/utils/pathUtils.ts","webpack://vscode-war3-tools/./src/utils/readFile.ts","webpack://vscode-war3-tools/external commonjs \"vscode\"","webpack://vscode-war3-tools/external node-commonjs \"events\"","webpack://vscode-war3-tools/external node-commonjs \"fs\"","webpack://vscode-war3-tools/external node-commonjs \"os\"","webpack://vscode-war3-tools/external node-commonjs \"path\"","webpack://vscode-war3-tools/external node-commonjs \"util\"","webpack://vscode-war3-tools/webpack/bootstrap","webpack://vscode-war3-tools/./src/extension.ts"],"sourcesContent":["var fs = require('fs');\nvar os = require('os');\nvar path = require('path');\nvar is = require('./is');\n\nvar IS_SUPPORT;\nvar TEMP_DIR = os.tmpdir && os.tmpdir()\n  || process.env.TMPDIR\n  || process.env.TEMP\n  || process.cwd();\n\nfunction TempStack() {\n  this.stack = [];\n}\n\nTempStack.prototype = {\n  create: function(type, base) {\n    var name = path.join(base,\n      'node-watch-' + Math.random().toString(16).substr(2)\n    );\n    this.stack.push({ name: name, type: type });\n    return name;\n  },\n  write: function(/* file */) {\n    for (var i = 0; i < arguments.length; ++i) {\n      fs.writeFileSync(arguments[i], ' ');\n    }\n  },\n  mkdir: function(/* dirs */) {\n    for (var i = 0; i < arguments.length; ++i) {\n      fs.mkdirSync(arguments[i]);\n    }\n  },\n  cleanup: function(fn) {\n    try {\n      var temp;\n      while ((temp = this.stack.pop())) {\n        var type = temp.type;\n        var name = temp.name;\n        if (type === 'file' && is.file(name)) {\n          fs.unlinkSync(name);\n        }\n        else if (type === 'dir' && is.directory(name)) {\n          fs.rmdirSync(name);\n        }\n      }\n    }\n    finally {\n      if (is.func(fn)) fn();\n    }\n  }\n};\n\nvar pending = false;\n\nmodule.exports = function hasNativeRecursive(fn) {\n  if (!is.func(fn)) {\n    return false;\n  }\n  if (IS_SUPPORT !== undefined) {\n    return fn(IS_SUPPORT);\n  }\n\n  if (!pending) {\n    pending = true;\n  }\n  // check again later\n  else {\n    return setTimeout(function() {\n      hasNativeRecursive(fn);\n    }, 300);\n  }\n\n  var stack = new TempStack();\n  var parent = stack.create('dir', TEMP_DIR);\n  var child = stack.create('dir', parent);\n  var file = stack.create('file', child);\n\n  stack.mkdir(parent, child);\n\n  var options = { recursive: true };\n  var watcher;\n\n  try {\n    watcher = fs.watch(parent, options);\n  } catch (e) {\n    if (e.code == 'ERR_FEATURE_UNAVAILABLE_ON_PLATFORM') {\n      return fn(IS_SUPPORT = false);\n    } else {\n      throw e;\n    }\n  }\n\n  if (!watcher) {\n    return false;\n  }\n\n  var timer = setTimeout(function() {\n    watcher.close();\n    stack.cleanup(function() {\n      fn(IS_SUPPORT = false);\n    });\n  }, 200);\n\n  watcher.on('change', function(evt, name) {\n    if (path.basename(file) === path.basename(name)) {\n      watcher.close();\n      clearTimeout(timer);\n      stack.cleanup(function() {\n        fn(IS_SUPPORT = true);\n      });\n    }\n  });\n  stack.write(file);\n}\n","var fs = require('fs');\nvar path = require('path');\nvar os = require('os');\n\nfunction matchObject(item, str) {\n  return Object.prototype.toString.call(item)\n    === '[object ' + str + ']';\n}\n\nfunction checkStat(name, fn) {\n  try {\n    return fn(name);\n  } catch (err) {\n    if (/^(ENOENT|EPERM|EACCES)$/.test(err.code)) {\n      if (err.code !== 'ENOENT') {\n        console.warn('Warning: Cannot access %s', name);\n      }\n      return false;\n    }\n    throw err;\n  }\n}\n\nvar is = {\n  nil: function(item) {\n    return item == null;\n  },\n  array: function(item) {\n    return Array.isArray(item);\n  },\n  emptyObject: function(item) {\n    for (var key in item) {\n      return false;\n    }\n    return true;\n  },\n  buffer: function(item) {\n    return Buffer.isBuffer(item);\n  },\n  regExp: function(item) {\n    return matchObject(item, 'RegExp');\n  },\n  string: function(item) {\n    return matchObject(item, 'String');\n  },\n  func: function(item) {\n    return typeof item === 'function';\n  },\n  number: function(item) {\n    return matchObject(item, 'Number');\n  },\n  exists: function(name) {\n    return fs.existsSync(name);\n  },\n  file: function(name) {\n    return checkStat(name, function(n) {\n      return fs.statSync(n).isFile()\n    });\n  },\n  samePath: function(a, b) {\n    return path.resolve(a) === path.resolve(b);\n  },\n  directory: function(name) {\n    return checkStat(name, function(n) {\n      return fs.statSync(n).isDirectory()\n    });\n  },\n  symbolicLink: function(name) {\n    return checkStat(name, function(n) {\n      return fs.lstatSync(n).isSymbolicLink();\n    });\n  },\n  windows: function() {\n    return os.platform() === 'win32';\n  }\n};\n\nmodule.exports = is;\n","var fs = require('fs');\nvar path = require('path');\nvar util = require('util');\nvar events = require('events');\n\nvar hasNativeRecursive = require('./has-native-recursive');\nvar is = require('./is');\n\nvar EVENT_UPDATE = 'update';\nvar EVENT_REMOVE = 'remove';\n\nvar SKIP_FLAG = Symbol('skip');\n\nfunction hasDup(arr) {\n  return arr.some(function(v, i, self) {\n    return self.indexOf(v) !== i;\n  });\n}\n\nfunction unique(arr) {\n  return arr.filter(function(v, i, self) {\n    return self.indexOf(v) === i;\n  });\n}\n\n// One level flat\nfunction flat1(arr) {\n  return arr.reduce(function(acc, v) {\n    return acc.concat(v);\n  }, []);\n}\n\nfunction assertEncoding(encoding) {\n  if (encoding && encoding !== 'buffer' && !Buffer.isEncoding(encoding)) {\n    throw new Error('Unknown encoding: ' + encoding);\n  }\n}\n\nfunction guard(fn) {\n  if (is.func(fn)) {\n    return function(arg, action) {\n      if (fn(arg, false)) action();\n    }\n  }\n  if (is.regExp(fn)) {\n    return function(arg, action) {\n      if (fn.test(arg)) action();\n    }\n  }\n  return function(arg, action) {\n    action();\n  }\n}\n\nfunction composeMessage(names) {\n  return names.map(function(n) {\n    return is.exists(n)\n      ? [EVENT_UPDATE, n]\n      : [EVENT_REMOVE, n];\n  });\n}\n\nfunction getMessages(cache) {\n  var filtered = unique(cache);\n\n  // Saving file from an editor? If so, assuming the\n  // non-existed files in the cache are temporary files\n  // generated by an editor and thus be filtered.\n  var reg = /~$|^\\.#|^##$/g;\n  var hasSpecialChar = cache.some(function(c) {\n    return reg.test(c);\n  });\n\n  if (hasSpecialChar) {\n    var dup = hasDup(cache.map(function(c) {\n      return c.replace(reg, '');\n    }));\n    if (dup) {\n      filtered = filtered.filter(function(m) {\n        return is.exists(m);\n      });\n    }\n  }\n\n  return composeMessage(filtered);\n}\n\nfunction debounce(info, fn) {\n  var timer, cache = [];\n  var encoding = info.options.encoding;\n  var delay = info.options.delay;\n  if (!is.number(delay)) {\n    delay = 200;\n  }\n  function handle() {\n    getMessages(cache).forEach(function(msg) {\n      msg[1] = Buffer.from(msg[1]);\n      if (encoding !== 'buffer') {\n        msg[1] = msg[1].toString(encoding);\n      }\n      fn.apply(null, msg);\n    });\n    timer = null;\n    cache = [];\n  }\n  return function(rawEvt, name) {\n    cache.push(name);\n    if (!timer) {\n      timer = setTimeout(handle, delay);\n    }\n  }\n}\n\nfunction createDupsFilter() {\n  var memo = {};\n  return function(fn) {\n    return function(evt, name) {\n      memo[evt + name] = [evt, name];\n      setTimeout(function() {\n        Object.keys(memo).forEach(function(n) {\n          fn.apply(null, memo[n]);\n        });\n        memo = {};\n      });\n    }\n  }\n}\n\nfunction getSubDirectories(dir, fn, done = function() {}) {\n  if (is.directory(dir)) {\n    fs.readdir(dir, function(err, all) {\n      if (err) {\n        // don't throw permission errors.\n        if (/^(EPERM|EACCES)$/.test(err.code)) {\n          console.warn('Warning: Cannot access %s.', dir);\n        } else {\n          throw err;\n        }\n      }\n      else {\n        all.forEach(function(f) {\n          var sdir = path.join(dir, f);\n          if (is.directory(sdir)) fn(sdir);\n        });\n        done();\n      }\n    });\n  } else {\n    done();\n  }\n}\n\nfunction semaphore(final) {\n  var counter = 0;\n  return function start() {\n    counter++;\n    return function stop() {\n      counter--;\n      if (counter === 0) final();\n    };\n  };\n}\n\nfunction nullCounter() {\n  return function nullStop() {};\n}\n\nfunction shouldNotSkip(filePath, filter) {\n  // watch it only if the filter is not function\n  // or not being skipped explicitly.\n  return !is.func(filter) || filter(filePath, SKIP_FLAG) !== SKIP_FLAG;\n}\n\nvar deprecationWarning = util.deprecate(\n  function() {},\n  '(node-watch) First param in callback function\\\n  is replaced with event name since 0.5.0, use\\\n  `(evt, filename) => {}` if you want to get the filename'\n);\n\nfunction Watcher() {\n  events.EventEmitter.call(this);\n  this.watchers = {};\n  this._isReady = false;\n  this._isClosed = false;\n}\n\nutil.inherits(Watcher, events.EventEmitter);\n\nWatcher.prototype.expose = function() {\n  var expose = {};\n  var self = this;\n  var methods = [\n    'on', 'emit', 'once',\n    'close', 'isClosed',\n    'listeners', 'setMaxListeners', 'getMaxListeners',\n    'getWatchedPaths'\n  ];\n  methods.forEach(function(name) {\n    expose[name] = function() {\n      return self[name].apply(self, arguments);\n    }\n  });\n  return expose;\n}\n\nWatcher.prototype.isClosed = function() {\n  return this._isClosed;\n}\n\nWatcher.prototype.close = function(fullPath) {\n  var self = this;\n  if (fullPath) {\n    var watcher = this.watchers[fullPath];\n    if (watcher && watcher.close) {\n      watcher.close();\n      delete self.watchers[fullPath];\n    }\n    getSubDirectories(fullPath, function(fpath) {\n      self.close(fpath);\n    });\n  }\n  else {\n    Object.keys(self.watchers).forEach(function(fpath) {\n      var watcher = self.watchers[fpath];\n      if (watcher && watcher.close) {\n        watcher.close();\n      }\n    });\n    this.watchers = {};\n  }\n  // Do not close the Watcher unless all child watchers are closed.\n  // https://github.com/yuanchuan/node-watch/issues/75\n  if (is.emptyObject(self.watchers)) {\n    // should emit once\n    if (!this._isClosed) {\n      this._isClosed = true;\n      process.nextTick(emitClose, this);\n    }\n  }\n}\n\nWatcher.prototype.getWatchedPaths = function(fn) {\n  if (is.func(fn)) {\n    var self = this;\n    if (self._isReady) {\n      fn(Object.keys(self.watchers));\n    } else {\n      self.on('ready', function() {\n        fn(Object.keys(self.watchers));\n      });\n    }\n  }\n}\n\nfunction emitReady(self) {\n  if (!self._isReady) {\n    self._isReady = true;\n    // do not call emit for 'ready' until after watch() has returned,\n    // so that consumer can call on().\n    process.nextTick(function () {\n      self.emit('ready');\n    });\n  }\n}\n\nfunction emitClose(self) {\n  self.emit('close');\n}\n\nWatcher.prototype.add = function(watcher, info) {\n  var self = this;\n  info = info || { fpath: '' };\n  var watcherPath = path.resolve(info.fpath);\n  this.watchers[watcherPath] = watcher;\n\n  // Internal callback for handling fs.FSWatcher 'change' events\n  var internalOnChange = function(rawEvt, rawName) {\n    if (self.isClosed()) {\n      return;\n    }\n\n    // normalise lack of name and convert to full path\n    var name = rawName;\n    if (is.nil(name)) {\n      name = '';\n    }\n    name = path.join(info.fpath, name);\n\n    if (info.options.recursive) {\n      hasNativeRecursive(function(has) {\n        if (!has) {\n          var fullPath = path.resolve(name);\n          // remove watcher on removal\n          if (!is.exists(name)) {\n            self.close(fullPath);\n          }\n          // watch new created directory\n          else {\n            var shouldWatch = is.directory(name)\n              && !self.watchers[fullPath]\n              && shouldNotSkip(name, info.options.filter);\n\n            if (shouldWatch) {\n              self.watchDirectory(name, info.options);\n            }\n          }\n        }\n      });\n    }\n\n    handlePublicEvents(rawEvt, name);\n  };\n\n  // Debounced based on the 'delay' option\n  var handlePublicEvents = debounce(info, function (evt, name) {\n    // watch single file\n    if (info.compareName) {\n      if (info.compareName(name)) {\n        self.emit('change', evt, name);\n      }\n    }\n    // watch directory\n    else {\n      var filterGuard = guard(info.options.filter);\n      filterGuard(name, function() {\n        if (self.flag) self.flag = '';\n        else self.emit('change', evt, name);\n      });\n    }\n  });\n\n  watcher.on('error', function(err) {\n    if (self.isClosed()) {\n      return;\n    }\n    if (is.windows() && err.code === 'EPERM') {\n      watcher.emit('change', EVENT_REMOVE, info.fpath && '');\n      self.flag = 'windows-error';\n      self.close(watcherPath);\n    } else {\n      self.emit('error', err);\n    }\n  });\n\n  watcher.on('change', internalOnChange);\n}\n\nWatcher.prototype.watchFile = function(file, options, fn) {\n  var parent = path.join(file, '../');\n  var opts = Object.assign({}, options, {\n    // no filter for single file\n    filter: null,\n    encoding: 'utf8'\n  });\n\n  // no need to watch recursively\n  delete opts.recursive;\n\n  var watcher = fs.watch(parent, opts);\n  this.add(watcher, {\n    type: 'file',\n    fpath: parent,\n    options: Object.assign({}, opts, {\n      encoding: options.encoding\n    }),\n    compareName: function(n) {\n      return is.samePath(n, file);\n    }\n  });\n\n  if (is.func(fn)) {\n    if (fn.length === 1) deprecationWarning();\n    this.on('change', fn);\n  }\n}\n\nWatcher.prototype.watchDirectory = function(dir, options, fn, counter = nullCounter) {\n  var self = this;\n  var done = counter();\n  hasNativeRecursive(function(has) {\n    // always specify recursive\n    options.recursive = !!options.recursive;\n    // using utf8 internally\n    var opts = Object.assign({}, options, {\n      encoding: 'utf8'\n    });\n    if (!has) {\n      delete opts.recursive;\n    }\n\n    // check if it's closed before calling watch.\n    if (self._isClosed) {\n      done();\n      return self.close();\n    }\n\n    var watcher = fs.watch(dir, opts);\n\n    self.add(watcher, {\n      type: 'dir',\n      fpath: dir,\n      options: options\n    });\n\n    if (is.func(fn)) {\n      if (fn.length === 1) deprecationWarning();\n      self.on('change', fn);\n    }\n\n    if (options.recursive && !has) {\n      getSubDirectories(dir, function(d) {\n        if (shouldNotSkip(d, options.filter)) {\n          self.watchDirectory(d, options, null, counter);\n        }\n      }, counter());\n    }\n\n    done();\n  });\n}\n\nfunction composeWatcher(watchers) {\n  var watcher = new Watcher();\n  var filterDups = createDupsFilter();\n  var counter = watchers.length;\n\n  watchers.forEach(function(w) {\n    w.on('change', filterDups(function(evt, name) {\n      watcher.emit('change', evt, name);\n    }));\n    w.on('error', function(err) {\n      watcher.emit('error', err);\n    });\n    w.on('ready', function() {\n      if (!(--counter)) {\n        emitReady(watcher);\n      }\n    });\n  });\n\n  watcher.close = function() {\n    watchers.forEach(function(w) {\n      w.close();\n    });\n    process.nextTick(emitClose, watcher);\n  }\n\n  watcher.getWatchedPaths = function(fn) {\n    if (is.func(fn)) {\n      var promises = watchers.map(function(w) {\n        return new Promise(function(resolve) {\n          w.getWatchedPaths(resolve);\n        });\n      });\n      Promise.all(promises).then(function(result) {\n        var ret = unique(flat1(result));\n        fn(ret);\n      });\n    }\n  }\n\n  return watcher.expose();\n}\n\nfunction watch(fpath, options, fn) {\n  var watcher = new Watcher();\n\n  if (is.buffer(fpath)) {\n    fpath = fpath.toString();\n  }\n\n  if (!is.array(fpath) && !is.exists(fpath)) {\n    watcher.emit('error',\n      new Error(fpath + ' does not exist.')\n    );\n  }\n\n  if (is.string(options)) {\n    options = {\n      encoding: options\n    }\n  }\n\n  if (is.func(options)) {\n    fn = options;\n    options = {};\n  }\n\n  if (arguments.length < 2) {\n    options = {};\n  }\n\n  if (options.encoding) {\n    assertEncoding(options.encoding);\n  } else {\n    options.encoding = 'utf8';\n  }\n\n  if (is.array(fpath)) {\n    if (fpath.length === 1) {\n      return watch(fpath[0], options, fn);\n    }\n    var filterDups = createDupsFilter();\n    return composeWatcher(unique(fpath).map(function(f) {\n      var w = watch(f, options);\n      if (is.func(fn)) {\n        w.on('change', filterDups(fn));\n      }\n      return w;\n    }));\n  }\n\n  if (is.file(fpath)) {\n    watcher.watchFile(fpath, options, fn);\n    emitReady(watcher);\n  }\n\n  else if (is.directory(fpath)) {\n    var counter = semaphore(function () {\n      emitReady(watcher);\n    });\n    watcher.watchDirectory(fpath, options, fn, counter);\n  }\n\n  return watcher.expose();\n}\n\nmodule.exports = watch;\nmodule.exports.default = watch;\n","\r\nexport enum EventType {\r\n\tEVENT_ON_DID_CHANGE_WORKSPACE_FOLDERS,\r\n\tEVENT_ON_DID_CHANGE_CONFIGURATION,\r\n}\r\n\r\nexport class EventManager {\r\n\tprivate static eventList: { [k: number]: Function[]; } = {};\r\n\r\n\t/** 发起事件 */\r\n\tstatic fireEvent<T>(eventType: EventType, event: T) {\r\n\t\tif (EventManager.eventList[eventType]) {\r\n\t\t\tfor (const callback of EventManager.eventList[eventType]) {\r\n\t\t\t\tcallback(event);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/** 监听事件 */\r\n\tstatic listenToEvent<T>(eventType: EventType, callback: (event: T) => void) {\r\n\t\tif (EventManager.eventList[eventType] === undefined) {\r\n\t\t\tEventManager.eventList[eventType] = [];\r\n\t\t}\r\n\t\tEventManager.eventList[eventType].push(callback);\r\n\t\treturn EventManager.eventList[eventType].length - 1;\r\n\t}\r\n\t/** 停止监听事件 */\r\n\tstatic stopListenToEvent(eventType: EventType, index: number) {\r\n\t\tif (EventManager.eventList[eventType]) {\r\n\t\t\tEventManager.eventList[eventType].splice(index, 1);\r\n\t\t}\r\n\t}\r\n}","import * as vscode from 'vscode';\r\nimport * as os from 'os';\r\nimport * as path from 'path';\r\nimport * as fs from 'fs';\r\nimport { abilityCSV2KV, unitCSV2KV } from '../utils/csvUtils';\r\nimport { getRootPath } from '../utils/getRootPath';\r\nimport { changeStatusBarState, refreshStatusBarMessage, showStatusBarMessage, StatusBarState } from '../module/statusBar';\r\nimport { localize } from '../utils/localize';\r\nimport { dirExists, getPathInfo } from '../utils/pathUtils';\r\nimport { obj2Lua, writeKeyValueLua } from '../utils/objToLua';\r\n\r\nexport function cmdExcel2KV(context: vscode.ExtensionContext) {\r\n\tlet abilityExcelConfig: Table | undefined = vscode.workspace.getConfiguration().get('war3-tools.A2.AbilityExcel');\r\n\tif (abilityExcelConfig) {\r\n\t\teachExcelConfig(abilityExcelConfig, (kvDir, excelDir) => {\r\n\t\t\texcel2kv(kvDir, excelDir, abilityCSV2KV);\r\n\t\t});\r\n\t}\r\n\tlet unitExcelConfig: Table | undefined = vscode.workspace.getConfiguration().get('war3-tools.A2.UnitExcel');\r\n\tif (unitExcelConfig) {\r\n\t\teachExcelConfig(unitExcelConfig, (kvDir, excelDir) => {\r\n\t\t\texcel2kv(kvDir, excelDir, unitCSV2KV);\r\n\t\t});\r\n\t}\r\n}\r\n\r\n/** 遍历excel配置表 */\r\nexport async function eachExcelConfig(config: Table, callback: (kvDir: string, excelDir: string) => Promise<void> | boolean | void) {\r\n\tfor (const kvDir in config) {\r\n\t\tconst excelDir: string = config[kvDir];\r\n\t\tif (path.isAbsolute(excelDir)) {\r\n\t\t\t// 绝对路径\r\n\t\t\tif (callback(path.normalize(kvDir), path.normalize(excelDir)) !== undefined) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t// excel2kv(kvDir, excelDir, method);\r\n\t\t} else {\r\n\t\t\t// 相对路径\r\n\t\t\tlet realKvDir = kvDir;\r\n\t\t\tlet realExcelDir = excelDir;\r\n\t\t\tconst rootPath = getRootPath();\r\n\t\t\tif (rootPath) {\r\n\t\t\t\tif (path.isAbsolute(realKvDir) === false) {\r\n\t\t\t\t\trealKvDir = path.join(rootPath, kvDir);\r\n\t\t\t\t}\r\n\t\t\t\tif (path.isAbsolute(realExcelDir) === false) {\r\n\t\t\t\t\trealExcelDir = path.join(rootPath, excelDir);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (callback(path.normalize(realKvDir), path.normalize(realExcelDir)) !== undefined) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t// excel2kv(realKvDir, realExcelDir, method);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport async function excel2kv(kvDir: string, excelDir: string, method: typeof abilityCSV2KV | typeof unitCSV2KV) {\r\n\tif (await getPathInfo(kvDir) === false) {\r\n\t\tshowStatusBarMessage(`[${localize(\"cmdExcel2KV\")}]：` + localize(\"path_no_found\") + kvDir);\r\n\t\tvscode.window.showErrorMessage(`[${localize(\"cmdExcel2KV\")}]：` + localize(\"path_no_found\") + `(${kvDir})` + localize(\"sure create folder\"), localize(\"confirm\"), localize(\"cancel\")).then((value) => {\r\n\t\t\tif (value == localize(\"confirm\")) {\r\n\t\t\t\tdirExists(kvDir);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn;\r\n\t}\r\n\tif (await getPathInfo(excelDir) === false) {\r\n\t\tshowStatusBarMessage(`[${localize(\"cmdExcel2KV\")}]：` + localize(\"path_no_found\") + excelDir);\r\n\t\treturn;\r\n\t}\r\n\tchangeStatusBarState(StatusBarState.LOADING);\r\n\tlet messageIndex = showStatusBarMessage(`[${localize(\"cmdExcel2KV\")}]：` + excelDir);\r\n\tlet fileType: vscode.FileType = (await vscode.workspace.fs.stat(vscode.Uri.file(excelDir))).type;\r\n\tif (fileType === vscode.FileType.Directory) {\r\n\t\tlet files: [string, vscode.FileType][] = await vscode.workspace.fs.readDirectory(vscode.Uri.file(excelDir));\r\n\t\tfor (let i: number = 0; i < files.length; i++) {\r\n\t\t\tlet [fileName, isFile] = files[i];\r\n\t\t\t// 排除临时文件\r\n\t\t\tif (fileName === undefined || fileName.search(/~\\$/) !== -1) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (isFile === vscode.FileType.File) {\r\n\t\t\t\tlet filePath: string = path.join(excelDir, fileName);\r\n\t\t\t\tlet csvPath: string = path.join(path.dirname(filePath), 'csv', path.basename(filePath).replace(path.extname(filePath), '.csv'));\r\n\t\t\t\tif (await getPathInfo(csvPath) === false) {\r\n\t\t\t\t\tshowStatusBarMessage(`[${localize(\"cmdExcel2KV\")}]：` + localize(\"path_no_found\") + csvPath);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tawait dirExists(path.join(kvDir, path.dirname(fileName.replace(path.extname(fileName), '.lua'))));\r\n\t\t\t\tfs.writeFileSync(path.join(kvDir, fileName.replace(path.extname(fileName), '.lua')), obj2Lua(method(csvPath)));\r\n\t\t\t\trefreshStatusBarMessage(messageIndex, `[${localize(\"cmdExcel2KV\")}]：` + fileName);\r\n\t\t\t}\r\n\t\t}\r\n\t} else if (fileType === vscode.FileType.File) {\r\n\t\tlet csvPath: string = path.join(path.dirname(excelDir), 'csv', path.basename(excelDir).replace(path.extname(excelDir), '.csv'));\r\n\t\tif (await getPathInfo(csvPath) === false) {\r\n\t\t\tshowStatusBarMessage(`[${localize(\"cmdExcel2KV\")}]：` + localize(\"path_no_found\") + csvPath);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tawait dirExists(kvDir);\r\n\t\tfs.writeFileSync(kvDir, obj2Lua(method(csvPath)));\r\n\t\trefreshStatusBarMessage(messageIndex, `[${localize(\"cmdExcel2KV\")}]：` + path.basename(excelDir));\r\n\t}\r\n\tchangeStatusBarState(StatusBarState.ALL_DONE);\r\n}","/** 消息栏信息过期时间 */\r\nexport const ENUM_STATUS_BAR_MESSAGE_TIMEOUT = 5;","/* eslint-disable @typescript-eslint/naming-convention */\r\nimport * as vscode from 'vscode';\r\nimport { listenerAbilityExcelInit } from './listener/listenerAbilityExcel';\r\nimport { listenerUnitExcelInit } from './listener/listenerUnitExcel';\r\nimport { getStatusBarItem, refreshStatusBarMessage, showStatusBarMessage, statusBarItemInit } from './module/statusBar';\r\nimport { localize, localizeInit } from './utils/localize';\r\nimport { EventManager, EventType } from \"./class/event\";\r\n\r\n/** 模块列表 */\r\nconst moduleList: Table = {\r\n\t// \"localizeInit\": localizeInit,\r\n\t// \"statusBarItemInit\": statusBarItemInit,\r\n\t\"listenerAbilityExcelInit\": listenerAbilityExcelInit,\r\n\t\"listenerUnitExcelInit\": listenerUnitExcelInit,\r\n};\r\n\r\n/** 跳过的模块对应的用户设置 */\r\nconst skipModuleList: { [key: string]: keyof ModuleListConfig; } = {\r\n\t\"addonInfoInit\": \"addon_info\",\r\n};\r\n\r\nlet eventID: number;\r\nconst configName = \"war3-tools.A1.module_list\";\r\n/** 用户设置 */\r\nlet moduleListConfig: ModuleListConfig | undefined = vscode.workspace.getConfiguration().get(configName);\r\n\r\n/**\r\n * 进行初始化操作\r\n * @param context \r\n */\r\nexport async function init(context: vscode.ExtensionContext) {\r\n\t// 监听配置变更\r\n\tif (eventID === undefined) {\r\n\t\teventID = EventManager.listenToEvent<vscode.ConfigurationChangeEvent>(EventType.EVENT_ON_DID_CHANGE_CONFIGURATION, async (event) => {\r\n\t\t\tif (!event.affectsConfiguration(configName)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet timeRecord = (new Date()).valueOf();\r\n\t\t\tlet newModuleListConfig: ModuleListConfig | undefined = vscode.workspace.getConfiguration().get(configName);\r\n\t\t\tconst keys = Object.keys(moduleList);\r\n\t\t\tfor (let i = 0; i < keys.length; i++) {\r\n\t\t\t\tconst moduleName = keys[i];\r\n\t\t\t\tif (newModuleListConfig) {\r\n\t\t\t\t\tif (isSkipModule(moduleName) && newModuleListConfig[skipModuleList[moduleName]] !== false) {\r\n\t\t\t\t\t\tlet messageIndex = showStatusBarMessage(`[${i + 1}/${keys.length}]${localize(\"loading\")}：${localize(moduleName)}`, 20);\r\n\t\t\t\t\t\tawait moduleList[moduleName](context);\r\n\t\t\t\t\t\trefreshStatusBarMessage(messageIndex, `[${i + 1}/${keys.length}]${localize(\"load_complete\")}：${localize(moduleName)}，${localize(\"time_consuming\")}：${(new Date()).valueOf() - timeRecord}${localize(\"millisecond\")}`, 20);\r\n\t\t\t\t\t\ttimeRecord = (new Date()).valueOf();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tmoduleListConfig = newModuleListConfig;\r\n\t\t});\r\n\t}\r\n\r\n\tlet timeRecord = (new Date()).valueOf();\r\n\r\n\tconst keys = Object.keys(moduleList);\r\n\tfor (let i = 0; i < keys.length; i++) {\r\n\t\tconst moduleName = keys[i];\r\n\t\tif (moduleListConfig) {\r\n\t\t\tif (isSkipModule(moduleName)) {\r\n\t\t\t\tshowStatusBarMessage(`[${i + 1}/${keys.length}]${localize(\"skip_disabled_modules\")}：${localize(moduleName)}`);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet messageIndex = showStatusBarMessage(`[${i + 1}/${keys.length}]${localize(\"loading\")}：${localize(moduleName)}`, 20);\r\n\r\n\t\tawait moduleList[moduleName](context);\r\n\r\n\t\trefreshStatusBarMessage(messageIndex, `[${i + 1}/${keys.length}]${localize(\"load_complete\")}：${localize(moduleName)}，${localize(\"time_consuming\")}：${(new Date()).valueOf() - timeRecord}${localize(\"millisecond\")}`, 20);\r\n\t\ttimeRecord = (new Date()).valueOf();\r\n\t}\r\n\tshowStatusBarMessage(localize(\"allLoaded\"), 20);\r\n\tgetStatusBarItem().text = \"$(check-all) \" + localize(\"pluginNameLite\");\r\n}\r\n\r\n/** 禁用模块判断 */\r\nfunction isSkipModule(moduleName: string) {\r\n\tif (skipModuleList[moduleName] !== undefined && moduleListConfig != undefined && moduleListConfig[skipModuleList[moduleName]] === false) {\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}","import * as vscode from \"vscode\";\r\nimport * as fs from \"fs\";\r\nimport * as path from \"path\";\r\nimport watch from \"node-watch\";\r\nimport { EventManager, EventType } from \"../class/event\";\r\nimport { localize } from \"../utils/localize\";\r\nimport { getRootPath } from \"../utils/getRootPath\";\r\nimport { eachExcelConfig, excel2kv } from \"../command/cmdExcel2KV\";\r\nimport { abilityCSV2KV } from \"../utils/csvUtils\";\r\nimport { showStatusBarMessage } from \"../module/statusBar\";\r\nimport { writeKeyValue } from \"../utils/kvUtils\";\r\nimport { obj2Lua } from \"../utils/objToLua\";\r\n\r\nlet eventID: number;\r\nlet fileWatcher: fs.FSWatcher | undefined;\r\nconst configName = \"war3-tools.A1.listener\";\r\nlet config: boolean | undefined;\r\n\r\n/** 监听技能excel变更 */\r\nexport function listenerAbilityExcelInit(context: vscode.ExtensionContext) {\r\n\tconfig = getConfiguration();\r\n\tif (getConfiguration()) {\r\n\t\tstartWatch(context);\r\n\t}\r\n\tif (eventID === undefined) {\r\n\t\teventID = EventManager.listenToEvent<vscode.ConfigurationChangeEvent>(EventType.EVENT_ON_DID_CHANGE_CONFIGURATION, (event) => {\r\n\t\t\tif (!event.affectsConfiguration(configName) || getConfiguration() === config) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconfig = getConfiguration();\r\n\t\t\tif (getConfiguration()) {\r\n\t\t\t\tstopWatch();\r\n\t\t\t\tstartWatch(context);\r\n\t\t\t} else {\r\n\t\t\t\tstopWatch();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n/** 开始监听 */\r\nfunction startWatch(context: vscode.ExtensionContext) {\r\n\tif (fileWatcher === undefined) {\r\n\t\tconst rootPath = getRootPath();\r\n\t\tif (rootPath) {\r\n\t\t\tshowStatusBarMessage(\"[监听目录]：技能excel\");\r\n\t\t\tlet abilityExcelConfig: Table | undefined = vscode.workspace.getConfiguration().get('war3-tools.A2.AbilityExcel');\r\n\t\t\tfileWatcher = watch(rootPath, { recursive: true, filter: /\\.csv$/ }, function (evt, name) {\r\n\t\t\t\tif (abilityExcelConfig) {\r\n\t\t\t\t\teachExcelConfig(abilityExcelConfig, (kvDir, excelDir) => {\r\n\t\t\t\t\t\tif (path.normalize(excelDir) == path.normalize(path.dirname(name)).replace(\"\\\\csv\", \"\")) {\r\n\t\t\t\t\t\t\tconst kvName = path.join(kvDir, path.basename(name).replace(path.extname(name), '.lua'));\r\n\t\t\t\t\t\t\tfs.writeFileSync(kvName, obj2Lua(abilityCSV2KV(name)));\r\n\t\t\t\t\t\t\tshowStatusBarMessage(\"[excel导出kv]：\" + path.basename(name).replace(path.extname(name), '.lua'));\r\n\t\t\t\t\t\t\t// excel2kv(kvDir, path.join(excelDir, path.basename(name).replace(path.extname(name), \".xlsm\")), abilityCSV2KV);\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\t// vscode.window.showErrorMessage(`[${localize(\"listenerLocalizationInit\")}]${localize(\"game_folder_no_found\")}`);\r\n\t\t}\r\n\t}\r\n}\r\n/** 停止监听 */\r\nfunction stopWatch() {\r\n\tif (fileWatcher) {\r\n\t\tshowStatusBarMessage(\"[停止监听目录]：技能excel\");\r\n\t\tfileWatcher.close();\r\n\t\tfileWatcher = undefined;\r\n\t}\r\n}\r\n/** 是否开启监听 */\r\nfunction getConfiguration() {\r\n\tlet listenerConfig: ListenerConfig | undefined = vscode.workspace.getConfiguration().get(configName);\r\n\tif (listenerConfig) {\r\n\t\treturn listenerConfig.ability_excel || false;\r\n\t}\r\n}","import * as vscode from \"vscode\";\r\nimport * as fs from \"fs\";\r\nimport * as path from \"path\";\r\nimport watch from \"node-watch\";\r\nimport { EventManager, EventType } from \"../class/event\";\r\nimport { localize } from \"../utils/localize\";\r\nimport { getRootPath } from \"../utils/getRootPath\";\r\nimport { eachExcelConfig, excel2kv } from \"../command/cmdExcel2KV\";\r\nimport { unitCSV2KV } from \"../utils/csvUtils\";\r\nimport { showStatusBarMessage } from \"../module/statusBar\";\r\nimport { writeKeyValue } from \"../utils/kvUtils\";\r\n\r\nlet eventID: number;\r\nlet fileWatcher: fs.FSWatcher | undefined;\r\nconst configName = \"war3-tools.A1.listener\";\r\nlet config: boolean | undefined;\r\n\r\n/** 监听技能excel变更 */\r\nexport function listenerUnitExcelInit(context: vscode.ExtensionContext) {\r\n\tif (getConfiguration()) {\r\n\t\tstartWatch(context);\r\n\t}\r\n\tif (eventID === undefined) {\r\n\t\teventID = EventManager.listenToEvent<vscode.ConfigurationChangeEvent>(EventType.EVENT_ON_DID_CHANGE_CONFIGURATION, (event) => {\r\n\t\t\tif (!event.affectsConfiguration(configName) || getConfiguration() === config) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconfig = getConfiguration();\r\n\t\t\tif (getConfiguration()) {\r\n\t\t\t\tstopWatch();\r\n\t\t\t\tstartWatch(context);\r\n\t\t\t} else {\r\n\t\t\t\tstopWatch();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n/** 开始监听 */\r\nfunction startWatch(context: vscode.ExtensionContext) {\r\n\tif (fileWatcher === undefined) {\r\n\t\tconst rootPath = getRootPath();\r\n\t\tif (rootPath) {\r\n\t\t\tshowStatusBarMessage(\"[监听目录]：单位excel\");\r\n\t\t\tlet unitExcelConfig: Table | undefined = vscode.workspace.getConfiguration().get('war3-tools.A2.UnitExcel');\r\n\t\t\tfileWatcher = watch(rootPath, { recursive: true, filter: /\\.csv$/ }, function (evt, name) {\r\n\t\t\t\tif (unitExcelConfig) {\r\n\t\t\t\t\teachExcelConfig(unitExcelConfig, (kvDir, excelDir) => {\r\n\t\t\t\t\t\tif (path.normalize(excelDir) == path.normalize(path.dirname(name)).replace(\"\\\\csv\", \"\")) {\r\n\t\t\t\t\t\t\tconst kvName = path.join(kvDir, path.basename(name).replace(path.extname(name), '.lua'));\r\n\t\t\t\t\t\t\tfs.writeFileSync(kvName, writeKeyValue({ KeyValue: unitCSV2KV(name) }));\r\n\t\t\t\t\t\t\tshowStatusBarMessage(\"[excel导出kv]：\" + path.basename(name).replace(path.extname(name), '.lua'));\r\n\t\t\t\t\t\t\t// excel2kv(kvDir, excelDir, unitCSV2KV);\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\t// vscode.window.showErrorMessage(`[${localize(\"listenerLocalizationInit\")}]${localize(\"game_folder_no_found\")}`);\r\n\t\t}\r\n\t}\r\n}\r\n/** 停止监听 */\r\nfunction stopWatch() {\r\n\tif (fileWatcher) {\r\n\t\tshowStatusBarMessage(\"[停止监听目录]：单位excel\");\r\n\t\tfileWatcher.close();\r\n\t\tfileWatcher = undefined;\r\n\t}\r\n}\r\n/** 是否开启监听 */\r\nfunction getConfiguration() {\r\n\tlet listenerConfig: ListenerConfig | undefined = vscode.workspace.getConfiguration().get(configName);\r\n\tif (listenerConfig) {\r\n\t\treturn listenerConfig.unit_excel || false;\r\n\t}\r\n}","import * as vscode from 'vscode';\r\nimport { ENUM_STATUS_BAR_MESSAGE_TIMEOUT } from '../enum';\r\nimport { localize } from '../utils/localize';\r\n\r\nlet statusBarItem: vscode.StatusBarItem = vscode.window.createStatusBarItem(vscode.StatusBarAlignment.Left, 1);\r\n/** 最多信息条数 */\r\nconst MAX_MESSAGE_COUNT = 20;\r\n/** 信息列表 */\r\nlet messageList: { [k: number]: string; } = [];\r\n/** 信息索引 */\r\nlet messageIndex = 0;\r\nlet output: vscode.OutputChannel;\r\nlet showOutput = false;\r\nexport enum StatusBarState {\r\n\tALL_DONE = \"$(check-all)\",\r\n\tLOADING = \"$(loading~spin)\",\r\n}\r\n// 通知栏\r\nexport async function statusBarItemInit(context: vscode.ExtensionContext) {\r\n\tstatusBarItem.text = '$(loading~spin) ' + localize(\"pluginNameLite\");\r\n\tcontext.subscriptions.push(statusBarItem);\r\n\toutput = vscode.window.createOutputChannel(localize(\"pluginNameLite\"));\r\n\tstatusBarItem.show();\r\n\r\n\tcontext.subscriptions.push(vscode.commands.registerCommand(\"war3tools.showOutput\", async (data) => {\r\n\t\tif (showOutput) {\r\n\t\t\tshowOutput = !showOutput;\r\n\t\t\toutput.hide();\r\n\t\t} else {\r\n\t\t\tshowOutput = !showOutput;\r\n\t\t\toutput.show();\r\n\t\t}\r\n\t}));\r\n\tstatusBarItem.command = \"war3tools.showOutput\";\r\n}\r\n\r\nexport function getStatusBarItem() {\r\n\treturn statusBarItem;\r\n}\r\nexport function showStatusBarMessage(text: string, hideAfterTimeout: number = ENUM_STATUS_BAR_MESSAGE_TIMEOUT) {\r\n\trecordMessage(text);\r\n\tif (hideAfterTimeout === -1) {\r\n\t\tvscode.window.setStatusBarMessage(text);\r\n\t}\r\n\tvscode.window.setStatusBarMessage(text, hideAfterTimeout * 1000);\r\n\t// console.log(text);\r\n\toutput.appendLine(text);\r\n\treturn messageIndex - 1;\r\n}\r\n\r\n/** 更新文本 */\r\nexport function refreshStatusBarMessage(index: number, text: string, hideAfterTimeout: number = ENUM_STATUS_BAR_MESSAGE_TIMEOUT) {\r\n\tif (messageList[index]) {\r\n\t\tmessageList[index] = text;\r\n\t}\r\n\t// console.log(text);\r\n\toutput.appendLine(text);\r\n\tvscode.window.setStatusBarMessage(text, hideAfterTimeout * 1000);\r\n}\r\n\r\n/** 记录信息 */\r\nfunction recordMessage(text: string) {\r\n\tmessageList[messageIndex] = text;\r\n\tmessageIndex++;\r\n\tlet tooltip = `**${localize(\"message_notification\")}**  \\n`;\r\n\tfor (let index = Math.max(messageIndex - MAX_MESSAGE_COUNT, 0); index < messageIndex; index++) {\r\n\t\tconst message = messageList[index];\r\n\t\ttooltip += \"  \\n\" + message;\r\n\t}\r\n\tstatusBarItem.tooltip = new vscode.MarkdownString(tooltip);\r\n}\r\n/** 改变状态 */\r\nexport function changeStatusBarState(state: StatusBarState) {\r\n\tstatusBarItem.text = state + \" \" + localize(\"pluginNameLite\");\r\n}","import * as os from 'os';\r\nimport * as fs from 'fs';\r\n\r\nexport function csv2obj(csv: any, bVertical = false): any {\r\n\tlet arrCSV: any[][] = csv;\r\n\tif (typeof (csv) === \"string\") {\r\n\t\tarrCSV = csvParse(csv);\r\n\t}\r\n\r\n\tlet csvConfigs: any = {};\r\n\tif (bVertical) {\r\n\t\tfor (let i = 0; i < arrCSV.length; i++) {\r\n\t\t\tlet arrLine = arrCSV[i];\r\n\t\t\tcsvConfigs[arrLine[1]] = arrLine[2];\r\n\t\t}\r\n\t} else {\r\n\t\t// 横向的至少要有三行，第一行中文，第二行key， 第三行内容\r\n\t\tif (arrCSV.length < 3) {\r\n\t\t\treturn csvConfigs;\r\n\t\t}\r\n\t\tlet keys: any[] = arrCSV[1];// 第二行 key\r\n\r\n\t\tfor (let i = 2; i < arrCSV.length; i++) {\r\n\t\t\tlet arrLine = arrCSV[i];\r\n\t\t\tlet lineID: any = arrLine[0];\r\n\t\t\tif (!lineID) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tcsvConfigs[lineID] = {};\r\n\t\t\tfor (let j = 0; j < arrLine.length; j++) {\r\n\t\t\t\tif (!keys[j] || keys[j] === \"\") {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tlet value = arrLine[j] || \"\";\r\n\t\t\t\t// if (value===undefined || value===\"\") {\r\n\t\t\t\t// \tcontinue;\r\n\t\t\t\t// }\r\n\t\t\t\t// 因为多个key都叫AttachWearables，处理成AttachWearables1234\r\n\t\t\t\tlet columnKey = keys[j];\r\n\t\t\t\tif (keys[j] === \"AttachWearables\") {\r\n\t\t\t\t\tfor (let index = 1; index < 30; index++) {\r\n\t\t\t\t\t\tif (!csvConfigs[lineID][\"AttachWearables\" + index]) {\r\n\t\t\t\t\t\t\tcolumnKey = \"AttachWearables\" + index;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcsvConfigs[lineID][columnKey] = value;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// 中文行处理\r\n\t\tcsvConfigs[\"__key_sc\"] = {};\r\n\t\tfor (let j = 0; j < keys.length; j++) {\r\n\t\t\tlet sc = arrCSV[0][j] || \"\";\r\n\t\t\tlet columnKey = keys[j];\r\n\t\t\tif (keys[j] === \"AttachWearables\") {\r\n\t\t\t\tfor (let index = 1; index < 30; index++) {\r\n\t\t\t\t\tif (!csvConfigs[\"__key_sc\"][\"AttachWearables\" + index]) {\r\n\t\t\t\t\t\tcolumnKey = \"AttachWearables\" + index;\r\n\t\t\t\t\t\tsc = \"AttachWearables\" + index;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tcsvConfigs[\"__key_sc\"][columnKey] = sc;\r\n\t\t}\r\n\t}\r\n\treturn csvConfigs;\r\n}\r\n\r\n// Obj转csv\r\nexport function obj2csv(obj: any) {\r\n\tlet keySc = obj.__key_sc;\r\n\tif (!keySc) {\r\n\t\t// 默认中英文key一样\r\n\t\tkeySc = {};\r\n\t\tfor (let lineID in obj) {\r\n\t\t\tlet lineInfo = obj[lineID];\r\n\t\t\tfor (let columnKey in lineInfo) {\r\n\t\t\t\tkeySc[columnKey] = columnKey;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t// 前两行\r\n\tlet arrCSV: any[] = [];\r\n\tarrCSV[0] = [];\r\n\tarrCSV[1] = [];\r\n\tfor (let key in keySc) {\r\n\t\tlet sChineseKey = keySc[key];\r\n\t\tarrCSV[0].push(sChineseKey);\r\n\t\tif (key.indexOf(\"AttachWearables\") !== -1) {\r\n\t\t\tarrCSV[1].push(\"AttachWearables\");\r\n\t\t} else {\r\n\t\t\tarrCSV[1].push(key);\r\n\t\t}\r\n\t}\r\n\r\n\tlet y = 2;\r\n\tfor (let lineID in obj) {\r\n\t\tif (lineID === \"__key_sc\") {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tarrCSV[y] = [];\r\n\t\tlet oLineInfo = obj[lineID];\r\n\t\tfor (let columnKey in keySc) {\r\n\t\t\tlet value = oLineInfo[columnKey] || '';\r\n\t\t\tarrCSV[y].push(value);\r\n\t\t}\r\n\t\ty++;\r\n\t}\r\n\treturn array2csv(arrCSV);\r\n}\r\n// csv转array\r\nexport function csvParse(csv: string) {\r\n\tcsv = csv.replace(/\\r\\n/g, '\\n');\r\n\tlet arr: any = [];\r\n\tlet col = 0;\r\n\tlet row = 0;\r\n\tfor (let i = 0; i < csv.length; i++) {\r\n\t\ti = readValue(i);\r\n\t}\r\n\treturn arr;\r\n\tfunction readValue(index: number): any {\r\n\t\tlet value = \"\";\r\n\t\tlet state = \"normal\";\r\n\t\tfor (let i = index; i < csv.length; i++) {\r\n\t\t\tlet substr = csv[i];\r\n\t\t\tlet bLast = (i === csv.length - 1);\r\n\t\t\tif (substr === \"\\\"\" && state === \"normal\") {\r\n\t\t\t\tstate = \"string\";\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (substr === \"\\\"\" && state === \"string\") {\r\n\t\t\t\tstate = \"normal\";\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (substr === \"\\n\" && state === \"string\") {\r\n\t\t\t\tvalue += substr;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (substr === \"\\n\" && state === \"normal\") {\r\n\t\t\t\tif (arr[row] === undefined) {\r\n\t\t\t\t\tarr[row] = [];\r\n\t\t\t\t}\r\n\t\t\t\tarr[row][col] = value;\r\n\t\t\t\trow++;\r\n\t\t\t\tcol = 0;\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t\tif (substr === \",\" && state !== \"string\") {\r\n\t\t\t\tif (arr[row] === undefined) {\r\n\t\t\t\t\tarr[row] = [];\r\n\t\t\t\t}\r\n\t\t\t\tarr[row][col] = value;\r\n\t\t\t\tcol++;\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t\tif (bLast && state === \"normal\") {\r\n\t\t\t\tif (arr[row] === undefined) {\r\n\t\t\t\t\tarr[row] = [];\r\n\t\t\t\t}\r\n\t\t\t\tvalue += substr;\r\n\t\t\t\tarr[row][col] = value;\r\n\t\t\t\trow++;\r\n\t\t\t\tcol = 0;\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t\tvalue += substr;\r\n\t\t}\r\n\t}\r\n}\r\n// csv转array(无法处理单元格换行问题)\r\nexport function csv2array(csv: string): [] {\r\n\tconst rows: string[] = csv.split(os.EOL);\r\n\tlet arr: any = [];\r\n\tfor (let i = 0; i < rows.length; i++) {\r\n\t\tarr[i] = [];\r\n\t\tconst lineText: string = rows[i];\r\n\t\tlet values: string[] = lineText.split(',');\r\n\t\tif (values.length === 1) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tfor (let j = 0; j < values.length; j++) {\r\n\t\t\tconst value = values[j];\r\n\t\t\tarr[i].push(value);\r\n\t\t}\r\n\t}\r\n\treturn arr;\r\n}\r\n// array转csv\r\nexport function array2csv(arr: any[]): string {\r\n\tlet csv: string = '';\r\n\tlet titleCount: number = arr[1].length;\r\n\tfor (let i = 0; i < arr.length; i++) {\r\n\t\tconst rows: any = arr[i];\r\n\t\tfor (let j = 0; j < rows.length; j++) {\r\n\t\t\tif (rows[0] === undefined && rows.length === 0) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tlet col = rows[j] === undefined ? '' : rows[j];\r\n\t\t\tif (col.indexOf(\",\") !== -1) {\r\n\t\t\t\tcol = '\"' + col + '\"';\r\n\t\t\t}\r\n\t\t\tcsv += col + (j + 1 === rows.length ? '' : ',');\r\n\t\t}\r\n\t\tif (rows[0] !== undefined || rows.length > 0) {\r\n\t\t\tfor (let q = 0; q < titleCount - rows.length; q++) {\r\n\t\t\t\tcsv += ',';\r\n\t\t\t}\r\n\t\t\tcsv += os.EOL;\r\n\t\t}\r\n\t\tif (rows.length === 0) {\r\n\t\t\tfor (let i = 0; i < titleCount - 1; i++) {\r\n\t\t\t\tcsv += ',';\r\n\t\t\t}\r\n\t\t\tcsv += os.EOL;\r\n\t\t}\r\n\t}\r\n\treturn csv;\r\n}\r\nexport function isEmptyCSVValue(anything: any) {\r\n\tif (anything === undefined || anything === null || anything === \"\") {\r\n\t\treturn true;\r\n\t} else {\r\n\t\treturn false;\r\n\t}\r\n}\r\nexport function multilayerCSV2KV(listenPath: string): any {\r\n\ttry {\r\n\t\tlet csv = fs.readFileSync(listenPath, 'utf-8');\r\n\t\tlet csvArr: any = csvParse(csv);\r\n\t\t// 处理多层key\r\n\t\tlet csvKey: any[] = csvArr[1];\r\n\t\tfor (let index = 0; index < csvKey.length; index++) {\r\n\t\t\tlet key: string = csvKey[index];\r\n\t\t\tlet keySplit = key.split(\"-\");\r\n\t\t\tif (keySplit.length > 1) {\r\n\t\t\t\tcsvKey[index] = keySplit;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet arrDefault: string[] = csvArr[2];\r\n\t\tif (arrDefault.length === 0 || arrDefault[0] === undefined) {\r\n\t\t\treturn {};\r\n\t\t}\r\n\r\n\t\tlet arrKeyDepth: any = {};// 用这个对象记录上一次unique_key变化后的多层结构\r\n\r\n\t\tlet csvData: any = {}; // 函数返回值\r\n\t\tfor (let y = 2; y < csvArr.length; y++) {\r\n\t\t\tconst row: any = csvArr[y];\r\n\t\t\tif (row.length === 0) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tlet lineObj: any;\r\n\t\t\tif (row[0] === \"\") {\r\n\t\t\t\tlineObj = csvData[arrDefault[0]];\r\n\t\t\t} else {\r\n\t\t\t\t// 新的一个，初始化\r\n\t\t\t\tlineObj = {};\r\n\t\t\t\tarrDefault = [row[0]];\r\n\t\t\t\tarrKeyDepth = {};\r\n\t\t\t}\r\n\t\t\tfor (let x = 1; x < row.length; x++) {\r\n\t\t\t\tlet col: string = row[x];\r\n\t\t\t\tif (col !== \"\") {\r\n\t\t\t\t\tarrDefault[x] = col;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcol = arrDefault[x];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet key: string | string[] = csvKey[x];\r\n\t\t\t\tif (key instanceof Array) {\r\n\t\t\t\t\tlet tempObj: any;\r\n\t\t\t\t\tif (key[0] !== \"root\") {\r\n\t\t\t\t\t\tif (lineObj[key[0]] === undefined) {\r\n\t\t\t\t\t\t\tlineObj[key[0]] = {};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttempObj = lineObj[key[0]];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttempObj = lineObj;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (arrKeyDepth[key[0]] === undefined) {\r\n\t\t\t\t\t\tarrKeyDepth[key[0]] = {};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// 去头去尾来读取arrKeyDepth,使temp_obj[这个指针]指向col应该填入的位置 NOTE:中间的只能为value 尾部可以为key或者value\r\n\t\t\t\t\tlet index = 1;\r\n\t\t\t\t\tlet depth: number = index - 1;\r\n\t\t\t\t\tfor (; index <= key.length - 2; index++) {\r\n\t\t\t\t\t\tdepth = index - 1;\r\n\t\t\t\t\t\tlet sKeyDepth = arrKeyDepth[key[0]][depth];\r\n\t\t\t\t\t\tif (sKeyDepth === undefined || sKeyDepth === \"\") {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (tempObj[sKeyDepth] === undefined) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttempObj = tempObj[sKeyDepth];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdepth = index - 1;\r\n\t\t\t\t\tif (key[key.length - 1] === \"value\") {\r\n\t\t\t\t\t\tlet sKeyDepth = arrKeyDepth[key[0]][depth];\r\n\t\t\t\t\t\tif (sKeyDepth === undefined || sKeyDepth === \"\") {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttempObj[sKeyDepth] = col;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlet sKeyDepth = (col === \"\" || col === undefined) ? arrKeyDepth[key[0]][depth] : col;\r\n\t\t\t\t\t\tif (sKeyDepth === undefined || sKeyDepth === \"\") {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tarrKeyDepth[key[0]][depth] = sKeyDepth;\r\n\t\t\t\t\t\tif (tempObj[sKeyDepth] === undefined) {\r\n\t\t\t\t\t\t\ttempObj[sKeyDepth] = {};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (key === \"\") {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (col === undefined || col === \"\") {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlineObj[key] = col;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (row[0] !== undefined && row[0] !== \"\") {\r\n\t\t\t\tcsvData[row[0]] = lineObj;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn csvData;\r\n\t} catch (error) {\r\n\t\tconsole.log(error);\r\n\t}\r\n}\r\nexport function abilityCSV2KV(listenPath: string): any {\r\n\tlet csv = fs.readFileSync(listenPath, 'utf-8');\r\n\t// 生成kv\r\n\tlet csvData: any = {};\r\n\tlet csvArr: any = csvParse(csv);\r\n\t// let csv_arr:any = CSV2Array(csv);\r\n\tconst csvKey: [] = csvArr[0];\r\n\tfor (let i = 1; i < csvArr.length; i++) {\r\n\t\tconst row: any = csvArr[i];\r\n\t\t// 空行、空值则跳过\r\n\t\tif (row.length === 0 || row[0] === undefined || row[0] === \"\") {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tlet specialCount: number = 1;\r\n\t\tlet precacheCount: number = 1;\r\n\t\tlet abilitySpecial: any = {};\r\n\t\tlet abilityValues: any = {};\t/** 新版kv键值 */\r\n\t\tlet precacheResource: any = {};\r\n\t\tlet precache: any = {};\r\n\t\tlet valuesObj: any = {};\r\n\t\tfor (let j = 1; j < row.length; j++) {\r\n\t\t\tconst col = row[j];\r\n\t\t\t// 跳过空值\r\n\t\t\tif (col === '') {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tlet key: string = csvKey[j];\r\n\t\t\t// special值特殊处理\r\n\t\t\tif (key === 'AbilitySpecial') {\r\n\t\t\t\tkey = (\"0\" + specialCount).substr(-2);\r\n\t\t\t\tif (csvArr[i + 1] !== undefined && csvArr[i + 1] !== \"\") {\r\n\t\t\t\t\tlet value = csvArr[i + 1][j];\r\n\t\t\t\t\t// 拆分key\r\n\t\t\t\t\tlet keyArr = col.split(\"\\n\");\r\n\t\t\t\t\t// 拆分value\r\n\t\t\t\t\tlet valueArr = value.split(\"\\n\");\r\n\t\t\t\t\tabilitySpecial[key] = {\r\n\t\t\t\t\t\tvar_type: valueArr[0].search(/\\./g) !== -1 ? 'FIELD_FLOAT' : 'FIELD_INTEGER',\r\n\t\t\t\t\t\t// [col]: csv_arr[i+1][j]\r\n\t\t\t\t\t};\r\n\t\t\t\t\tfor (let i = 0; i < keyArr.length; i++) {\r\n\t\t\t\t\t\tconst _key = keyArr[i];\r\n\t\t\t\t\t\tabilitySpecial[key][_key] = valueArr[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tspecialCount++;\r\n\t\t\t\t}\r\n\t\t\t} else if (key === 'AbilityValues') {\r\n\t\t\t\tif (csvArr[i + 1] !== undefined && csvArr[i + 1] !== \"\") {\r\n\t\t\t\t\tlet value = csvArr[i + 1][j];\r\n\t\t\t\t\t// 拆分key\r\n\t\t\t\t\tlet keyArr = col.split(\"\\n\");\r\n\t\t\t\t\t// 拆分value\r\n\t\t\t\t\tlet valueArr = value.split(\"\\n\");\r\n\t\t\t\t\tif (keyArr.length <= 1) {\r\n\t\t\t\t\t\tabilityValues[keyArr[0]] = valueArr[0];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tabilityValues[keyArr[0]] = {};\r\n\t\t\t\t\t\tfor (let i = 0; i < keyArr.length; i++) {\r\n\t\t\t\t\t\t\tconst _key = keyArr[i];\r\n\t\t\t\t\t\t\tconst _value = valueArr[i];\r\n\t\t\t\t\t\t\tif (i == 0) {\r\n\t\t\t\t\t\t\t\tabilityValues[keyArr[0]][\"value\"] = _value;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tabilityValues[keyArr[0]][_key] = _value;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (key.indexOf(\"参数\") != -1) {\r\n\t\t\t\tif (csvArr[i + 1] !== undefined && csvArr[i + 1] !== \"\") {\r\n\t\t\t\t\tlet value = csvArr[i + 1][j];\r\n\t\t\t\t\t// 拆分key\r\n\t\t\t\t\tlet keyArr = col.split(\"\\n\");\r\n\t\t\t\t\t// 拆分value\r\n\t\t\t\t\tlet valueArr = value.split(\"\\n\");\r\n\t\t\t\t\t// if (keyArr.length <= 1) {\r\n\t\t\t\t\t// \tabilityValues[keyArr[0]] = valueArr[0];\r\n\t\t\t\t\t// } else {\r\n\t\t\t\t\t// \tabilityValues[keyArr[0]] = {};\r\n\t\t\t\t\t// \tfor (let i = 0; i < keyArr.length; i++) {\r\n\t\t\t\t\t// \t\tconst _key = keyArr[i];\r\n\t\t\t\t\t// \t\tconst _value = valueArr[i];\r\n\t\t\t\t\t// \t\tif (i == 0) {\r\n\t\t\t\t\t// \t\t\tabilityValues[keyArr[0]][\"value\"] = _value;\r\n\t\t\t\t\t// \t\t} else {\r\n\t\t\t\t\t// \t\t\tabilityValues[keyArr[0]][_key] = _value;\r\n\t\t\t\t\t// \t\t}\r\n\t\t\t\t\t// \t}\r\n\t\t\t\t\t// }\r\n\t\t\t\t\tvaluesObj[col] = value;\r\n\t\t\t\t}\r\n\t\t\t} else if (key === '') {\r\n\t\t\t\tcontinue;\r\n\t\t\t} else if (key === 'precache') {\r\n\t\t\t\tif (csvArr[i + 1] !== undefined && csvArr[i + 1] !== \"\") {\r\n\t\t\t\t\tlet value = csvArr[i + 1][j];\r\n\t\t\t\t\tif (precache[col] === undefined) {\r\n\t\t\t\t\t\tprecache[col] = [];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tprecache[col].push(value);\r\n\t\t\t\t}\r\n\t\t\t} else if (key === 'PrecacheResource') {\r\n\t\t\t\t// 自定义的预载入\r\n\t\t\t\tif (csvArr[i + 1] !== undefined && csvArr[i + 1] !== \"\") {\r\n\t\t\t\t\t// 拆分key\r\n\t\t\t\t\tlet keyArr = col.split(\"\\n\");\r\n\t\t\t\t\tfor (let i = 0; i < keyArr.length; i++) {\r\n\t\t\t\t\t\tconst _key = keyArr[i];\r\n\t\t\t\t\t\tprecacheResource[String(precacheCount)] = _key;\r\n\t\t\t\t\t\tprecacheCount++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvaluesObj[key] = col;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (Object.keys(abilitySpecial).length > 0) {\r\n\t\t\tvaluesObj.AbilitySpecial = abilitySpecial;\r\n\t\t}\r\n\t\tif (Object.keys(abilityValues).length > 0) {\r\n\t\t\tvaluesObj.AbilityValues = abilityValues;\r\n\t\t}\r\n\t\tif (Object.keys(precache).length > 0) {\r\n\t\t\tvaluesObj.precache = precache;\r\n\t\t}\r\n\t\tif (Object.keys(precacheResource).length > 0) {\r\n\t\t\tvaluesObj.PrecacheResource = precacheResource;\r\n\t\t}\r\n\t\ti++;\r\n\t\tcsvData[row[0]] = valuesObj;\r\n\t}\r\n\treturn csvData;\r\n}\r\nexport function unitCSV2KV(listenPath: string): any {\r\n\tlet csv = fs.readFileSync(listenPath, 'utf-8');\r\n\t// 生成kv\r\n\tlet csvData: any = {};\r\n\tlet csvArr: any = csvParse(csv);\r\n\tconst csvKey: [] = csvArr[0];\r\n\tfor (let i = 1; i < csvArr.length; i++) {\r\n\t\tconst row: any = csvArr[i];\r\n\t\tif (row.length === 0 || row[0] === '' || row[0] === undefined) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tlet wearableCount: number = 1;\r\n\t\tlet attachWearables: any = {};\r\n\t\tlet valuesObj: any = {};\r\n\t\t// 读取多层结构\r\n\t\tlet readBlock = function (index: number): any {\r\n\t\t\tlet block: any = {};\r\n\t\t\tfor (let i = index + 1; i < row.length; i++) {\r\n\t\t\t\tconst col: any = row[i];\r\n\t\t\t\tconst key: string = csvKey[i];\r\n\t\t\t\tif (col === '') {\r\n\t\t\t\t\tif (key.search('[{]') !== -1) {\r\n\t\t\t\t\t\tlet [_block, j] = readBlock(i);\r\n\t\t\t\t\t\ti = j;\r\n\t\t\t\t\t\tif (Object.keys(_block).length > 0) {\r\n\t\t\t\t\t\t\tblock[key.split('[{]')[0]] = _block;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (key.search('[}]') !== -1) {\r\n\t\t\t\t\t\treturn [block, i];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif (key === '') {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tblock[key] = col;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\tfor (let j = 1; j < row.length; j++) {\r\n\t\t\tconst col = row[j];\r\n\t\t\tlet key: string = csvKey[j];\r\n\t\t\t// 跳过空值\r\n\t\t\tif (col === '') {\r\n\t\t\t\t// 处理多层结构\r\n\t\t\t\tif (key.search('[{]') !== -1) {\r\n\t\t\t\t\tlet [block, i] = readBlock(j);\r\n\t\t\t\t\tj = i;\r\n\t\t\t\t\tif (Object.keys(block).length > 0) {\r\n\t\t\t\t\t\tvaluesObj[key.split('[{]')[0]] = block;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t// special值特殊处理\r\n\t\t\tif (key === 'AttachWearables') {\r\n\t\t\t\tkey = wearableCount.toString();\r\n\t\t\t\tlet value = col;\r\n\t\t\t\tattachWearables[key] = {\r\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/naming-convention\r\n\t\t\t\t\tItemDef: value\r\n\t\t\t\t};\r\n\t\t\t\twearableCount++;\r\n\t\t\t\t// 一些Creature特殊键值\r\n\t\t\t} else if (key === 'CanRespawn' || key === 'DisableClumpingBehavior' || key === 'UsesGestureBasedAttackAnimation' || key === 'ShouldDoFlyHeightVisual' || key === 'IsHybridFlyer') {\r\n\t\t\t\tif (valuesObj.Creature === undefined) {\r\n\t\t\t\t\tvaluesObj.Creature = {};\r\n\t\t\t\t}\r\n\t\t\t\tvaluesObj.Creature[key] = col;\r\n\t\t\t\tcontinue;\r\n\t\t\t\t// 跳过没有key的值\r\n\t\t\t} else if (key === '') {\r\n\t\t\t\tcontinue;\r\n\t\t\t} else {\r\n\t\t\t\tvaluesObj[key] = col;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (Object.keys(attachWearables).length > 0) {\r\n\t\t\tif (valuesObj.Creature === undefined) {\r\n\t\t\t\tvaluesObj.Creature = {};\r\n\t\t\t}\r\n\t\t\tvaluesObj.Creature.AttachWearables = attachWearables;\r\n\t\t}\r\n\t\tcsvData[row[0]] = valuesObj;\r\n\t}\r\n\treturn csvData;\r\n}","import * as vscode from 'vscode';\r\nexport function getRootPath() {\r\n\tconst folders: readonly vscode.WorkspaceFolder[] | undefined = vscode.workspace.workspaceFolders;\r\n\tif (folders !== undefined) {\r\n\t\treturn folders[0].uri.fsPath;\r\n\t} else {\r\n\t\treturn;\r\n\t}\r\n}","export function isNumber(s: string): boolean {\r\n\tlet reg = /^(-?\\d+)(\\.\\d+)?$/;\r\n\tif (reg.test(s)) {\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}","import * as vscode from 'vscode';\r\nimport * as fs from 'fs';\r\nimport * as os from 'os';\r\nimport { getPathInfo } from \"./pathUtils\";\r\nimport { isNumber } from \"./isNumber\";\r\n\r\n// 读取kv2格式为object(兼容kv3)\r\nexport function readKeyValue2(kvdata: string, bRemoveComment: boolean = true, bOverride: boolean = true): any {\r\n\tif (bRemoveComment === true) {\r\n\t\tkvdata = removeComment(kvdata);\r\n\t}\r\n\t// kvdata = kvdata.replace(/\\t/g,'').replace(' ','').replace(/\\r\\n/g,'');\r\n\tkvdata = kvdata.replace(/\\t/g, '').replace(/\\r\\n/g, '');\r\n\tlet kvObj: any = {};\r\n\tlet overrideIndex: number = 1;\r\n\tfor (let i = 0; i < kvdata.length; i++) {\r\n\t\tlet substr = kvdata[i];\r\n\t\tif (substr === '\"') {\r\n\t\t\tlet key: any;\r\n\t\t\tlet value: any;\r\n\t\t\t[key, value, i] = readKeyValue(i);\r\n\t\t\t// 如果有重复值\r\n\t\t\tif (kvObj[key] === undefined || bOverride === true) {\r\n\t\t\t\tkvObj[key] = value;\r\n\t\t\t} else {\r\n\t\t\t\tkvObj[key + overrideIndex] = value;\r\n\t\t\t\toverrideIndex++;\r\n\t\t\t}\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tif (substr === '#' && kvdata.substr(i, 5) === '#base') {\r\n\t\t\ti = getBase(i);\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t}\r\n\treturn kvObj;\r\n\t// 读取一对键对\r\n\tfunction readKeyValue(startIndex: number): any {\r\n\t\tlet key: string = '';\r\n\t\tlet value: any;\r\n\t\tlet state = 'NONE';\r\n\t\tfor (let i = startIndex; i < kvdata.length; i++) {\r\n\t\t\tlet substr = kvdata[i];\r\n\t\t\t// 读取key\r\n\t\t\tif (substr === '\"' && state === 'NONE') {\r\n\t\t\t\t[key, i] = getContent(i);\r\n\t\t\t\tstate = 'VALUE';\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t// 读取value\r\n\t\t\tif (substr === '\"' && state === 'VALUE') {\r\n\t\t\t\t[value, i] = getContent(i);\r\n\t\t\t\treturn [key, value, i];\r\n\t\t\t}\r\n\t\t\t// 读取table\r\n\t\t\tif (substr === '{' && state === 'VALUE') {\r\n\t\t\t\t[value, i] = getTable(i);\r\n\t\t\t\treturn [key, value, i];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tfunction getTable(startIndex: number): any {\r\n\t\tlet kv: any = {};\r\n\t\tlet state = 'NONE';\r\n\t\tlet overrideIndex: number = 1;\r\n\t\tfor (let i = startIndex; i < kvdata.length; i++) {\r\n\t\t\tlet substr = kvdata[i];\r\n\t\t\tif (substr === '{' && state === 'NONE') {\r\n\t\t\t\tstate = 'READ';\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t// 插入kv3\r\n\t\t\tif (substr === '<' && kvdata.substr(i, 8) === '<!-- kv3' && state === 'READ') {\r\n\t\t\t\tlet [block, newIndex] = getKv3Block(i);\r\n\t\t\t\tkv = readKeyValue3(block);\r\n\t\t\t\ti = newIndex;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (substr === '\"' && state === 'READ') {\r\n\t\t\t\tlet key: any;\r\n\t\t\t\tlet value: any;\r\n\t\t\t\t[key, value, i] = readKeyValue(i);// 如果有重复值\r\n\t\t\t\tif (kv[key] === undefined || bOverride === true) {\r\n\t\t\t\t\tkv[key] = value;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tkv[key + overrideIndex] = value;\r\n\t\t\t\t\toverrideIndex++;\r\n\t\t\t\t}\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (substr === '}' && state === 'READ') {\r\n\t\t\t\treturn [kv, i];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t// 获取引号里的内容\r\n\tfunction getContent(startIndex: number): any {\r\n\t\tlet content: string = '';\r\n\t\tlet state = 'NONE';\r\n\t\tfor (let i = startIndex; i < kvdata.length; i++) {\r\n\t\t\tlet substr = kvdata[i];\r\n\t\t\t// 跳过转义符\r\n\t\t\tif (substr === '\\\\' && kvdata[i + 1] === '\"') {\r\n\t\t\t\tcontent += substr;\r\n\t\t\t\ti++;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (substr === '\"' && state === 'NONE') {\r\n\t\t\t\tstate = 'READ';\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (state === 'READ') {\r\n\t\t\t\tif (substr === '\"') {\r\n\t\t\t\t\treturn [content, i];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcontent += substr;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t// 获得kv3块\r\n\tfunction getKv3Block(startIndex: number): any {\r\n\t\tlet block = '';\r\n\t\tlet left = 0;\r\n\t\tlet right = 0;\r\n\t\tlet state = 'NONE';\r\n\t\tfor (let i = startIndex; i < kvdata.length; i++) {\r\n\t\t\tlet substr = kvdata[i];\r\n\t\t\tif (state === 'NONE' && substr === '<') {\r\n\t\t\t\tstate = 'HEAD';\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (state === 'HEAD') {\r\n\t\t\t\tif (substr === '>') {\r\n\t\t\t\t\tstate = 'NONE';\r\n\t\t\t\t}\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tblock += substr;\r\n\t\t\tif (substr === '{') {\r\n\t\t\t\tleft++;\r\n\t\t\t}\r\n\t\t\tif (substr === '}') {\r\n\t\t\t\tright++;\r\n\t\t\t\tif (left === right) {\r\n\t\t\t\t\treturn [block, i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t// #base\r\n\tfunction getBase(startIndex: number): any {\r\n\t\tlet path = '';\r\n\t\tlet state = 'NONE';\r\n\t\tfor (let i = startIndex; i < kvdata.length; i++) {\r\n\t\t\tlet substr = kvdata[i];\r\n\t\t\tif (substr === '#') {\r\n\t\t\t\tstate = 'START';\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (substr === '\"' && state === 'START') {\r\n\t\t\t\tstate = 'READ';\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (state === 'READ') {\r\n\t\t\t\tif (substr === '\"') {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpath += substr;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n// 读取kv3格式为object\r\nexport function readKeyValue3(kvdata: string): Table {\r\n\tkvdata = kvdata.replace(/<!-- kv3.*-->/, '').replace(/\\t/g, '').replace(/\\s+/g, '').replace(/\\r\\n/g, '');\r\n\t// kvdata = kvdata.replace(/\\t/g,'').replace(/\\r\\n/g,'');\r\n\tlet kvObj: any = [];\r\n\tfor (let i = 0; i < kvdata.length; i++) {\r\n\t\tlet substr = kvdata[i];\r\n\t\tif (substr === '{') {\r\n\t\t\tlet [obj, newLine] = readTable(i);\r\n\t\t\tkvObj.push(obj);\r\n\t\t\ti = newLine;\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t}\r\n\treturn kvObj;\r\n\t// 读取一对中括号里面的内容\r\n\tfunction readTable(startIndex: number): any {\r\n\t\tlet kv: any = {};\r\n\t\tlet key: string = '';\r\n\t\tlet value: string = '';\r\n\t\tlet state = 'NONE';\r\n\t\tfor (let i = startIndex; i < kvdata.length; i++) {\r\n\t\t\tlet substr = kvdata[i];\r\n\t\t\tif (substr === '{' && state === 'NONE') {\r\n\t\t\t\tstate = 'KEY';\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (substr === '}') {\r\n\t\t\t\treturn [kv, i];\r\n\t\t\t}\r\n\t\t\tif (state === 'KEY') {\r\n\t\t\t\tif (substr === '=') {\r\n\t\t\t\t\tstate = 'VALUE';\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tkey += substr;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (state === 'VALUE') {\r\n\t\t\t\tif (kvdata.substr(i, 5) === \"false\") {\r\n\t\t\t\t\tkv[key] = \"false\";\r\n\t\t\t\t\tkey = '';\r\n\t\t\t\t\tvalue = '';\r\n\t\t\t\t\tstate = 'KEY';\r\n\t\t\t\t\ti = i + 4;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif (kvdata.substr(i, 4) === \"true\") {\r\n\t\t\t\t\tkv[key] = \"true\";\r\n\t\t\t\t\tkey = '';\r\n\t\t\t\t\tvalue = '';\r\n\t\t\t\t\tstate = 'KEY';\r\n\t\t\t\t\ti = i + 3;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif (substr === '\"') {\r\n\t\t\t\t\tstate = 'STRING';\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t} else if (substr === '{') {\r\n\t\t\t\t\t// 读表\r\n\t\t\t\t\tlet [obj, newLine] = readTable(i);\r\n\t\t\t\t\tkv[key] = obj;\r\n\t\t\t\t\tkey = '';\r\n\t\t\t\t\tvalue = '';\r\n\t\t\t\t\ti = newLine;\r\n\t\t\t\t\tstate = 'KEY';\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t} else if (substr === '[') {\r\n\t\t\t\t\t// 读数组\r\n\t\t\t\t\tlet [obj, newLine] = readArray(i);\r\n\t\t\t\t\tkv[key] = obj;\r\n\t\t\t\t\tkey = '';\r\n\t\t\t\t\tvalue = '';\r\n\t\t\t\t\ti = newLine;\r\n\t\t\t\t\tstate = 'KEY';\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t} else if (isNumber(substr) === true || substr === '.' || substr === '-') {\r\n\t\t\t\t\tstate = 'NUMBER';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (state === 'STRING') {\r\n\t\t\t\tif (substr === '\"') {\r\n\t\t\t\t\tkv[key] = value;\r\n\t\t\t\t\tkey = '';\r\n\t\t\t\t\tvalue = '';\r\n\t\t\t\t\tstate = 'KEY';\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue += substr;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (state === 'NUMBER') {\r\n\t\t\t\tif (isNumber(substr) === true || substr === '.' || substr === '-') {\r\n\t\t\t\t\tvalue += substr;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tkv[key] = value;\r\n\t\t\t\t\tkey = '';\r\n\t\t\t\t\tvalue = '';\r\n\t\t\t\t\ti--;\r\n\t\t\t\t\tstate = 'KEY';\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t// 读数组\r\n\tfunction readArray(startIndex: number): any {\r\n\t\tlet arr: any = [];\r\n\t\tlet state = 'NONE';\r\n\t\tlet value = '';\r\n\t\tfor (let i = startIndex; i < kvdata.length; i++) {\r\n\t\t\tlet substr = kvdata[i];\r\n\t\t\tif ((substr === '[' || substr === ',') && state === 'NONE') {\r\n\t\t\t\tstate = 'VALUE';\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (substr === ']') {\r\n\t\t\t\treturn [arr, i];\r\n\t\t\t}\r\n\t\t\tif (state === 'VALUE') {\r\n\t\t\t\tif (substr === '\"') {\r\n\t\t\t\t\tstate = 'STRING';\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t} else if (substr === '{') {\r\n\t\t\t\t\tlet [obj, newLine] = readTable(i);\r\n\t\t\t\t\tarr.push(obj);\r\n\t\t\t\t\ti = newLine;\r\n\t\t\t\t\tstate = 'NONE';\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tstate = 'NUMBER';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (state === 'STRING') {\r\n\t\t\t\tif (substr === '\"') {\r\n\t\t\t\t\tarr.push(value);\r\n\t\t\t\t\tvalue = '';\r\n\t\t\t\t\ti++;\r\n\t\t\t\t\tstate = 'VALUE';\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue += substr;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (state === 'NUMBER') {\r\n\t\t\t\tif (substr === ',') {\r\n\t\t\t\t\tarr.push(value);\r\n\t\t\t\t\tvalue = '';\r\n\t\t\t\t\tstate = 'VALUE';\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue += substr;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n// 读取kv2格式为object（#base）\r\nexport async function readKeyValueWithBase(fullPath: string) {\r\n\t// 获取名字\r\n\tlet fileName: string = fullPath.split('/').pop() || '';\r\n\tlet path = fullPath.split(fileName)[0];\r\n\r\n\tlet kvdata = readKeyValue2(fs.readFileSync(fullPath, 'utf-8'));\r\n\tlet kvtable = kvdata[Object.keys(kvdata)[0]];\r\n\tlet kvString = fs.readFileSync(fullPath, 'utf-8');\r\n\tkvString = removeComment(kvString);\r\n\tconst rows: string[] = kvString.split(os.EOL);\r\n\tfor (let i = 0; i < rows.length; i++) {\r\n\t\tconst lineText: string = rows[i];\r\n\t\tif (lineText.search(/#base \".*\"/) !== -1) {\r\n\t\t\tlet basePath = lineText.split('\"')[1];\r\n\t\t\t// 找不到文件则跳过\r\n\t\t\tif (await getPathInfo(path + basePath) === false) {\r\n\t\t\t\t// vscode.window.showErrorMessage(\"文件缺失：\" + path + basePath);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tlet kv = readKeyValue2(fs.readFileSync(path + basePath, 'utf-8'));\r\n\t\t\tlet table = kv[Object.keys(kv)[0]];\r\n\t\t\tfor (const key in table) {\r\n\t\t\t\tconst value = table[key];\r\n\t\t\t\tkvtable[key] = value;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t}\r\n\treturn kvdata;\r\n}\r\n// 读取kv2格式为object（#base）包含路径信息\r\nexport async function readKeyValueWithBaseIncludePath(fullPath: string) {\r\n\tlet result: any = {};\r\n\t// 获取名字\r\n\tlet fileName: string = fullPath.split('/').pop() || '';\r\n\tlet path = fullPath.split(fileName)[0];\r\n\r\n\tlet kvdata = readKeyValue2(fs.readFileSync(fullPath, 'utf-8'));\r\n\t// 用路径索引\r\n\tresult[fullPath] = kvdata;\r\n\t// let kvtable = kvdata[Object.keys(kvdata)[0]];\r\n\tlet kvString = fs.readFileSync(fullPath, 'utf-8');\r\n\tkvString = removeComment(kvString);\r\n\tconst rows: string[] = kvString.split(os.EOL);\r\n\tfor (let i = 0; i < rows.length; i++) {\r\n\t\tconst lineText: string = rows[i];\r\n\t\tif (lineText.search(/#base \".*\"/) !== -1) {\r\n\t\t\tlet basePath = lineText.split('\"')[1];\r\n\t\t\t// 找不到文件则跳过\r\n\t\t\tif (await getPathInfo(path + basePath) === false) {\r\n\t\t\t\t// vscode.window.showErrorMessage(\"文件缺失：\" + path + basePath);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tlet kv = readKeyValue2(fs.readFileSync(path + basePath, 'utf-8'));\r\n\t\t\t// 用路径索引\r\n\t\t\tresult[path + basePath] = kv;\r\n\t\t\tlet table = kv[Object.keys(kv)[0]];\r\n\t\t\tfor (const key in table) {\r\n\t\t\t\tconst value = table[key];\r\n\t\t\t\t// kvtable[key] = value;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n}\r\nexport function removeComment(data: string): string {\r\n\tlet newData = '';\r\n\tconst rows: string[] = data.split(os.EOL);\r\n\tfor (let i = 0; i < rows.length; i++) {\r\n\t\tconst lineText: string = rows[i];\r\n\t\tlet state = 0;// 用于处理引号内的//注释\r\n\t\tfor (let char = 0; char < lineText.length; char++) {\r\n\t\t\tconst substr = lineText[char];\r\n\t\t\tif (substr === '\"') {\r\n\t\t\t\tstate = (state === 0) ? 1 : 0;\r\n\t\t\t}\r\n\t\t\t//引号里的// 不处理\r\n\t\t\tif (state !== 1 && substr === '/' && lineText[char + 1] === '/') {\r\n\t\t\t\tbreak;\r\n\t\t\t} else {\r\n\t\t\t\tnewData += substr;\r\n\t\t\t}\r\n\t\t}\r\n\t\tnewData += os.EOL;\r\n\t}\r\n\treturn newData;\r\n}\r\n// 获取从ReadKeyValue2、ReadKeyValue3、ReadKeyValueWithBase得到的对象里的第index个对象，用于去掉外层，使其与DOTA2读取的KV结构一致\r\nexport function getKeyValueObjectByIndex(obj: Table, index: number = 0) {\r\n\tif (typeof (obj) !== \"object\") {\r\n\t\treturn;\r\n\t}\r\n\treturn obj[Object.keys(obj)[index]];\r\n}\r\n// 对象覆盖\r\nexport function overrideKeyValue(mainObj: Table, obj: Table): object {\r\n\tif (typeof (mainObj) !== \"object\") {\r\n\t\treturn obj;\r\n\t}\r\n\tif (typeof (obj) !== \"object\") {\r\n\t\treturn mainObj;\r\n\t}\r\n\r\n\tfor (const k in obj) {\r\n\t\tconst v = obj[k];\r\n\t\tif (typeof (v) === \"object\") {\r\n\t\t\tmainObj[k] = overrideKeyValue(mainObj[k], v);\r\n\t\t} else {\r\n\t\t\tmainObj[k] = v;\r\n\t\t}\r\n\t}\r\n\r\n\treturn mainObj;\r\n}\r\n\r\n// 对象替换\r\nexport function replaceKeyValue(mainObj: Table, obj: Table): object {\r\n\tif (typeof (mainObj) !== \"object\") {\r\n\t\treturn obj;\r\n\t}\r\n\tif (typeof (obj) !== \"object\") {\r\n\t\treturn mainObj;\r\n\t}\r\n\r\n\tfor (const k in obj) {\r\n\t\tconst v = obj[k];\r\n\t\tif (mainObj[k] !== undefined && mainObj[k] !== null) {\r\n\t\t\tif (typeof (v) === \"object\") {\r\n\t\t\t\tmainObj[k] = overrideKeyValue(mainObj[k], v);\r\n\t\t\t} else {\r\n\t\t\t\tmainObj[k] = v;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn mainObj;\r\n}\r\n\r\n// 写入kv\r\nexport function writeKeyValue(obj: any, depth: number = 0, tab: number = 12) {\r\n\tvar str: string = '';\r\n\tif (obj === null || obj === undefined) {\r\n\t\treturn str;\r\n\t}\r\n\t// 添加制表符\r\n\tfunction addDepthTab(depth: number, addString: string): string {\r\n\t\tvar tab: string = '';\r\n\t\tfor (let d = 0; d < depth; d++) {\r\n\t\t\ttab += '\\t';\r\n\t\t}\r\n\t\ttab += addString;\r\n\t\treturn tab;\r\n\t}\r\n\t// 添加key与value之间制表符\r\n\tfunction addIntervalTab(depth: number, key: string, nTab: number = 12): string {\r\n\t\tvar tab: string = '';\r\n\t\tfor (let d = 0; d < nTab - Math.floor((depth * 4 + key.length + 2) / 4); d++) {\r\n\t\t\ttab += '\\t';\r\n\t\t}\r\n\t\treturn tab;\r\n\t}\r\n\tlet keys = Object.keys(obj).sort(function (a, b) { return Number(a) - Number(b); });\r\n\tfor (let index = 0; index < keys.length; index++) {\r\n\t\tconst key = keys[index];\r\n\t\tconst value = obj[key];\r\n\t\tif (value === undefined || value === null || (typeof (value) === \"object\" && Object.keys(value).length === 0)) {\r\n\t\t} else if (typeof (value) === 'string') {\r\n\t\t\tstr += addDepthTab(depth, '\"' + key + '\"');\r\n\t\t\tstr += addIntervalTab(depth, key, tab);\r\n\t\t\tstr += '\"' + value + '\"' + os.EOL;\r\n\t\t} else if (key === \"precache\" && typeof (value) === 'object') {\r\n\t\t\t// 特殊处理precache表\r\n\t\t\tstr += addDepthTab(depth, '\"' + key + '\"' + os.EOL);\r\n\t\t\tstr += addDepthTab(depth, '{' + os.EOL);\r\n\t\t\tfor (const precacheType in value) {\r\n\t\t\t\tconst typeList = value[precacheType];\r\n\t\t\t\tfor (const precache of typeList) {\r\n\t\t\t\t\tstr += addDepthTab(depth + 1, '\"' + precacheType + '\"');\r\n\t\t\t\t\tstr += addIntervalTab(depth + 1, precacheType, tab);\r\n\t\t\t\t\tstr += '\"' + precache + '\"' + os.EOL;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tstr += addDepthTab(depth, '}' + os.EOL);\r\n\t\t} else {\r\n\t\t\tstr += addDepthTab(depth, '\"' + key + '\"' + os.EOL);\r\n\t\t\tstr += addDepthTab(depth, '{' + os.EOL);\r\n\t\t\tstr += writeKeyValue(value, depth + 1);\r\n\t\t\tstr += addDepthTab(depth, '}' + os.EOL);\r\n\t\t}\r\n\t}\r\n\treturn str;\r\n}\r\n\r\n/** 获取kv的#base路径列表 */\r\nexport async function getBaseInfo(fullPath: string) {\r\n\tlet kvString = fs.readFileSync(fullPath, 'utf-8');\r\n\tlet result: string[] = [];\r\n\tkvString = removeComment(kvString);\r\n\tconst rows: string[] = kvString.split(os.EOL);\r\n\tfor (let i = 0; i < rows.length; i++) {\r\n\t\tconst lineText: string = rows[i];\r\n\t\tif (lineText.search(/#base \".*\"\\s/) !== -1) {\r\n\t\t\tlineText.replace(/#base \"(.*)\"/, (a: string, b) => {\r\n\t\t\t\tresult.push(b);\r\n\t\t\t\treturn a;\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n}","import { reverse } from 'dns';\r\nimport * as vscode from 'vscode';\r\nimport { readFile } from './readFile';\r\n\r\nlet langData: Table;\r\nlet reverseLangData: Table;\r\n\r\nenum LangEnum {\r\n\tschinese = \"zh-cn\",\r\n\tenglish = \"en\"\r\n};\r\nexport async function localizeInit(context: vscode.ExtensionContext) {\r\n\tlangData = {\r\n\t\t[LangEnum.schinese]: JSON.parse(await readFile(vscode.Uri.joinPath(context.extensionUri, \"package.nls.zh-cn.json\"))),\r\n\t\t[LangEnum.english]: JSON.parse(await readFile(vscode.Uri.joinPath(context.extensionUri, \"package.nls.json\")))\r\n\t};\r\n\treverseLangData = {\r\n\t\t[LangEnum.schinese]: { ...langData[LangEnum.schinese] },\r\n\t\t[LangEnum.english]: { ...langData[LangEnum.english] }\r\n\t};\r\n\tfor (const key in reverseLangData[LangEnum.schinese]) {\r\n\t\tlet value = reverseLangData[LangEnum.schinese][key];\r\n\t\treverseLangData[LangEnum.schinese][value] = key;\r\n\t\tdelete reverseLangData[LangEnum.schinese][key];\r\n\t}\r\n\tfor (const key in reverseLangData[LangEnum.english]) {\r\n\t\tlet value = reverseLangData[LangEnum.english][key];\r\n\t\treverseLangData[LangEnum.english][value] = key;\r\n\t\tdelete reverseLangData[LangEnum.english][key];\r\n\t}\r\n}\r\n/**\r\n * 获取本地化文本\r\n */\r\nexport function localize(text: string, dialogVariables?: Table, language?: \"zh-cn\" | \"en\") {\r\n\tif (langData === undefined || text === undefined) {\r\n\t\treturn text;\r\n\t}\r\n\tlet langType = language ?? vscode.env.language === \"zh-cn\" ? \"zh-cn\" : \"en\";\r\n\tlet langInfo = langData[langType];\r\n\tif (langInfo[text] !== undefined) {\r\n\t\treturn langInfo[text];\r\n\t}\r\n\tif (dialogVariables) {\r\n\t\tfor (const key in dialogVariables) {\r\n\t\t\tconst value = dialogVariables[key];\r\n\t\t\ttext.replace(/\\${' + key + '}/g, value);\r\n\t\t}\r\n\t}\r\n\treturn text;\r\n}\r\n/**\r\n * 逆向获取本地化文本\r\n */\r\nexport function reverseLocalize(text: string, dialogVariables?: Table, language?: \"zh-cn\" | \"en\") {\r\n\tif (reverseLangData === undefined || text === undefined) {\r\n\t\treturn text;\r\n\t}\r\n\tlet langType = language ?? vscode.env.language === \"zh-cn\" ? \"zh-cn\" : \"en\";\r\n\tlet langInfo = reverseLangData[langType];\r\n\tif (langInfo[text] !== undefined) {\r\n\t\treturn langInfo[text];\r\n\t}\r\n\tif (dialogVariables) {\r\n\t\tfor (const key in dialogVariables) {\r\n\t\t\tconst value = dialogVariables[key];\r\n\t\t\ttext.replace(/\\${' + key + '}/g, value);\r\n\t\t}\r\n\t}\r\n\treturn text;\r\n}\r\n/** 是否拥有本地化 */\r\nexport function hasLocalize(text: string, language?: \"zh-cn\" | \"en\") {\r\n\tif (langData === undefined) {\r\n\t\treturn false;\r\n\t}\r\n\tlet langType = language ?? vscode.env.language === \"zh-cn\" ? \"zh-cn\" : \"en\";\r\n\tlet langInfo = langData[langType];\r\n\tif (langInfo[text] !== undefined) {\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n/** 逆向查找是否拥有本地化 */\r\nexport function hasReverseLocalize(text: string, language?: \"zh-cn\" | \"en\") {\r\n\tif (reverseLangData === undefined) {\r\n\t\treturn false;\r\n\t}\r\n\tlet langType = language ?? vscode.env.language === \"zh-cn\" ? \"zh-cn\" : \"en\";\r\n\tlet langInfo = reverseLangData[langType];\r\n\tif (langInfo[text] !== undefined) {\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}","import * as fs from 'fs';\r\nimport * as os from 'os';\r\nimport { getPathInfo } from \"./pathUtils\";\r\nimport { isNumber } from \"./isNumber\";\r\n\r\nexport function obj2Lua(obj: any) {\r\n\tlet data = writeKeyValueLua(obj);\r\n\tdata = \"return {\\n\" + data + \"\\n}\";\r\n\treturn data;\r\n}\r\n\r\nexport function writeKeyValueLua(obj: any, depth: number = 1, tab: number = 12) {\r\n\tvar str: string = '';\r\n\tif (obj === null || obj === undefined) {\r\n\t\treturn str;\r\n\t}\r\n\t// 添加制表符\r\n\tfunction addDepthTab(depth: number, addString: string): string {\r\n\t\tvar tab: string = '';\r\n\t\tfor (let d = 0; d < depth; d++) {\r\n\t\t\ttab += '\\t';\r\n\t\t}\r\n\t\ttab += addString;\r\n\t\treturn tab;\r\n\t}\r\n\t// 添加key与value之间制表符\r\n\tfunction addIntervalTab(depth: number, key: string, nTab: number = 12): string {\r\n\t\tvar tab: string = '';\r\n\t\tfor (let d = 0; d < nTab - Math.floor((depth * 4 + key.length + 2) / 4); d++) {\r\n\t\t\ttab += '\\t';\r\n\t\t}\r\n\t\treturn tab;\r\n\t}\r\n\tlet keys = Object.keys(obj).sort(function (a, b) { return Number(a) - Number(b); });\r\n\tfor (let index = 0; index < keys.length; index++) {\r\n\t\tconst key = keys[index];\r\n\t\tconst value = obj[key];\r\n\t\tif (value === undefined || value === null || (typeof (value) === \"object\" && Object.keys(value).length === 0)) {\r\n\t\t} else if (typeof (value) === 'string') {\r\n\t\t\tstr += addDepthTab(depth, '[\"' + key + '\"] = ');\r\n\t\t\tif (value.indexOf(\" \") !== -1) {\r\n\t\t\t\tstr += '{' + value.split(\" \").map((a) => {\r\n\t\t\t\t\tif (isNumber(a)) {\r\n\t\t\t\t\t\treturn a;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn `\"${a}\"`;\r\n\t\t\t\t\t}\r\n\t\t\t\t}).join(\",\") + '},' + os.EOL;\r\n\t\t\t} else if (isNumber(value)) {\r\n\t\t\t\tstr += value + \",\" + os.EOL;\r\n\t\t\t} else {\r\n\t\t\t\tstr += '[[' + value + ']],' + os.EOL;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tstr += addDepthTab(depth, '[\"' + key + '\"] = {' + os.EOL);\r\n\t\t\tstr += writeKeyValueLua(value, depth + 1);\r\n\t\t\tstr += addDepthTab(depth, '},' + os.EOL);\r\n\t\t}\r\n\t}\r\n\treturn str;\r\n}","import * as fs from 'fs';\r\nimport * as path from 'path';\r\n/**\r\n * 读取路径信息\r\n * @param {string} path 路径\r\n */\r\nexport function getPathInfo(path: string): Promise<boolean | fs.Stats> {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tfs.stat(path, (err, stats) => {\r\n\t\t\tif (err) {\r\n\t\t\t\tresolve(false);\r\n\t\t\t} else {\r\n\t\t\t\tresolve(stats);\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n}\r\n\r\n/**\r\n * 创建路径\r\n * @param {string} dir 路径\r\n */\r\nexport async function makeDir(dir: string): Promise<boolean> {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tfs.mkdir(dir, err => {\r\n\t\t\tif (err) {\r\n\t\t\t\tresolve(false);\r\n\t\t\t} else {\r\n\t\t\t\tresolve(true);\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n}\r\n\r\n/**\r\n * 路径是否存在，不存在则创建\r\n * @param {string} dir 路径\r\n */\r\nexport async function dirExists(dir: string) {\r\n\tlet isExists = await getPathInfo(dir);\r\n\t//如果该路径且不是文件，返回true\r\n\tif (isExists && isExists !== true && isExists.isDirectory()) {\r\n\t\treturn true;\r\n\t} else if (isExists) {\t //如果该路径存在但是文件，返回false\r\n\t\treturn false;\r\n\t}\r\n\t//如果该路径不存在\r\n\tlet tempDir = path.parse(dir).dir;\t  //拿到上级路径\r\n\t//递归判断，如果上级目录也不存在，则会代码会在此处继续循环执行，直到目录存在\r\n\tlet status = await dirExists(tempDir);\r\n\tlet mkdirStatus;\r\n\tif (status) {\r\n\t\tmkdirStatus = await makeDir(dir);\r\n\t}\r\n\treturn mkdirStatus;\r\n}","import { TextDecoder } from \"util\";\r\nimport { Uri, workspace } from \"vscode\";\r\n\r\n/**\r\n * 读取插件内的文件\r\n */\r\nexport async function readFile(uri: Uri) {\r\n\tlet array = await workspace.fs.readFile(uri);\r\n\treturn new TextDecoder().decode(array);\r\n}","module.exports = require(\"vscode\");","module.exports = require(\"events\");","module.exports = require(\"fs\");","module.exports = require(\"os\");","module.exports = require(\"path\");","module.exports = require(\"util\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import * as vscode from 'vscode';\nimport { EventManager, EventType } from './class/event';\nimport { cmdExcel2KV } from './command/cmdExcel2KV';\nimport { init } from './init';\nimport { statusBarItemInit } from './module/statusBar';\nimport { localizeInit } from './utils/localize';\n\nexport async function activate(context: vscode.ExtensionContext) {\n\t// 基础模块单独载入\n\tawait localizeInit(context);\n\tawait statusBarItemInit(context);\n\t// 进行其他初始化\n\tawait init(context);\n\n\tvscode.workspace.onDidChangeWorkspaceFolders(async (event) => {\n\t\tawait init(context);\n\t}, null, context.subscriptions);\n\n\t/** 分发配置变更 */\n\tvscode.workspace.onDidChangeConfiguration((event) => {\n\t\tEventManager.fireEvent<vscode.ConfigurationChangeEvent>(EventType.EVENT_ON_DID_CHANGE_CONFIGURATION, event);\n\t}, null, context.subscriptions);\n\n\tcontext.subscriptions.push(vscode.commands.registerCommand('war3-tools.excel_to_lua', () => cmdExcel2KV(context)));\n}\n\nexport function deactivate() { }"],"names":["IS_SUPPORT","fs","os","path","is","TEMP_DIR","tmpdir","process","env","TMPDIR","TEMP","cwd","TempStack","this","stack","prototype","create","type","base","name","join","Math","random","toString","substr","push","write","i","arguments","length","writeFileSync","mkdir","mkdirSync","cleanup","fn","temp","pop","file","unlinkSync","directory","rmdirSync","func","pending","module","exports","hasNativeRecursive","undefined","setTimeout","watcher","parent","child","watch","recursive","e","code","timer","close","on","evt","basename","clearTimeout","matchObject","item","str","Object","call","checkStat","err","test","console","warn","nil","array","Array","isArray","emptyObject","key","buffer","Buffer","isBuffer","regExp","string","number","exists","existsSync","n","statSync","isFile","samePath","a","b","resolve","isDirectory","symbolicLink","lstatSync","isSymbolicLink","windows","platform","util","events","EVENT_REMOVE","SKIP_FLAG","Symbol","unique","arr","filter","v","self","indexOf","assertEncoding","encoding","isEncoding","Error","createDupsFilter","memo","keys","forEach","apply","getSubDirectories","dir","done","readdir","all","f","sdir","semaphore","final","counter","nullCounter","shouldNotSkip","filePath","deprecationWarning","deprecate","Watcher","EventEmitter","watchers","_isReady","_isClosed","emitReady","nextTick","emit","emitClose","composeWatcher","filterDups","w","getWatchedPaths","promises","map","Promise","then","result","ret","reduce","acc","concat","expose","fpath","options","watchFile","watchDirectory","inherits","isClosed","fullPath","add","info","watcherPath","handlePublicEvents","cache","delay","handle","filtered","reg","some","c","replace","m","getMessages","msg","from","rawEvt","debounce","compareName","arg","action","flag","rawName","has","opts","assign","d","EventType","EventManager","static","eventType","event","eventList","callback","index","splice","async","eachExcelConfig","config","kvDir","excelDir","isAbsolute","normalize","realKvDir","realExcelDir","rootPath","getRootPath","excel2kv","method","getPathInfo","showStatusBarMessage","localize","vscode","window","showErrorMessage","value","dirExists","changeStatusBarState","StatusBarState","LOADING","messageIndex","fileType","workspace","stat","Uri","FileType","Directory","files","readDirectory","fileName","search","File","csvPath","dirname","extname","obj2Lua","refreshStatusBarMessage","ALL_DONE","context","abilityExcelConfig","getConfiguration","get","abilityCSV2KV","unitExcelConfig","unitCSV2KV","ENUM_STATUS_BAR_MESSAGE_TIMEOUT","moduleList","listenerAbilityExcelInit","listenerUnitExcelInit","skipModuleList","eventID","configName","moduleListConfig","isSkipModule","moduleName","listenToEvent","EVENT_ON_DID_CHANGE_CONFIGURATION","affectsConfiguration","timeRecord","Date","valueOf","newModuleListConfig","getStatusBarItem","text","fileWatcher","startWatch","kvName","stopWatch","listenerConfig","ability_excel","writeKeyValue","KeyValue","unit_excel","output","statusBarItem","createStatusBarItem","StatusBarAlignment","Left","messageList","showOutput","subscriptions","createOutputChannel","show","commands","registerCommand","data","hide","command","hideAfterTimeout","tooltip","max","MarkdownString","recordMessage","setStatusBarMessage","appendLine","state","csvParse","csv","col","row","readValue","bLast","array2csv","titleCount","rows","j","q","EOL","bVertical","arrCSV","csvConfigs","arrLine","lineID","columnKey","sc","obj","keySc","__key_sc","lineInfo","sChineseKey","y","oLineInfo","split","values","anything","listenPath","csvArr","readFileSync","csvKey","keySplit","arrDefault","arrKeyDepth","csvData","lineObj","x","tempObj","depth","sKeyDepth","error","log","specialCount","precacheCount","abilitySpecial","abilityValues","precacheResource","precache","valuesObj","keyArr","valueArr","var_type","_key","_value","String","AbilitySpecial","AbilityValues","PrecacheResource","wearableCount","attachWearables","readBlock","block","_block","ItemDef","Creature","AttachWearables","folders","workspaceFolders","uri","fsPath","s","readKeyValue2","kvdata","bRemoveComment","bOverride","removeComment","kvObj","overrideIndex","getBase","readKeyValue","startIndex","getContent","getTable","kv","newIndex","getKv3Block","readKeyValue3","content","left","right","newLine","readTable","readArray","isNumber","newData","lineText","char","overrideKeyValue","mainObj","k","kvtable","kvString","basePath","table","tab","addDepthTab","addString","addIntervalTab","nTab","floor","sort","Number","precacheType","typeList","langData","reverseLangData","LangEnum","schinese","JSON","parse","readFile","joinPath","extensionUri","english","dialogVariables","language","langType","langInfo","writeKeyValueLua","reject","stats","makeDir","isExists","mkdirStatus","tempDir","TextDecoder","decode","require","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","localizeInit","statusBarItemInit","init","onDidChangeWorkspaceFolders","onDidChangeConfiguration","fireEvent","cmdExcel2KV"],"sourceRoot":""}