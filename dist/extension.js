(()=>{var e={530:(e,t,n)=>{var i,r=n(147),o=n(37),a=n(17),s=n(43),c=o.tmpdir&&o.tmpdir()||process.env.TMPDIR||process.env.TEMP||process.cwd();function l(){this.stack=[]}l.prototype={create:function(e,t){var n=a.join(t,"node-watch-"+Math.random().toString(16).substr(2));return this.stack.push({name:n,type:e}),n},write:function(){for(var e=0;e<arguments.length;++e)r.writeFileSync(arguments[e]," ")},mkdir:function(){for(var e=0;e<arguments.length;++e)r.mkdirSync(arguments[e])},cleanup:function(e){try{for(var t;t=this.stack.pop();){var n=t.type,i=t.name;"file"===n&&s.file(i)?r.unlinkSync(i):"dir"===n&&s.directory(i)&&r.rmdirSync(i)}}finally{s.func(e)&&e()}}};var u=!1;e.exports=function e(t){if(!s.func(t))return!1;if(void 0!==i)return t(i);if(u)return setTimeout((function(){e(t)}),300);u=!0;var n,o=new l,f=o.create("dir",c),h=o.create("dir",f),d=o.create("file",h);o.mkdir(f,h);try{n=r.watch(f,{recursive:!0})}catch(e){if("ERR_FEATURE_UNAVAILABLE_ON_PLATFORM"==e.code)return t(i=!1);throw e}if(!n)return!1;var g=setTimeout((function(){n.close(),o.cleanup((function(){t(i=!1)}))}),200);n.on("change",(function(e,r){a.basename(d)===a.basename(r)&&(n.close(),clearTimeout(g),o.cleanup((function(){t(i=!0)})))})),o.write(d)}},43:(e,t,n)=>{var i=n(147),r=n(17),o=n(37);function a(e,t){return Object.prototype.toString.call(e)==="[object "+t+"]"}function s(e,t){try{return t(e)}catch(t){if(/^(ENOENT|EPERM|EACCES)$/.test(t.code))return"ENOENT"!==t.code&&console.warn("Warning: Cannot access %s",e),!1;throw t}}var c={nil:function(e){return null==e},array:function(e){return Array.isArray(e)},emptyObject:function(e){for(var t in e)return!1;return!0},buffer:function(e){return Buffer.isBuffer(e)},regExp:function(e){return a(e,"RegExp")},string:function(e){return a(e,"String")},func:function(e){return"function"==typeof e},number:function(e){return a(e,"Number")},exists:function(e){return i.existsSync(e)},file:function(e){return s(e,(function(e){return i.statSync(e).isFile()}))},samePath:function(e,t){return r.resolve(e)===r.resolve(t)},directory:function(e){return s(e,(function(e){return i.statSync(e).isDirectory()}))},symbolicLink:function(e){return s(e,(function(e){return i.lstatSync(e).isSymbolicLink()}))},windows:function(){return"win32"===o.platform()}};e.exports=c},978:(e,t,n)=>{var i=n(147),r=n(17),o=n(837),a=n(361),s=n(530),c=n(43),l="remove",u=Symbol("skip");function f(e){return e.filter((function(e,t,n){return n.indexOf(e)===t}))}function h(e){if(e&&"buffer"!==e&&!Buffer.isEncoding(e))throw new Error("Unknown encoding: "+e)}function d(){var e={};return function(t){return function(n,i){e[n+i]=[n,i],setTimeout((function(){Object.keys(e).forEach((function(n){t.apply(null,e[n])})),e={}}))}}}function g(e,t,n=function(){}){c.directory(e)?i.readdir(e,(function(i,o){if(i){if(!/^(EPERM|EACCES)$/.test(i.code))throw i;console.warn("Warning: Cannot access %s.",e)}else o.forEach((function(n){var i=r.join(e,n);c.directory(i)&&t(i)})),n()})):n()}function v(e){var t=0;return function(){return t++,function(){0==--t&&e()}}}function p(){return function(){}}function y(e,t){return!c.func(t)||t(e,u)!==u}var m=o.deprecate((function(){}),"(node-watch) First param in callback function  is replaced with event name since 0.5.0, use  `(evt, filename) => {}` if you want to get the filename");function E(){a.EventEmitter.call(this),this.watchers={},this._isReady=!1,this._isClosed=!1}function w(e){e._isReady||(e._isReady=!0,process.nextTick((function(){e.emit("ready")})))}function _(e){e.emit("close")}function b(e){var t=new E,n=d(),i=e.length;return e.forEach((function(e){e.on("change",n((function(e,n){t.emit("change",e,n)}))),e.on("error",(function(e){t.emit("error",e)})),e.on("ready",(function(){--i||w(t)}))})),t.close=function(){e.forEach((function(e){e.close()})),process.nextTick(_,t)},t.getWatchedPaths=function(t){if(c.func(t)){var n=e.map((function(e){return new Promise((function(t){e.getWatchedPaths(t)}))}));Promise.all(n).then((function(e){var n=f(e.reduce((function(e,t){return e.concat(t)}),[]));t(n)}))}},t.expose()}function S(e,t,n){var i=new E;if(c.buffer(e)&&(e=e.toString()),c.array(e)||c.exists(e)||i.emit("error",new Error(e+" does not exist.")),c.string(t)&&(t={encoding:t}),c.func(t)&&(n=t,t={}),arguments.length<2&&(t={}),t.encoding?h(t.encoding):t.encoding="utf8",c.array(e)){if(1===e.length)return S(e[0],t,n);var r=d();return b(f(e).map((function(e){var i=S(e,t);return c.func(n)&&i.on("change",r(n)),i})))}if(c.file(e))i.watchFile(e,t,n),w(i);else if(c.directory(e)){var o=v((function(){w(i)}));i.watchDirectory(e,t,n,o)}return i.expose()}o.inherits(E,a.EventEmitter),E.prototype.expose=function(){var e={},t=this;return["on","emit","once","close","isClosed","listeners","setMaxListeners","getMaxListeners","getWatchedPaths"].forEach((function(n){e[n]=function(){return t[n].apply(t,arguments)}})),e},E.prototype.isClosed=function(){return this._isClosed},E.prototype.close=function(e){var t=this;if(e){var n=this.watchers[e];n&&n.close&&(n.close(),delete t.watchers[e]),g(e,(function(e){t.close(e)}))}else Object.keys(t.watchers).forEach((function(e){var n=t.watchers[e];n&&n.close&&n.close()})),this.watchers={};c.emptyObject(t.watchers)&&(this._isClosed||(this._isClosed=!0,process.nextTick(_,this)))},E.prototype.getWatchedPaths=function(e){if(c.func(e)){var t=this;t._isReady?e(Object.keys(t.watchers)):t.on("ready",(function(){e(Object.keys(t.watchers))}))}},E.prototype.add=function(e,t){var n=this;t=t||{fpath:""};var i=r.resolve(t.fpath);this.watchers[i]=e;var o=function(e,t){var n,i=[],r=e.options.encoding,o=e.options.delay;function a(){(function(e){var t=f(e),n=/~$|^\.#|^##$/g;return e.some((function(e){return n.test(e)}))&&e.map((function(e){return e.replace(n,"")})).some((function(e,t,n){return n.indexOf(e)!==t}))&&(t=t.filter((function(e){return c.exists(e)}))),t.map((function(e){return c.exists(e)?["update",e]:[l,e]}))})(i).forEach((function(e){e[1]=Buffer.from(e[1]),"buffer"!==r&&(e[1]=e[1].toString(r)),t.apply(null,e)})),n=null,i=[]}return c.number(o)||(o=200),function(e,t){i.push(t),n||(n=setTimeout(a,o))}}(t,(function(e,i){var r;t.compareName?t.compareName(i)&&n.emit("change",e,i):(r=t.options.filter,c.func(r)?function(e,t){r(e,!1)&&t()}:c.regExp(r)?function(e,t){r.test(e)&&t()}:function(e,t){t()})(i,(function(){n.flag?n.flag="":n.emit("change",e,i)}))}));e.on("error",(function(r){n.isClosed()||(c.windows()&&"EPERM"===r.code?(e.emit("change",l,t.fpath&&""),n.flag="windows-error",n.close(i)):n.emit("error",r))})),e.on("change",(function(e,i){if(!n.isClosed()){var a=i;c.nil(a)&&(a=""),a=r.join(t.fpath,a),t.options.recursive&&s((function(e){if(!e){var i=r.resolve(a);c.exists(a)?c.directory(a)&&!n.watchers[i]&&y(a,t.options.filter)&&n.watchDirectory(a,t.options):n.close(i)}})),o(e,a)}}))},E.prototype.watchFile=function(e,t,n){var o=r.join(e,"../"),a=Object.assign({},t,{filter:null,encoding:"utf8"});delete a.recursive;var s=i.watch(o,a);this.add(s,{type:"file",fpath:o,options:Object.assign({},a,{encoding:t.encoding}),compareName:function(t){return c.samePath(t,e)}}),c.func(n)&&(1===n.length&&m(),this.on("change",n))},E.prototype.watchDirectory=function(e,t,n,r=p){var o=this,a=r();s((function(s){t.recursive=!!t.recursive;var l=Object.assign({},t,{encoding:"utf8"});if(s||delete l.recursive,o._isClosed)return a(),o.close();var u=i.watch(e,l);o.add(u,{type:"dir",fpath:e,options:t}),c.func(n)&&(1===n.length&&m(),o.on("change",n)),t.recursive&&!s&&g(e,(function(e){y(e,t.filter)&&o.watchDirectory(e,t,null,r)}),r()),a()}))},e.exports=S,e.exports.default=S},282:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.EventManager=t.EventType=void 0,(n=t.EventType||(t.EventType={}))[n.EVENT_ON_DID_CHANGE_WORKSPACE_FOLDERS=0]="EVENT_ON_DID_CHANGE_WORKSPACE_FOLDERS",n[n.EVENT_ON_DID_CHANGE_CONFIGURATION=1]="EVENT_ON_DID_CHANGE_CONFIGURATION";class i{static fireEvent(e,t){if(i.eventList[e])for(const n of i.eventList[e])n(t)}static listenToEvent(e,t){return void 0===i.eventList[e]&&(i.eventList[e]=[]),i.eventList[e].push(t),i.eventList[e].length-1}static stopListenToEvent(e,t){i.eventList[e]&&i.eventList[e].splice(t,1)}}t.EventManager=i,i.eventList={}},311:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.excel2kv=t.eachExcelConfig=t.cmdExcel2KV=void 0;const i=n(496),r=n(17),o=n(147),a=n(820),s=n(242),c=n(290),l=n(178),u=n(490),f=n(910);async function h(e,t){for(const n in e){const i=e[n];if(r.isAbsolute(i)){if(void 0!==t(r.normalize(n),r.normalize(i)))break}else{let e=n,o=i;const a=(0,s.getRootPath)();if(a&&(!1===r.isAbsolute(e)&&(e=r.join(a,n)),!1===r.isAbsolute(o)&&(o=r.join(a,i))),void 0!==t(r.normalize(e),r.normalize(o)))break}}}async function d(e,t,n){if(!1===await(0,u.getPathInfo)(e))return(0,c.showStatusBarMessage)(`[${(0,l.localize)("cmdExcel2KV")}]：`+(0,l.localize)("path_no_found")+e),void i.window.showErrorMessage(`[${(0,l.localize)("cmdExcel2KV")}]：`+(0,l.localize)("path_no_found")+`(${e})`+(0,l.localize)("sure create folder"),(0,l.localize)("confirm"),(0,l.localize)("cancel")).then((t=>{t==(0,l.localize)("confirm")&&(0,u.dirExists)(e)}));if(!1===await(0,u.getPathInfo)(t))return void(0,c.showStatusBarMessage)(`[${(0,l.localize)("cmdExcel2KV")}]：`+(0,l.localize)("path_no_found")+t);(0,c.changeStatusBarState)(c.StatusBarState.LOADING);let a=(0,c.showStatusBarMessage)(`[${(0,l.localize)("cmdExcel2KV")}]：`+t),s=(await i.workspace.fs.stat(i.Uri.file(t))).type;if(s===i.FileType.Directory){let s=await i.workspace.fs.readDirectory(i.Uri.file(t));for(let h=0;h<s.length;h++){let[d,g]=s[h];if(void 0!==d&&-1===d.search(/~\$/)&&g===i.FileType.File){let i=r.join(t,d),s=r.join(r.dirname(i),"csv",r.basename(i).replace(r.extname(i),".csv"));if(!1===await(0,u.getPathInfo)(s))return void(0,c.showStatusBarMessage)(`[${(0,l.localize)("cmdExcel2KV")}]：`+(0,l.localize)("path_no_found")+s);await(0,u.dirExists)(r.join(e,r.dirname(d.replace(r.extname(d),".lua")))),o.writeFileSync(r.join(e,d.replace(r.extname(d),".lua")),(0,f.obj2Lua)(n(s))),(0,c.refreshStatusBarMessage)(a,`[${(0,l.localize)("cmdExcel2KV")}]：`+d)}}}else if(s===i.FileType.File){let i=r.join(r.dirname(t),"csv",r.basename(t).replace(r.extname(t),".csv"));if(!1===await(0,u.getPathInfo)(i))return void(0,c.showStatusBarMessage)(`[${(0,l.localize)("cmdExcel2KV")}]：`+(0,l.localize)("path_no_found")+i);await(0,u.dirExists)(e),o.writeFileSync(e,(0,f.obj2Lua)(n(i))),(0,c.refreshStatusBarMessage)(a,`[${(0,l.localize)("cmdExcel2KV")}]：`+r.basename(t))}(0,c.changeStatusBarState)(c.StatusBarState.ALL_DONE)}t.cmdExcel2KV=function(e){let t=i.workspace.getConfiguration().get("war3-tools.A2.AbilityExcel");t&&h(t,((e,t)=>{d(e,t,a.abilityCSV2KV)}));let n=i.workspace.getConfiguration().get("war3-tools.A2.UnitExcel");n&&h(n,((e,t)=>{d(e,t,a.unitCSV2KV)}))},t.eachExcelConfig=h,t.excel2kv=d},397:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ENUM_STATUS_BAR_MESSAGE_TIMEOUT=void 0,t.ENUM_STATUS_BAR_MESSAGE_TIMEOUT=5},616:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;const i=n(496),r=n(884),o=n(981),a=n(290),s=n(178),c=n(282),l={listenerAbilityExcelInit:r.listenerAbilityExcelInit,listenerUnitExcelInit:o.listenerUnitExcelInit},u={addonInfoInit:"addon_info"};let f;const h="war3-tools.A1.module_list";let d=i.workspace.getConfiguration().get(h);function g(e){return void 0!==u[e]&&null!=d&&!1===d[u[e]]}t.init=async function(e){void 0===f&&(f=c.EventManager.listenToEvent(c.EventType.EVENT_ON_DID_CHANGE_CONFIGURATION,(async t=>{if(!t.affectsConfiguration(h))return;let n=(new Date).valueOf(),r=i.workspace.getConfiguration().get(h);const o=Object.keys(l);for(let t=0;t<o.length;t++){const i=o[t];if(r&&g(i)&&!1!==r[u[i]]){let r=(0,a.showStatusBarMessage)(`[${t+1}/${o.length}]${(0,s.localize)("loading")}：${(0,s.localize)(i)}`,20);await l[i](e),(0,a.refreshStatusBarMessage)(r,`[${t+1}/${o.length}]${(0,s.localize)("load_complete")}：${(0,s.localize)(i)}，${(0,s.localize)("time_consuming")}：${(new Date).valueOf()-n}${(0,s.localize)("millisecond")}`,20),n=(new Date).valueOf()}}d=r})));let t=(new Date).valueOf();const n=Object.keys(l);for(let i=0;i<n.length;i++){const r=n[i];if(d&&g(r)){(0,a.showStatusBarMessage)(`[${i+1}/${n.length}]${(0,s.localize)("skip_disabled_modules")}：${(0,s.localize)(r)}`);continue}let o=(0,a.showStatusBarMessage)(`[${i+1}/${n.length}]${(0,s.localize)("loading")}：${(0,s.localize)(r)}`,20);await l[r](e),(0,a.refreshStatusBarMessage)(o,`[${i+1}/${n.length}]${(0,s.localize)("load_complete")}：${(0,s.localize)(r)}，${(0,s.localize)("time_consuming")}：${(new Date).valueOf()-t}${(0,s.localize)("millisecond")}`,20),t=(new Date).valueOf()}(0,a.showStatusBarMessage)((0,s.localize)("allLoaded"),20),(0,a.getStatusBarItem)().text="$(check-all) "+(0,s.localize)("pluginNameLite")}},884:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.listenerAbilityExcelInit=void 0;const i=n(496),r=n(147),o=n(17),a=n(978),s=n(282),c=n(242),l=n(311),u=n(820),f=n(290),h=n(910);let d,g;const v="war3-tools.A1.listener";let p;function y(e){if(void 0===g){const e=(0,c.getRootPath)();if(e){(0,f.showStatusBarMessage)("[监听目录]：技能excel");let t=i.workspace.getConfiguration().get("war3-tools.A2.AbilityExcel");g=(0,a.default)(e,{recursive:!0,filter:/\.csv$/},(function(e,n){t&&(0,l.eachExcelConfig)(t,((e,t)=>{if(o.normalize(t)==o.normalize(o.dirname(n)).replace("\\csv","")){const t=o.join(e,o.basename(n).replace(o.extname(n),".lua"));return r.writeFileSync(t,(0,h.obj2Lua)((0,u.abilityCSV2KV)(n))),(0,f.showStatusBarMessage)("[excel导出kv]："+o.basename(n).replace(o.extname(n),".lua")),!1}}))}))}}}function m(){g&&((0,f.showStatusBarMessage)("[停止监听目录]：技能excel"),g.close(),g=void 0)}function E(){let e=i.workspace.getConfiguration().get(v);if(e)return e.ability_excel||!1}t.listenerAbilityExcelInit=function(e){p=E(),E()&&y(),void 0===d&&(d=s.EventManager.listenToEvent(s.EventType.EVENT_ON_DID_CHANGE_CONFIGURATION,(e=>{e.affectsConfiguration(v)&&E()!==p&&(p=E(),E()?(m(),y()):m())})))}},981:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.listenerUnitExcelInit=void 0;const i=n(496),r=n(147),o=n(17),a=n(978),s=n(282),c=n(242),l=n(311),u=n(820),f=n(290),h=n(910);let d,g;const v="war3-tools.A1.listener";let p;function y(e){if(void 0===g){const e=(0,c.getRootPath)();if(e){(0,f.showStatusBarMessage)("[监听目录]：单位excel");let t=i.workspace.getConfiguration().get("war3-tools.A2.UnitExcel");g=(0,a.default)(e,{recursive:!0,filter:/\.csv$/},(function(e,n){t&&(0,l.eachExcelConfig)(t,((e,t)=>{if(o.normalize(t)==o.normalize(o.dirname(n)).replace("\\csv","")){const t=o.join(e,o.basename(n).replace(o.extname(n),".lua"));return r.writeFileSync(t,(0,h.obj2Lua)((0,u.unitCSV2KV)(n))),(0,f.showStatusBarMessage)("[excel导出kv]："+o.basename(n).replace(o.extname(n),".lua")),!1}}))}))}}}function m(){g&&((0,f.showStatusBarMessage)("[停止监听目录]：单位excel"),g.close(),g=void 0)}function E(){let e=i.workspace.getConfiguration().get(v);if(e)return e.unit_excel||!1}t.listenerUnitExcelInit=function(e){E()&&y(),void 0===d&&(d=s.EventManager.listenToEvent(s.EventType.EVENT_ON_DID_CHANGE_CONFIGURATION,(e=>{e.affectsConfiguration(v)&&E()!==p&&(p=E(),E()?(m(),y()):m())})))}},290:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.changeStatusBarState=t.refreshStatusBarMessage=t.showStatusBarMessage=t.getStatusBarItem=t.statusBarItemInit=t.StatusBarState=void 0;const i=n(496),r=n(397),o=n(178);let a,s=i.window.createStatusBarItem(i.StatusBarAlignment.Left,1),c=[],l=0,u=!1;var f;(f=t.StatusBarState||(t.StatusBarState={})).ALL_DONE="$(check-all)",f.LOADING="$(loading~spin)",t.statusBarItemInit=async function(e){s.text="$(loading~spin) "+(0,o.localize)("pluginNameLite"),e.subscriptions.push(s),a=i.window.createOutputChannel((0,o.localize)("pluginNameLite")),s.show(),e.subscriptions.push(i.commands.registerCommand("war3tools.showOutput",(async e=>{u?(u=!u,a.hide()):(u=!u,a.show())}))),s.command="war3tools.showOutput"},t.getStatusBarItem=function(){return s},t.showStatusBarMessage=function(e,t=r.ENUM_STATUS_BAR_MESSAGE_TIMEOUT){return function(e){c[l]=e,l++;let t=`**${(0,o.localize)("message_notification")}**  \n`;for(let e=Math.max(l-20,0);e<l;e++)t+="  \n"+c[e];s.tooltip=new i.MarkdownString(t)}(e),-1===t&&i.window.setStatusBarMessage(e),i.window.setStatusBarMessage(e,1e3*t),a.appendLine(e),l-1},t.refreshStatusBarMessage=function(e,t,n=r.ENUM_STATUS_BAR_MESSAGE_TIMEOUT){c[e]&&(c[e]=t),a.appendLine(t),i.window.setStatusBarMessage(t,1e3*n)},t.changeStatusBarState=function(e){s.text=e+" "+(0,o.localize)("pluginNameLite")}},820:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unitCSV2KV=t.abilityCSV2KV=t.multilayerCSV2KV=t.isEmptyCSVValue=t.array2csv=t.csv2array=t.csvParse=t.obj2csv=t.csv2obj=void 0;const i=n(37),r=n(147);function o(e){e=e.replace(/\r\n/g,"\n");let t=[],n=0,i=0;for(let t=0;t<e.length;t++)t=r(t);return t;function r(r){let o="",a="normal";for(let s=r;s<e.length;s++){let r=e[s],c=s===e.length-1;if('"'!==r||"normal"!==a)if('"'!==r||"string"!==a)if("\n"!==r||"string"!==a){if("\n"===r&&"normal"===a)return void 0===t[i]&&(t[i]=[]),t[i][n]=o,i++,n=0,s;if(","===r&&"string"!==a)return void 0===t[i]&&(t[i]=[]),t[i][n]=o,n++,s;if(c&&"normal"===a)return void 0===t[i]&&(t[i]=[]),o+=r,t[i][n]=o,i++,n=0,s;o+=r}else o+=r;else a="normal";else a="string"}}}function a(e){let t="",n=e[1].length;for(let r=0;r<e.length;r++){const o=e[r];for(let e=0;e<o.length&&(void 0!==o[0]||0!==o.length);e++){let n=void 0===o[e]?"":o[e];-1!==n.indexOf(",")&&(n='"'+n+'"'),t+=n+(e+1===o.length?"":",")}if(void 0!==o[0]||o.length>0){for(let e=0;e<n-o.length;e++)t+=",";t+=i.EOL}if(0===o.length){for(let e=0;e<n-1;e++)t+=",";t+=i.EOL}}return t}t.csv2obj=function(e,t=!1){let n=e;"string"==typeof e&&(n=o(e));let i={};if(t)for(let e=0;e<n.length;e++){let t=n[e];i[t[1]]=t[2]}else{if(n.length<3)return i;let e=n[1];for(let t=2;t<n.length;t++){let r=n[t],o=r[0];if(o){i[o]={};for(let t=0;t<r.length;t++){if(!e[t]||""===e[t])continue;let n=r[t]||"",a=e[t];if("AttachWearables"===e[t])for(let e=1;e<30;e++)if(!i[o]["AttachWearables"+e]){a="AttachWearables"+e;break}i[o][a]=n}}}i.__key_sc={};for(let t=0;t<e.length;t++){let r=n[0][t]||"",o=e[t];if("AttachWearables"===e[t])for(let e=1;e<30;e++)if(!i.__key_sc["AttachWearables"+e]){o="AttachWearables"+e,r="AttachWearables"+e;break}i.__key_sc[o]=r}}return i},t.obj2csv=function(e){let t=e.__key_sc;if(!t){t={};for(let n in e){let i=e[n];for(let e in i)t[e]=e}}let n=[];n[0]=[],n[1]=[];for(let e in t){let i=t[e];n[0].push(i),-1!==e.indexOf("AttachWearables")?n[1].push("AttachWearables"):n[1].push(e)}let i=2;for(let r in e){if("__key_sc"===r)continue;n[i]=[];let o=e[r];for(let e in t){let t=o[e]||"";n[i].push(t)}i++}return a(n)},t.csvParse=o,t.csv2array=function(e){const t=e.split(i.EOL);let n=[];for(let e=0;e<t.length;e++){n[e]=[];let i=t[e].split(",");if(1!==i.length)for(let t=0;t<i.length;t++){const r=i[t];n[e].push(r)}}return n},t.array2csv=a,t.isEmptyCSVValue=function(e){return null==e||""===e},t.multilayerCSV2KV=function(e){try{let t=o(r.readFileSync(e,"utf-8")),n=t[1];for(let e=0;e<n.length;e++){let t=n[e].split("-");t.length>1&&(n[e]=t)}let i=t[2];if(0===i.length||void 0===i[0])return{};let a={},s={};for(let e=2;e<t.length;e++){const r=t[e];if(0===r.length)continue;let o;""===r[0]?o=s[i[0]]:(o={},i=[r[0]],a={});for(let e=1;e<r.length;e++){let t=r[e];""!==t?i[e]=t:t=i[e];let s=n[e];if(s instanceof Array){let e;"root"!==s[0]?(void 0===o[s[0]]&&(o[s[0]]={}),e=o[s[0]]):e=o,void 0===a[s[0]]&&(a[s[0]]={});let n=1,i=n-1;for(;n<=s.length-2;n++){i=n-1;let t=a[s[0]][i];void 0!==t&&""!==t&&void 0!==e[t]&&(e=e[t])}if(i=n-1,"value"===s[s.length-1]){let n=a[s[0]][i];if(void 0===n||""===n)continue;e[n]=t}else{let n=""===t||void 0===t?a[s[0]][i]:t;if(void 0===n||""===n)continue;a[s[0]][i]=n,void 0===e[n]&&(e[n]={})}}else{if(""===s)continue;if(void 0===t||""===t)continue;o[s]=t}}void 0!==r[0]&&""!==r[0]&&(s[r[0]]=o)}return s}catch(e){console.log(e)}},t.abilityCSV2KV=function(e){let t={},n=o(r.readFileSync(e,"utf-8"));const i=n[0];for(let e=1;e<n.length;e++){const r=n[e];if(0===r.length||void 0===r[0]||""===r[0])continue;let o=1,a=1,s={},c={},l={},u={},f={};for(let t=1;t<r.length;t++){const h=r[t];if(""===h)continue;let d=i[t];if("AbilitySpecial"===d){if(d=("0"+o).substr(-2),void 0!==n[e+1]&&""!==n[e+1]){let i=n[e+1][t],r=h.split("\n"),a=i.split("\n");s[d]={var_type:-1!==a[0].search(/\./g)?"FIELD_FLOAT":"FIELD_INTEGER"};for(let e=0;e<r.length;e++){const t=r[e];s[d][t]=a[e]}o++}}else if("AbilityValues"===d){if(void 0!==n[e+1]&&""!==n[e+1]){let i=n[e+1][t],r=h.split("\n"),o=i.split("\n");if(r.length<=1)c[r[0]]=o[0];else{c[r[0]]={};for(let e=0;e<r.length;e++){const t=r[e],n=o[e];0==e?c[r[0]].value=n:c[r[0]][t]=n}}}}else if(-1!=d.indexOf("参数")){if(void 0!==n[e+1]&&""!==n[e+1]){let i=n[e+1][t];h.split("\n"),i.split("\n"),f[h]=i}}else{if(""===d)continue;if("precache"===d){if(void 0!==n[e+1]&&""!==n[e+1]){let i=n[e+1][t];void 0===u[h]&&(u[h]=[]),u[h].push(i)}}else if("PrecacheResource"===d){if(void 0!==n[e+1]&&""!==n[e+1]){let e=h.split("\n");for(let t=0;t<e.length;t++){const n=e[t];l[String(a)]=n,a++}}}else f[d]=h}}Object.keys(s).length>0&&(f.AbilitySpecial=s),Object.keys(c).length>0&&(f.AbilityValues=c),Object.keys(u).length>0&&(f.precache=u),Object.keys(l).length>0&&(f.PrecacheResource=l),e++,t[r[0]]=f}return t},t.unitCSV2KV=function(e){let t={},n=o(r.readFileSync(e,"utf-8"));const i=n[0];for(let e=1;e<n.length;e++){const r=n[e];if(0===r.length||""===r[0]||void 0===r[0])continue;let o=1,a={},s={},c=function(e){let t={};for(let n=e+1;n<r.length;n++){const e=r[n],o=i[n];if(""!==e)""!==o&&(t[o]=e);else if(-1!==o.search("[{]")){let[e,i]=c(n);n=i,Object.keys(e).length>0&&(t[o.split("[{]")[0]]=e)}else if(-1!==o.search("[}]"))return[t,n]}};for(let e=1;e<r.length;e++){const t=r[e];let n=i[e];if(""!==t)if("AttachWearables"===n){n=o.toString();let e=t;a[n]={ItemDef:e},o++}else{if("CanRespawn"===n||"DisableClumpingBehavior"===n||"UsesGestureBasedAttackAnimation"===n||"ShouldDoFlyHeightVisual"===n||"IsHybridFlyer"===n){void 0===s.Creature&&(s.Creature={}),s.Creature[n]=t;continue}if(""===n)continue;s[n]=t}else if(-1!==n.search("[{]")){let[t,i]=c(e);e=i,Object.keys(t).length>0&&(s[n.split("[{]")[0]]=t)}}Object.keys(a).length>0&&(void 0===s.Creature&&(s.Creature={}),s.Creature.AttachWearables=a),t[r[0]]=s}return t}},242:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRootPath=void 0;const i=n(496);t.getRootPath=function(){const e=i.workspace.workspaceFolders;return void 0!==e?e[0].uri.fsPath:void 0}},521:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isNumber=void 0,t.isNumber=function(e){return!!/^(-?\d+)(\.\d+)?$/.test(e)}},178:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hasReverseLocalize=t.hasLocalize=t.reverseLocalize=t.localize=t.localizeInit=void 0;const i=n(496),r=n(685);let o,a;var s;!function(e){e.schinese="zh-cn",e.english="en"}(s||(s={})),t.localizeInit=async function(e){o={[s.schinese]:JSON.parse(await(0,r.readFile)(i.Uri.joinPath(e.extensionUri,"package.nls.zh-cn.json"))),[s.english]:JSON.parse(await(0,r.readFile)(i.Uri.joinPath(e.extensionUri,"package.nls.json")))},a={[s.schinese]:{...o[s.schinese]},[s.english]:{...o[s.english]}};for(const e in a[s.schinese]){let t=a[s.schinese][e];a[s.schinese][t]=e,delete a[s.schinese][e]}for(const e in a[s.english]){let t=a[s.english][e];a[s.english][t]=e,delete a[s.english][e]}},t.localize=function(e,t,n){if(void 0===o||void 0===e)return e;let r=n??"zh-cn"===i.env.language?"zh-cn":"en",a=o[r];if(void 0!==a[e])return a[e];if(t)for(const n in t){const i=t[n];e.replace(/\${' + key + '}/g,i)}return e},t.reverseLocalize=function(e,t,n){if(void 0===a||void 0===e)return e;let r=n??"zh-cn"===i.env.language?"zh-cn":"en",o=a[r];if(void 0!==o[e])return o[e];if(t)for(const n in t){const i=t[n];e.replace(/\${' + key + '}/g,i)}return e},t.hasLocalize=function(e,t){if(void 0===o)return!1;let n=t??"zh-cn"===i.env.language?"zh-cn":"en";return void 0!==o[n][e]},t.hasReverseLocalize=function(e,t){if(void 0===a)return!1;let n=t??"zh-cn"===i.env.language?"zh-cn":"en";return void 0!==a[n][e]}},910:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.writeKeyValueLua=t.obj2Lua=void 0;const i=n(37),r=n(521);function o(e,t=1,n=12){var a="";if(null==e)return a;function s(e,t){var n="";for(let t=0;t<e;t++)n+="\t";return n+t}let c=Object.keys(e).sort((function(e,t){return Number(e)-Number(t)}));for(let n=0;n<c.length;n++){const l=c[n],u=e[l];null==u||"object"==typeof u&&0===Object.keys(u).length||("string"==typeof u?(a+=s(t,'["'+l+'"] = '),-1!==u.indexOf(" ")?a+="{"+u.split(" ").map((e=>(0,r.isNumber)(e)?e:`"${e}"`)).join(",")+"},"+i.EOL:(0,r.isNumber)(u)?a+=u+","+i.EOL:a+="[["+u+"]],"+i.EOL):(a+=s(t,'["'+l+'"] = {'+i.EOL),a+=o(u,t+1),a+=s(t,"},"+i.EOL)))}return a}t.obj2Lua=function(e){let t=o(e);return t="return {\n"+t+"\n}",t},t.writeKeyValueLua=o},490:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dirExists=t.makeDir=t.getPathInfo=void 0;const i=n(147),r=n(17);function o(e){return new Promise(((t,n)=>{i.stat(e,((e,n)=>{t(!e&&n)}))}))}async function a(e){return new Promise(((t,n)=>{i.mkdir(e,(e=>{t(!e)}))}))}t.getPathInfo=o,t.makeDir=a,t.dirExists=async function e(t){let n=await o(t);if(n&&!0!==n&&n.isDirectory())return!0;if(n)return!1;let i,s=r.parse(t).dir;return await e(s)&&(i=await a(t)),i}},685:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readFile=void 0;const i=n(837),r=n(496);t.readFile=async function(e){let t=await r.workspace.fs.readFile(e);return(new i.TextDecoder).decode(t)}},496:e=>{"use strict";e.exports=require("vscode")},361:e=>{"use strict";e.exports=require("events")},147:e=>{"use strict";e.exports=require("fs")},37:e=>{"use strict";e.exports=require("os")},17:e=>{"use strict";e.exports=require("path")},837:e=>{"use strict";e.exports=require("util")}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,n),o.exports}var i={};(()=>{"use strict";var e=i;Object.defineProperty(e,"__esModule",{value:!0}),e.deactivate=e.activate=void 0;const t=n(496),r=n(282),o=n(311),a=n(616),s=n(290),c=n(178);e.activate=async function(e){await(0,c.localizeInit)(e),await(0,s.statusBarItemInit)(e),await(0,a.init)(e),t.workspace.onDidChangeWorkspaceFolders((async t=>{await(0,a.init)(e)}),null,e.subscriptions),t.workspace.onDidChangeConfiguration((e=>{r.EventManager.fireEvent(r.EventType.EVENT_ON_DID_CHANGE_CONFIGURATION,e)}),null,e.subscriptions),e.subscriptions.push(t.commands.registerCommand("war3-tools.excel_to_lua",(()=>(0,o.cmdExcel2KV)(e))))},e.deactivate=function(){}})(),module.exports=i})();