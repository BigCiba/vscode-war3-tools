(()=>{var e={530:(e,t,n)=>{var i,r=n(147),o=n(37),s=n(17),a=n(43),l=o.tmpdir&&o.tmpdir()||process.env.TMPDIR||process.env.TEMP||process.cwd();function c(){this.stack=[]}c.prototype={create:function(e,t){var n=s.join(t,"node-watch-"+Math.random().toString(16).substr(2));return this.stack.push({name:n,type:e}),n},write:function(){for(var e=0;e<arguments.length;++e)r.writeFileSync(arguments[e]," ")},mkdir:function(){for(var e=0;e<arguments.length;++e)r.mkdirSync(arguments[e])},cleanup:function(e){try{for(var t;t=this.stack.pop();){var n=t.type,i=t.name;"file"===n&&a.file(i)?r.unlinkSync(i):"dir"===n&&a.directory(i)&&r.rmdirSync(i)}}finally{a.func(e)&&e()}}};var u=!1;e.exports=function e(t){if(!a.func(t))return!1;if(void 0!==i)return t(i);if(u)return setTimeout((function(){e(t)}),300);u=!0;var n,o=new c,f=o.create("dir",l),h=o.create("dir",f),d=o.create("file",h);o.mkdir(f,h);try{n=r.watch(f,{recursive:!0})}catch(e){if("ERR_FEATURE_UNAVAILABLE_ON_PLATFORM"==e.code)return t(i=!1);throw e}if(!n)return!1;var g=setTimeout((function(){n.close(),o.cleanup((function(){t(i=!1)}))}),200);n.on("change",(function(e,r){s.basename(d)===s.basename(r)&&(n.close(),clearTimeout(g),o.cleanup((function(){t(i=!0)})))})),o.write(d)}},43:(e,t,n)=>{var i=n(147),r=n(17),o=n(37);function s(e,t){return Object.prototype.toString.call(e)==="[object "+t+"]"}function a(e,t){try{return t(e)}catch(t){if(/^(ENOENT|EPERM|EACCES)$/.test(t.code))return"ENOENT"!==t.code&&console.warn("Warning: Cannot access %s",e),!1;throw t}}var l={nil:function(e){return null==e},array:function(e){return Array.isArray(e)},emptyObject:function(e){for(var t in e)return!1;return!0},buffer:function(e){return Buffer.isBuffer(e)},regExp:function(e){return s(e,"RegExp")},string:function(e){return s(e,"String")},func:function(e){return"function"==typeof e},number:function(e){return s(e,"Number")},exists:function(e){return i.existsSync(e)},file:function(e){return a(e,(function(e){return i.statSync(e).isFile()}))},samePath:function(e,t){return r.resolve(e)===r.resolve(t)},directory:function(e){return a(e,(function(e){return i.statSync(e).isDirectory()}))},symbolicLink:function(e){return a(e,(function(e){return i.lstatSync(e).isSymbolicLink()}))},windows:function(){return"win32"===o.platform()}};e.exports=l},978:(e,t,n)=>{var i=n(147),r=n(17),o=n(837),s=n(361),a=n(530),l=n(43),c="remove",u=Symbol("skip");function f(e){return e.filter((function(e,t,n){return n.indexOf(e)===t}))}function h(e){if(e&&"buffer"!==e&&!Buffer.isEncoding(e))throw new Error("Unknown encoding: "+e)}function d(){var e={};return function(t){return function(n,i){e[n+i]=[n,i],setTimeout((function(){Object.keys(e).forEach((function(n){t.apply(null,e[n])})),e={}}))}}}function g(e,t,n=function(){}){l.directory(e)?i.readdir(e,(function(i,o){if(i){if(!/^(EPERM|EACCES)$/.test(i.code))throw i;console.warn("Warning: Cannot access %s.",e)}else o.forEach((function(n){var i=r.join(e,n);l.directory(i)&&t(i)})),n()})):n()}function p(e){var t=0;return function(){return t++,function(){0==--t&&e()}}}function v(){return function(){}}function y(e,t){return!l.func(t)||t(e,u)!==u}var E=o.deprecate((function(){}),"(node-watch) First param in callback function  is replaced with event name since 0.5.0, use  `(evt, filename) => {}` if you want to get the filename");function m(){s.EventEmitter.call(this),this.watchers={},this._isReady=!1,this._isClosed=!1}function w(e){e._isReady||(e._isReady=!0,process.nextTick((function(){e.emit("ready")})))}function b(e){e.emit("close")}function _(e){var t=new m,n=d(),i=e.length;return e.forEach((function(e){e.on("change",n((function(e,n){t.emit("change",e,n)}))),e.on("error",(function(e){t.emit("error",e)})),e.on("ready",(function(){--i||w(t)}))})),t.close=function(){e.forEach((function(e){e.close()})),process.nextTick(b,t)},t.getWatchedPaths=function(t){if(l.func(t)){var n=e.map((function(e){return new Promise((function(t){e.getWatchedPaths(t)}))}));Promise.all(n).then((function(e){var n=f(e.reduce((function(e,t){return e.concat(t)}),[]));t(n)}))}},t.expose()}function O(e,t,n){var i=new m;if(l.buffer(e)&&(e=e.toString()),l.array(e)||l.exists(e)||i.emit("error",new Error(e+" does not exist.")),l.string(t)&&(t={encoding:t}),l.func(t)&&(n=t,t={}),arguments.length<2&&(t={}),t.encoding?h(t.encoding):t.encoding="utf8",l.array(e)){if(1===e.length)return O(e[0],t,n);var r=d();return _(f(e).map((function(e){var i=O(e,t);return l.func(n)&&i.on("change",r(n)),i})))}if(l.file(e))i.watchFile(e,t,n),w(i);else if(l.directory(e)){var o=p((function(){w(i)}));i.watchDirectory(e,t,n,o)}return i.expose()}o.inherits(m,s.EventEmitter),m.prototype.expose=function(){var e={},t=this;return["on","emit","once","close","isClosed","listeners","setMaxListeners","getMaxListeners","getWatchedPaths"].forEach((function(n){e[n]=function(){return t[n].apply(t,arguments)}})),e},m.prototype.isClosed=function(){return this._isClosed},m.prototype.close=function(e){var t=this;if(e){var n=this.watchers[e];n&&n.close&&(n.close(),delete t.watchers[e]),g(e,(function(e){t.close(e)}))}else Object.keys(t.watchers).forEach((function(e){var n=t.watchers[e];n&&n.close&&n.close()})),this.watchers={};l.emptyObject(t.watchers)&&(this._isClosed||(this._isClosed=!0,process.nextTick(b,this)))},m.prototype.getWatchedPaths=function(e){if(l.func(e)){var t=this;t._isReady?e(Object.keys(t.watchers)):t.on("ready",(function(){e(Object.keys(t.watchers))}))}},m.prototype.add=function(e,t){var n=this;t=t||{fpath:""};var i=r.resolve(t.fpath);this.watchers[i]=e;var o=function(e,t){var n,i=[],r=e.options.encoding,o=e.options.delay;function s(){(function(e){var t=f(e),n=/~$|^\.#|^##$/g;return e.some((function(e){return n.test(e)}))&&e.map((function(e){return e.replace(n,"")})).some((function(e,t,n){return n.indexOf(e)!==t}))&&(t=t.filter((function(e){return l.exists(e)}))),t.map((function(e){return l.exists(e)?["update",e]:[c,e]}))})(i).forEach((function(e){e[1]=Buffer.from(e[1]),"buffer"!==r&&(e[1]=e[1].toString(r)),t.apply(null,e)})),n=null,i=[]}return l.number(o)||(o=200),function(e,t){i.push(t),n||(n=setTimeout(s,o))}}(t,(function(e,i){var r;t.compareName?t.compareName(i)&&n.emit("change",e,i):(r=t.options.filter,l.func(r)?function(e,t){r(e,!1)&&t()}:l.regExp(r)?function(e,t){r.test(e)&&t()}:function(e,t){t()})(i,(function(){n.flag?n.flag="":n.emit("change",e,i)}))}));e.on("error",(function(r){n.isClosed()||(l.windows()&&"EPERM"===r.code?(e.emit("change",c,t.fpath&&""),n.flag="windows-error",n.close(i)):n.emit("error",r))})),e.on("change",(function(e,i){if(!n.isClosed()){var s=i;l.nil(s)&&(s=""),s=r.join(t.fpath,s),t.options.recursive&&a((function(e){if(!e){var i=r.resolve(s);l.exists(s)?l.directory(s)&&!n.watchers[i]&&y(s,t.options.filter)&&n.watchDirectory(s,t.options):n.close(i)}})),o(e,s)}}))},m.prototype.watchFile=function(e,t,n){var o=r.join(e,"../"),s=Object.assign({},t,{filter:null,encoding:"utf8"});delete s.recursive;var a=i.watch(o,s);this.add(a,{type:"file",fpath:o,options:Object.assign({},s,{encoding:t.encoding}),compareName:function(t){return l.samePath(t,e)}}),l.func(n)&&(1===n.length&&E(),this.on("change",n))},m.prototype.watchDirectory=function(e,t,n,r=v){var o=this,s=r();a((function(a){t.recursive=!!t.recursive;var c=Object.assign({},t,{encoding:"utf8"});if(a||delete c.recursive,o._isClosed)return s(),o.close();var u=i.watch(e,c);o.add(u,{type:"dir",fpath:e,options:t}),l.func(n)&&(1===n.length&&E(),o.on("change",n)),t.recursive&&!a&&g(e,(function(e){y(e,t.filter)&&o.watchDirectory(e,t,null,r)}),r()),s()}))},e.exports=O,e.exports.default=O},282:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.EventManager=t.EventType=void 0,(n=t.EventType||(t.EventType={}))[n.EVENT_ON_DID_CHANGE_WORKSPACE_FOLDERS=0]="EVENT_ON_DID_CHANGE_WORKSPACE_FOLDERS",n[n.EVENT_ON_DID_CHANGE_CONFIGURATION=1]="EVENT_ON_DID_CHANGE_CONFIGURATION";class i{static fireEvent(e,t){if(i.eventList[e])for(const n of i.eventList[e])n(t)}static listenToEvent(e,t){return void 0===i.eventList[e]&&(i.eventList[e]=[]),i.eventList[e].push(t),i.eventList[e].length-1}static stopListenToEvent(e,t){i.eventList[e]&&i.eventList[e].splice(t,1)}}t.EventManager=i,i.eventList={}},311:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.excel2kv=t.eachExcelConfig=t.cmdExcel2KV=void 0;const i=n(496),r=n(17),o=n(147),s=n(820),a=n(242),l=n(290),c=n(178),u=n(490),f=n(910);async function h(e,t){for(const n in e){const i=e[n];if(r.isAbsolute(i)){if(void 0!==t(r.normalize(n),r.normalize(i)))break}else{let e=n,o=i;const s=(0,a.getRootPath)();if(s&&(!1===r.isAbsolute(e)&&(e=r.join(s,n)),!1===r.isAbsolute(o)&&(o=r.join(s,i))),void 0!==t(r.normalize(e),r.normalize(o)))break}}}async function d(e,t,n){if(!1===await(0,u.getPathInfo)(e))return(0,l.showStatusBarMessage)(`[${(0,c.localize)("cmdExcel2KV")}]：`+(0,c.localize)("path_no_found")+e),void i.window.showErrorMessage(`[${(0,c.localize)("cmdExcel2KV")}]：`+(0,c.localize)("path_no_found")+`(${e})`+(0,c.localize)("sure create folder"),(0,c.localize)("confirm"),(0,c.localize)("cancel")).then((t=>{t==(0,c.localize)("confirm")&&(0,u.dirExists)(e)}));if(!1===await(0,u.getPathInfo)(t))return void(0,l.showStatusBarMessage)(`[${(0,c.localize)("cmdExcel2KV")}]：`+(0,c.localize)("path_no_found")+t);(0,l.changeStatusBarState)(l.StatusBarState.LOADING);let s=(0,l.showStatusBarMessage)(`[${(0,c.localize)("cmdExcel2KV")}]：`+t),a=(await i.workspace.fs.stat(i.Uri.file(t))).type;if(a===i.FileType.Directory){let a=await i.workspace.fs.readDirectory(i.Uri.file(t));for(let h=0;h<a.length;h++){let[d,g]=a[h];if(void 0!==d&&-1===d.search(/~\$/)&&g===i.FileType.File){let i=r.join(t,d),a=r.join(r.dirname(i),"csv",r.basename(i).replace(r.extname(i),".csv"));if(!1===await(0,u.getPathInfo)(a))return void(0,l.showStatusBarMessage)(`[${(0,c.localize)("cmdExcel2KV")}]：`+(0,c.localize)("path_no_found")+a);await(0,u.dirExists)(r.join(e,r.dirname(d.replace(r.extname(d),".lua")))),o.writeFileSync(r.join(e,d.replace(r.extname(d),".lua")),(0,f.obj2Lua)(n(a))),(0,l.refreshStatusBarMessage)(s,`[${(0,c.localize)("cmdExcel2KV")}]：`+d)}}}else if(a===i.FileType.File){let i=r.join(r.dirname(t),"csv",r.basename(t).replace(r.extname(t),".csv"));if(!1===await(0,u.getPathInfo)(i))return void(0,l.showStatusBarMessage)(`[${(0,c.localize)("cmdExcel2KV")}]：`+(0,c.localize)("path_no_found")+i);await(0,u.dirExists)(e),o.writeFileSync(e,(0,f.obj2Lua)(n(i))),(0,l.refreshStatusBarMessage)(s,`[${(0,c.localize)("cmdExcel2KV")}]：`+r.basename(t))}(0,l.changeStatusBarState)(l.StatusBarState.ALL_DONE)}t.cmdExcel2KV=function(e){let t=i.workspace.getConfiguration().get("war3-tools.A2.AbilityExcel");t&&h(t,((e,t)=>{d(e,t,s.abilityCSV2KV)}));let n=i.workspace.getConfiguration().get("war3-tools.A2.UnitExcel");n&&h(n,((e,t)=>{d(e,t,s.unitCSV2KV)}))},t.eachExcelConfig=h,t.excel2kv=d},397:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ENUM_STATUS_BAR_MESSAGE_TIMEOUT=void 0,t.ENUM_STATUS_BAR_MESSAGE_TIMEOUT=5},616:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;const i=n(496),r=n(884),o=n(981),s=n(290),a=n(178),l=n(282),c={listenerAbilityExcelInit:r.listenerAbilityExcelInit,listenerUnitExcelInit:o.listenerUnitExcelInit},u={addonInfoInit:"addon_info"};let f;const h="war3-tools.A1.module_list";let d=i.workspace.getConfiguration().get(h);function g(e){return void 0!==u[e]&&null!=d&&!1===d[u[e]]}t.init=async function(e){void 0===f&&(f=l.EventManager.listenToEvent(l.EventType.EVENT_ON_DID_CHANGE_CONFIGURATION,(async t=>{if(!t.affectsConfiguration(h))return;let n=(new Date).valueOf(),r=i.workspace.getConfiguration().get(h);const o=Object.keys(c);for(let t=0;t<o.length;t++){const i=o[t];if(r&&g(i)&&!1!==r[u[i]]){let r=(0,s.showStatusBarMessage)(`[${t+1}/${o.length}]${(0,a.localize)("loading")}：${(0,a.localize)(i)}`,20);await c[i](e),(0,s.refreshStatusBarMessage)(r,`[${t+1}/${o.length}]${(0,a.localize)("load_complete")}：${(0,a.localize)(i)}，${(0,a.localize)("time_consuming")}：${(new Date).valueOf()-n}${(0,a.localize)("millisecond")}`,20),n=(new Date).valueOf()}}d=r})));let t=(new Date).valueOf();const n=Object.keys(c);for(let i=0;i<n.length;i++){const r=n[i];if(d&&g(r)){(0,s.showStatusBarMessage)(`[${i+1}/${n.length}]${(0,a.localize)("skip_disabled_modules")}：${(0,a.localize)(r)}`);continue}let o=(0,s.showStatusBarMessage)(`[${i+1}/${n.length}]${(0,a.localize)("loading")}：${(0,a.localize)(r)}`,20);await c[r](e),(0,s.refreshStatusBarMessage)(o,`[${i+1}/${n.length}]${(0,a.localize)("load_complete")}：${(0,a.localize)(r)}，${(0,a.localize)("time_consuming")}：${(new Date).valueOf()-t}${(0,a.localize)("millisecond")}`,20),t=(new Date).valueOf()}(0,s.showStatusBarMessage)((0,a.localize)("allLoaded"),20),(0,s.getStatusBarItem)().text="$(check-all) "+(0,a.localize)("pluginNameLite")}},884:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.listenerAbilityExcelInit=void 0;const i=n(496),r=n(147),o=n(17),s=n(978),a=n(282),l=n(242),c=n(311),u=n(820),f=n(290),h=n(910);let d,g;const p="war3-tools.A1.listener";let v;function y(e){if(void 0===g){const e=(0,l.getRootPath)();if(e){(0,f.showStatusBarMessage)("[监听目录]：技能excel");let t=i.workspace.getConfiguration().get("war3-tools.A2.AbilityExcel");g=(0,s.default)(e,{recursive:!0,filter:/\.csv$/},(function(e,n){t&&(0,c.eachExcelConfig)(t,((e,t)=>{if(o.normalize(t)==o.normalize(o.dirname(n)).replace("\\csv","")){const t=o.join(e,o.basename(n).replace(o.extname(n),".lua"));return r.writeFileSync(t,(0,h.obj2Lua)((0,u.abilityCSV2KV)(n))),(0,f.showStatusBarMessage)("[excel导出kv]："+o.basename(n).replace(o.extname(n),".lua")),!1}}))}))}}}function E(){g&&((0,f.showStatusBarMessage)("[停止监听目录]：技能excel"),g.close(),g=void 0)}function m(){let e=i.workspace.getConfiguration().get(p);if(e)return e.ability_excel||!1}t.listenerAbilityExcelInit=function(e){v=m(),m()&&y(),void 0===d&&(d=a.EventManager.listenToEvent(a.EventType.EVENT_ON_DID_CHANGE_CONFIGURATION,(e=>{e.affectsConfiguration(p)&&m()!==v&&(v=m(),m()?(E(),y()):E())})))}},981:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.listenerUnitExcelInit=void 0;const i=n(496),r=n(147),o=n(17),s=n(978),a=n(282),l=n(242),c=n(311),u=n(820),f=n(290),h=n(132);let d,g;const p="war3-tools.A1.listener";let v;function y(e){if(void 0===g){const e=(0,l.getRootPath)();if(e){(0,f.showStatusBarMessage)("[监听目录]：单位excel");let t=i.workspace.getConfiguration().get("war3-tools.A2.UnitExcel");g=(0,s.default)(e,{recursive:!0,filter:/\.csv$/},(function(e,n){t&&(0,c.eachExcelConfig)(t,((e,t)=>{if(o.normalize(t)==o.normalize(o.dirname(n)).replace("\\csv","")){const t=o.join(e,o.basename(n).replace(o.extname(n),".lua"));return r.writeFileSync(t,(0,h.writeKeyValue)({KeyValue:(0,u.unitCSV2KV)(n)})),(0,f.showStatusBarMessage)("[excel导出kv]："+o.basename(n).replace(o.extname(n),".lua")),!1}}))}))}}}function E(){g&&((0,f.showStatusBarMessage)("[停止监听目录]：单位excel"),g.close(),g=void 0)}function m(){let e=i.workspace.getConfiguration().get(p);if(e)return e.unit_excel||!1}t.listenerUnitExcelInit=function(e){m()&&y(),void 0===d&&(d=a.EventManager.listenToEvent(a.EventType.EVENT_ON_DID_CHANGE_CONFIGURATION,(e=>{e.affectsConfiguration(p)&&m()!==v&&(v=m(),m()?(E(),y()):E())})))}},290:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.changeStatusBarState=t.refreshStatusBarMessage=t.showStatusBarMessage=t.getStatusBarItem=t.statusBarItemInit=t.StatusBarState=void 0;const i=n(496),r=n(397),o=n(178);let s,a=i.window.createStatusBarItem(i.StatusBarAlignment.Left,1),l=[],c=0,u=!1;var f;(f=t.StatusBarState||(t.StatusBarState={})).ALL_DONE="$(check-all)",f.LOADING="$(loading~spin)",t.statusBarItemInit=async function(e){a.text="$(loading~spin) "+(0,o.localize)("pluginNameLite"),e.subscriptions.push(a),s=i.window.createOutputChannel((0,o.localize)("pluginNameLite")),a.show(),e.subscriptions.push(i.commands.registerCommand("war3tools.showOutput",(async e=>{u?(u=!u,s.hide()):(u=!u,s.show())}))),a.command="war3tools.showOutput"},t.getStatusBarItem=function(){return a},t.showStatusBarMessage=function(e,t=r.ENUM_STATUS_BAR_MESSAGE_TIMEOUT){return function(e){l[c]=e,c++;let t=`**${(0,o.localize)("message_notification")}**  \n`;for(let e=Math.max(c-20,0);e<c;e++)t+="  \n"+l[e];a.tooltip=new i.MarkdownString(t)}(e),-1===t&&i.window.setStatusBarMessage(e),i.window.setStatusBarMessage(e,1e3*t),s.appendLine(e),c-1},t.refreshStatusBarMessage=function(e,t,n=r.ENUM_STATUS_BAR_MESSAGE_TIMEOUT){l[e]&&(l[e]=t),s.appendLine(t),i.window.setStatusBarMessage(t,1e3*n)},t.changeStatusBarState=function(e){a.text=e+" "+(0,o.localize)("pluginNameLite")}},820:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unitCSV2KV=t.abilityCSV2KV=t.multilayerCSV2KV=t.isEmptyCSVValue=t.array2csv=t.csv2array=t.csvParse=t.obj2csv=t.csv2obj=void 0;const i=n(37),r=n(147);function o(e){e=e.replace(/\r\n/g,"\n");let t=[],n=0,i=0;for(let t=0;t<e.length;t++)t=r(t);return t;function r(r){let o="",s="normal";for(let a=r;a<e.length;a++){let r=e[a],l=a===e.length-1;if('"'!==r||"normal"!==s)if('"'!==r||"string"!==s)if("\n"!==r||"string"!==s){if("\n"===r&&"normal"===s)return void 0===t[i]&&(t[i]=[]),t[i][n]=o,i++,n=0,a;if(","===r&&"string"!==s)return void 0===t[i]&&(t[i]=[]),t[i][n]=o,n++,a;if(l&&"normal"===s)return void 0===t[i]&&(t[i]=[]),o+=r,t[i][n]=o,i++,n=0,a;o+=r}else o+=r;else s="normal";else s="string"}}}function s(e){let t="",n=e[1].length;for(let r=0;r<e.length;r++){const o=e[r];for(let e=0;e<o.length&&(void 0!==o[0]||0!==o.length);e++){let n=void 0===o[e]?"":o[e];-1!==n.indexOf(",")&&(n='"'+n+'"'),t+=n+(e+1===o.length?"":",")}if(void 0!==o[0]||o.length>0){for(let e=0;e<n-o.length;e++)t+=",";t+=i.EOL}if(0===o.length){for(let e=0;e<n-1;e++)t+=",";t+=i.EOL}}return t}t.csv2obj=function(e,t=!1){let n=e;"string"==typeof e&&(n=o(e));let i={};if(t)for(let e=0;e<n.length;e++){let t=n[e];i[t[1]]=t[2]}else{if(n.length<3)return i;let e=n[1];for(let t=2;t<n.length;t++){let r=n[t],o=r[0];if(o){i[o]={};for(let t=0;t<r.length;t++){if(!e[t]||""===e[t])continue;let n=r[t]||"",s=e[t];if("AttachWearables"===e[t])for(let e=1;e<30;e++)if(!i[o]["AttachWearables"+e]){s="AttachWearables"+e;break}i[o][s]=n}}}i.__key_sc={};for(let t=0;t<e.length;t++){let r=n[0][t]||"",o=e[t];if("AttachWearables"===e[t])for(let e=1;e<30;e++)if(!i.__key_sc["AttachWearables"+e]){o="AttachWearables"+e,r="AttachWearables"+e;break}i.__key_sc[o]=r}}return i},t.obj2csv=function(e){let t=e.__key_sc;if(!t){t={};for(let n in e){let i=e[n];for(let e in i)t[e]=e}}let n=[];n[0]=[],n[1]=[];for(let e in t){let i=t[e];n[0].push(i),-1!==e.indexOf("AttachWearables")?n[1].push("AttachWearables"):n[1].push(e)}let i=2;for(let r in e){if("__key_sc"===r)continue;n[i]=[];let o=e[r];for(let e in t){let t=o[e]||"";n[i].push(t)}i++}return s(n)},t.csvParse=o,t.csv2array=function(e){const t=e.split(i.EOL);let n=[];for(let e=0;e<t.length;e++){n[e]=[];let i=t[e].split(",");if(1!==i.length)for(let t=0;t<i.length;t++){const r=i[t];n[e].push(r)}}return n},t.array2csv=s,t.isEmptyCSVValue=function(e){return null==e||""===e},t.multilayerCSV2KV=function(e){try{let t=o(r.readFileSync(e,"utf-8")),n=t[1];for(let e=0;e<n.length;e++){let t=n[e].split("-");t.length>1&&(n[e]=t)}let i=t[2];if(0===i.length||void 0===i[0])return{};let s={},a={};for(let e=2;e<t.length;e++){const r=t[e];if(0===r.length)continue;let o;""===r[0]?o=a[i[0]]:(o={},i=[r[0]],s={});for(let e=1;e<r.length;e++){let t=r[e];""!==t?i[e]=t:t=i[e];let a=n[e];if(a instanceof Array){let e;"root"!==a[0]?(void 0===o[a[0]]&&(o[a[0]]={}),e=o[a[0]]):e=o,void 0===s[a[0]]&&(s[a[0]]={});let n=1,i=n-1;for(;n<=a.length-2;n++){i=n-1;let t=s[a[0]][i];void 0!==t&&""!==t&&void 0!==e[t]&&(e=e[t])}if(i=n-1,"value"===a[a.length-1]){let n=s[a[0]][i];if(void 0===n||""===n)continue;e[n]=t}else{let n=""===t||void 0===t?s[a[0]][i]:t;if(void 0===n||""===n)continue;s[a[0]][i]=n,void 0===e[n]&&(e[n]={})}}else{if(""===a)continue;if(void 0===t||""===t)continue;o[a]=t}}void 0!==r[0]&&""!==r[0]&&(a[r[0]]=o)}return a}catch(e){console.log(e)}},t.abilityCSV2KV=function(e){let t={},n=o(r.readFileSync(e,"utf-8"));const i=n[0];for(let e=1;e<n.length;e++){const r=n[e];if(0===r.length||void 0===r[0]||""===r[0])continue;let o=1,s=1,a={},l={},c={},u={},f={};for(let t=1;t<r.length;t++){const h=r[t];if(""===h)continue;let d=i[t];if("AbilitySpecial"===d){if(d=("0"+o).substr(-2),void 0!==n[e+1]&&""!==n[e+1]){let i=n[e+1][t],r=h.split("\n"),s=i.split("\n");a[d]={var_type:-1!==s[0].search(/\./g)?"FIELD_FLOAT":"FIELD_INTEGER"};for(let e=0;e<r.length;e++){const t=r[e];a[d][t]=s[e]}o++}}else if("AbilityValues"===d){if(void 0!==n[e+1]&&""!==n[e+1]){let i=n[e+1][t],r=h.split("\n"),o=i.split("\n");if(r.length<=1)l[r[0]]=o[0];else{l[r[0]]={};for(let e=0;e<r.length;e++){const t=r[e],n=o[e];0==e?l[r[0]].value=n:l[r[0]][t]=n}}}}else if(-1!=d.indexOf("参数")){if(void 0!==n[e+1]&&""!==n[e+1]){let i=n[e+1][t];h.split("\n"),i.split("\n"),f[h]=i}}else{if(""===d)continue;if("precache"===d){if(void 0!==n[e+1]&&""!==n[e+1]){let i=n[e+1][t];void 0===u[h]&&(u[h]=[]),u[h].push(i)}}else if("PrecacheResource"===d){if(void 0!==n[e+1]&&""!==n[e+1]){let e=h.split("\n");for(let t=0;t<e.length;t++){const n=e[t];c[String(s)]=n,s++}}}else f[d]=h}}Object.keys(a).length>0&&(f.AbilitySpecial=a),Object.keys(l).length>0&&(f.AbilityValues=l),Object.keys(u).length>0&&(f.precache=u),Object.keys(c).length>0&&(f.PrecacheResource=c),e++,t[r[0]]=f}return t},t.unitCSV2KV=function(e){let t={},n=o(r.readFileSync(e,"utf-8"));const i=n[0];for(let e=1;e<n.length;e++){const r=n[e];if(0===r.length||""===r[0]||void 0===r[0])continue;let o=1,s={},a={},l=function(e){let t={};for(let n=e+1;n<r.length;n++){const e=r[n],o=i[n];if(""!==e)""!==o&&(t[o]=e);else if(-1!==o.search("[{]")){let[e,i]=l(n);n=i,Object.keys(e).length>0&&(t[o.split("[{]")[0]]=e)}else if(-1!==o.search("[}]"))return[t,n]}};for(let e=1;e<r.length;e++){const t=r[e];let n=i[e];if(""!==t)if("AttachWearables"===n){n=o.toString();let e=t;s[n]={ItemDef:e},o++}else{if("CanRespawn"===n||"DisableClumpingBehavior"===n||"UsesGestureBasedAttackAnimation"===n||"ShouldDoFlyHeightVisual"===n||"IsHybridFlyer"===n){void 0===a.Creature&&(a.Creature={}),a.Creature[n]=t;continue}if(""===n)continue;a[n]=t}else if(-1!==n.search("[{]")){let[t,i]=l(e);e=i,Object.keys(t).length>0&&(a[n.split("[{]")[0]]=t)}}Object.keys(s).length>0&&(void 0===a.Creature&&(a.Creature={}),a.Creature.AttachWearables=s),t[r[0]]=a}return t}},242:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRootPath=void 0;const i=n(496);t.getRootPath=function(){const e=i.workspace.workspaceFolders;return void 0!==e?e[0].uri.fsPath:void 0}},521:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isNumber=void 0,t.isNumber=function(e){return!!/^(-?\d+)(\.\d+)?$/.test(e)}},132:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBaseInfo=t.writeKeyValue=t.replaceKeyValue=t.overrideKeyValue=t.getKeyValueObjectByIndex=t.removeComment=t.readKeyValueWithBaseIncludePath=t.readKeyValueWithBase=t.readKeyValue3=t.readKeyValue2=void 0;const i=n(147),r=n(37),o=n(490),s=n(521);function a(e,t=!0,n=!0){!0===t&&(e=c(e)),e=e.replace(/\t/g,"").replace(/\r\n/g,"");let i={},r=1;for(let t=0;t<e.length;t++){let s=e[t];if('"'!==s)"#"!==s||"#base"!==e.substr(t,5)||(t=f(t));else{let e,s;[e,s,t]=o(t),void 0===i[e]||!0===n?i[e]=s:(i[e+r]=s,r++)}}return i;function o(t){let n,i="",r="NONE";for(let o=t;o<e.length;o++){let t=e[o];if('"'!==t||"NONE"!==r){if('"'===t&&"VALUE"===r)return[n,o]=a(o),[i,n,o];if("{"===t&&"VALUE"===r)return[n,o]=s(o),[i,n,o]}else[i,o]=a(o),r="VALUE"}}function s(t){let i={},r="NONE",s=1;for(let a=t;a<e.length;a++){let t=e[a];if("{"!==t||"NONE"!==r)if("<"!==t||"\x3c!-- kv3"!==e.substr(a,8)||"READ"!==r)if('"'!==t||"READ"!==r){if("}"===t&&"READ"===r)return[i,a]}else{let e,t;[e,t,a]=o(a),void 0===i[e]||!0===n?i[e]=t:(i[e+s]=t,s++)}else{let[e,t]=u(a);i=l(e),a=t}else r="READ"}}function a(t){let n="",i="NONE";for(let r=t;r<e.length;r++){let t=e[r];if("\\"!==t||'"'!==e[r+1])if('"'!==t||"NONE"!==i){if("READ"===i){if('"'===t)return[n,r];n+=t}}else i="READ";else n+=t,r++}}function u(t){let n="",i=0,r=0,o="NONE";for(let s=t;s<e.length;s++){let t=e[s];if("NONE"!==o||"<"!==t)if("HEAD"!==o){if(n+=t,"{"===t&&i++,"}"===t&&(r++,i===r))return[n,s]}else">"===t&&(o="NONE");else o="HEAD"}}function f(t){let n="",i="NONE";for(let r=t;r<e.length;r++){let t=e[r];if("#"!==t)if('"'!==t||"START"!==i)if("READ"!==i);else{if('"'===t)return r;n+=t}else i="READ";else i="START"}}}function l(e){e=e.replace(/<!-- kv3.*-->/,"").replace(/\t/g,"").replace(/\s+/g,"").replace(/\r\n/g,"");let t=[];for(let i=0;i<e.length;i++)if("{"!==e[i]);else{let[e,r]=n(i);t.push(e),i=r}return t;function n(t){let r={},o="",a="",l="NONE";for(let c=t;c<e.length;c++){let t=e[c];if("{"!==t||"NONE"!==l){if("}"===t)return[r,c];if("KEY"!==l){if("VALUE"===l){if("false"===e.substr(c,5)){r[o]="false",o="",a="",l="KEY",c+=4;continue}if("true"===e.substr(c,4)){r[o]="true",o="",a="",l="KEY",c+=3;continue}if('"'===t){l="STRING";continue}if("{"===t){let[e,t]=n(c);r[o]=e,o="",a="",c=t,l="KEY";continue}if("["===t){let[e,t]=i(c);r[o]=e,o="",a="",c=t,l="KEY";continue}!0!==(0,s.isNumber)(t)&&"."!==t&&"-"!==t||(l="NUMBER")}if("STRING"!==l)if("NUMBER"!==l);else{if(!0===(0,s.isNumber)(t)||"."===t||"-"===t){a+=t;continue}r[o]=a,o="",a="",c--,l="KEY"}else{if('"'===t){r[o]=a,o="",a="",l="KEY";continue}a+=t}}else{if("="===t){l="VALUE";continue}o+=t}}else l="KEY"}}function i(t){let i=[],r="NONE",o="";for(let s=t;s<e.length;s++){let t=e[s];if("["!==t&&","!==t||"NONE"!==r){if("]"===t)return[i,s];if("VALUE"===r){if('"'===t){r="STRING";continue}if("{"===t){let[e,t]=n(s);i.push(e),s=t,r="NONE";continue}r="NUMBER"}if("STRING"!==r)if("NUMBER"!==r);else{if(","===t){i.push(o),o="",r="VALUE";continue}o+=t}else{if('"'===t){i.push(o),o="",s++,r="VALUE";continue}o+=t}}else r="VALUE"}}}function c(e){let t="";const n=e.split(r.EOL);for(let e=0;e<n.length;e++){const i=n[e];let o=0;for(let e=0;e<i.length;e++){const n=i[e];if('"'===n&&(o=0===o?1:0),1!==o&&"/"===n&&"/"===i[e+1])break;t+=n}t+=r.EOL}return t}function u(e,t){if("object"!=typeof e)return t;if("object"!=typeof t)return e;for(const n in t){const i=t[n];e[n]="object"==typeof i?u(e[n],i):i}return e}t.readKeyValue2=a,t.readKeyValue3=l,t.readKeyValueWithBase=async function(e){let t=e.split("/").pop()||"",n=e.split(t)[0],s=a(i.readFileSync(e,"utf-8")),l=s[Object.keys(s)[0]],u=i.readFileSync(e,"utf-8");u=c(u);const f=u.split(r.EOL);for(let e=0;e<f.length;e++){const t=f[e];if(-1!==t.search(/#base ".*"/)){let e=t.split('"')[1];if(!1===await(0,o.getPathInfo)(n+e))continue;let r=a(i.readFileSync(n+e,"utf-8")),s=r[Object.keys(r)[0]];for(const e in s){const t=s[e];l[e]=t}}}return s},t.readKeyValueWithBaseIncludePath=async function(e){let t={},n=e.split("/").pop()||"",s=e.split(n)[0],l=a(i.readFileSync(e,"utf-8"));t[e]=l;let u=i.readFileSync(e,"utf-8");u=c(u);const f=u.split(r.EOL);for(let e=0;e<f.length;e++){const n=f[e];if(-1!==n.search(/#base ".*"/)){let e=n.split('"')[1];if(!1===await(0,o.getPathInfo)(s+e))continue;let r=a(i.readFileSync(s+e,"utf-8"));t[s+e]=r;let l=r[Object.keys(r)[0]];for(const e in l)l[e]}}return t},t.removeComment=c,t.getKeyValueObjectByIndex=function(e,t=0){if("object"==typeof e)return e[Object.keys(e)[t]]},t.overrideKeyValue=u,t.replaceKeyValue=function(e,t){if("object"!=typeof e)return t;if("object"!=typeof t)return e;for(const n in t){const i=t[n];void 0!==e[n]&&null!==e[n]&&(e[n]="object"==typeof i?u(e[n],i):i)}return e},t.writeKeyValue=function e(t,n=0,i=12){var o="";if(null==t)return o;function s(e,t){var n="";for(let t=0;t<e;t++)n+="\t";return n+t}function a(e,t,n=12){var i="";for(let r=0;r<n-Math.floor((4*e+t.length+2)/4);r++)i+="\t";return i}let l=Object.keys(t).sort((function(e,t){return Number(e)-Number(t)}));for(let c=0;c<l.length;c++){const u=l[c],f=t[u];if(null==f||"object"==typeof f&&0===Object.keys(f).length);else if("string"==typeof f)o+=s(n,'"'+u+'"'),o+=a(n,u,i),o+='"'+f+'"'+r.EOL;else if("precache"===u&&"object"==typeof f){o+=s(n,'"'+u+'"'+r.EOL),o+=s(n,"{"+r.EOL);for(const e in f){const t=f[e];for(const l of t)o+=s(n+1,'"'+e+'"'),o+=a(n+1,e,i),o+='"'+l+'"'+r.EOL}o+=s(n,"}"+r.EOL)}else o+=s(n,'"'+u+'"'+r.EOL),o+=s(n,"{"+r.EOL),o+=e(f,n+1),o+=s(n,"}"+r.EOL)}return o},t.getBaseInfo=async function(e){let t=i.readFileSync(e,"utf-8"),n=[];t=c(t);const o=t.split(r.EOL);for(let e=0;e<o.length;e++){const t=o[e];-1!==t.search(/#base ".*"\s/)&&t.replace(/#base "(.*)"/,((e,t)=>(n.push(t),e)))}return n}},178:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hasReverseLocalize=t.hasLocalize=t.reverseLocalize=t.localize=t.localizeInit=void 0;const i=n(496),r=n(685);let o,s;var a;!function(e){e.schinese="zh-cn",e.english="en"}(a||(a={})),t.localizeInit=async function(e){o={[a.schinese]:JSON.parse(await(0,r.readFile)(i.Uri.joinPath(e.extensionUri,"package.nls.zh-cn.json"))),[a.english]:JSON.parse(await(0,r.readFile)(i.Uri.joinPath(e.extensionUri,"package.nls.json")))},s={[a.schinese]:{...o[a.schinese]},[a.english]:{...o[a.english]}};for(const e in s[a.schinese]){let t=s[a.schinese][e];s[a.schinese][t]=e,delete s[a.schinese][e]}for(const e in s[a.english]){let t=s[a.english][e];s[a.english][t]=e,delete s[a.english][e]}},t.localize=function(e,t,n){if(void 0===o||void 0===e)return e;let r=n??"zh-cn"===i.env.language?"zh-cn":"en",s=o[r];if(void 0!==s[e])return s[e];if(t)for(const n in t){const i=t[n];e.replace(/\${' + key + '}/g,i)}return e},t.reverseLocalize=function(e,t,n){if(void 0===s||void 0===e)return e;let r=n??"zh-cn"===i.env.language?"zh-cn":"en",o=s[r];if(void 0!==o[e])return o[e];if(t)for(const n in t){const i=t[n];e.replace(/\${' + key + '}/g,i)}return e},t.hasLocalize=function(e,t){if(void 0===o)return!1;let n=t??"zh-cn"===i.env.language?"zh-cn":"en";return void 0!==o[n][e]},t.hasReverseLocalize=function(e,t){if(void 0===s)return!1;let n=t??"zh-cn"===i.env.language?"zh-cn":"en";return void 0!==s[n][e]}},910:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.writeKeyValueLua=t.obj2Lua=void 0;const i=n(37),r=n(521);function o(e,t=1,n=12){var s="";if(null==e)return s;function a(e,t){var n="";for(let t=0;t<e;t++)n+="\t";return n+t}let l=Object.keys(e).sort((function(e,t){return Number(e)-Number(t)}));for(let n=0;n<l.length;n++){const c=l[n],u=e[c];null==u||"object"==typeof u&&0===Object.keys(u).length||("string"==typeof u?(s+=a(t,'["'+c+'"] = '),-1!=u.indexOf(" ")?s+="{"+u.replace(/\s/g,",")+"},"+i.EOL:(0,r.isNumber)(u)?s+=u+","+i.EOL:s+="[["+u+"]],"+i.EOL):(s+=a(t,'["'+c+'"] = {'+i.EOL),s+=o(u,t+1),s+=a(t,"},"+i.EOL)))}return s}t.obj2Lua=function(e){let t=o(e);return t="return {\n"+t+"\n}",t},t.writeKeyValueLua=o},490:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dirExists=t.makeDir=t.getPathInfo=void 0;const i=n(147),r=n(17);function o(e){return new Promise(((t,n)=>{i.stat(e,((e,n)=>{t(!e&&n)}))}))}async function s(e){return new Promise(((t,n)=>{i.mkdir(e,(e=>{t(!e)}))}))}t.getPathInfo=o,t.makeDir=s,t.dirExists=async function e(t){let n=await o(t);if(n&&!0!==n&&n.isDirectory())return!0;if(n)return!1;let i,a=r.parse(t).dir;return await e(a)&&(i=await s(t)),i}},685:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readFile=void 0;const i=n(837),r=n(496);t.readFile=async function(e){let t=await r.workspace.fs.readFile(e);return(new i.TextDecoder).decode(t)}},496:e=>{"use strict";e.exports=require("vscode")},361:e=>{"use strict";e.exports=require("events")},147:e=>{"use strict";e.exports=require("fs")},37:e=>{"use strict";e.exports=require("os")},17:e=>{"use strict";e.exports=require("path")},837:e=>{"use strict";e.exports=require("util")}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,n),o.exports}var i={};(()=>{"use strict";var e=i;Object.defineProperty(e,"__esModule",{value:!0}),e.deactivate=e.activate=void 0;const t=n(496),r=n(282),o=n(311),s=n(616),a=n(290),l=n(178);e.activate=async function(e){await(0,l.localizeInit)(e),await(0,a.statusBarItemInit)(e),await(0,s.init)(e),t.workspace.onDidChangeWorkspaceFolders((async t=>{await(0,s.init)(e)}),null,e.subscriptions),t.workspace.onDidChangeConfiguration((e=>{r.EventManager.fireEvent(r.EventType.EVENT_ON_DID_CHANGE_CONFIGURATION,e)}),null,e.subscriptions),e.subscriptions.push(t.commands.registerCommand("war3-tools.excel_to_lua",(()=>(0,o.cmdExcel2KV)(e))))},e.deactivate=function(){}})(),module.exports=i})();